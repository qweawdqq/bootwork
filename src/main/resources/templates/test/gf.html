package pdcss.court.spgl.bean.pqgl;

import java.io.ByteArrayOutputStream;
import java.io.File;
import java.io.FileOutputStream;
import java.lang.reflect.InvocationTargetException;
import java.math.BigDecimal;
import java.text.DecimalFormat;
import java.text.SimpleDateFormat;
import java.util.ArrayList;
import java.util.Calendar;
import java.util.Date;
import java.util.HashMap;
import java.util.Hashtable;
import java.util.Iterator;
import java.util.List;
import java.util.Map;
import java.util.Set;
import java.util.Vector;

import javax.servlet.http.HttpServletResponse;

import org.apache.commons.lang3.StringUtils;
import org.springframework.context.ApplicationContext;

import pdcss.bean.BeanAbstract;
import pdcss.common.SessionManager;
import pdcss.common.util.Base64;
import pdcss.common.util.DateTools;
import pdcss.common.util.Escape;
import pdcss.common.util.KeyUtil;
import pdcss.common.util.WritManager;
import pdcss.court.jgxn.Tjsj;
import pdcss.court.spgl.bean.Icons;
import pdcss.court.spgl.bean.fasz.Bmft;
import pdcss.court.spgl.bean.fasz.Hytcy;
import pdcss.court.spgl.bean.ladj.Dsrxx;
import pdcss.court.spgl.bean.ladj.Ysqk;
import pdcss.court.spgl.bean.zbaj.AJJbxx;
import pdcss.court.spgl.bean.zbaj.Tsxx;
import pdcss.ibatis.IIbatisDAO;
import pdcss.json.JSONArray;
import pdcss.json.JSONObject;
import pdcss.servlet.InitServlet;
import pdcss.task.Dict;

public class Ccpq extends BeanAbstract {
private static List xlaZSlist;
private static Map numMap;

static {
// TODO:这里暂时先以1-10算2个案件， 11-50算3个，51-100算4个，101以后算5个
xlaZSlist = new ArrayList();
Map tmp = new HashMap();
tmp.put("KSSL", new Integer(1));// 开始数量
tmp.put("JSSL", new Integer(10));// 结束数量
tmp.put("ZSSL", new Integer(2));// 折算数量
xlaZSlist.add(tmp);
tmp = new HashMap();
tmp.put("KSSL", new Integer(11));// 开始数量
tmp.put("JSSL", new Integer(50));// 结束数量
tmp.put("ZSSL", new Integer(3));// 折算数量
xlaZSlist.add(tmp);
tmp = new HashMap();
tmp.put("KSSL", new Integer(51));// 开始数量
tmp.put("JSSL", new Integer(100));// 结束数量
tmp.put("ZSSL", new Integer(4));// 折算数量
xlaZSlist.add(tmp);
tmp = new HashMap();
tmp.put("KSSL", new Integer(101));// 开始数量
tmp.put("JSSL", null);// 结束数量
tmp.put("ZSSL", new Integer(5));// 折算数量
xlaZSlist.add(tmp);

numMap = new HashMap();
numMap.put("1", "一");
numMap.put("2", "二");
numMap.put("3", "三");
}

private String ajid;

private String ajids; //多案件使用逗号,分割

private String ah;

private String spcx;

private String larq;

private String lar;

private String sfdb;

private String cbbm;

private String bmdm;

private String fjm;

private String laay;

private String ayzs1;

private String bz;

private String ajlb;

private Integer xh;

private String zh;

private String cbr;

private String cbrxm;

private String sjy;

private String lczt;

private String spcxdm;

private String sysx;

private String sfda;

private String sfya;

private String sfsx; // 是否死刑

private String xlabh; // 系列案编号

private String ajly; // 案件来源

private String ajsj; // 案件涉及

private String sjraj;// 涉军

private String sxdqr; // 法定结案日期

private String lrrxm; // 录入人

private String sycx;

private String sycxmc;

private String ysah;

private String ysfy;

private List dsrs;

private String dsrstr;

private String sqlWhere;

private String hytcy;

private String pqxh;

private String beizhu;// 案件基本信息备注

private StringBuffer farz; // 分案过程中的日志，用于返回到业页供分案法官参考

private String yjkssj;
private Integer lanh;

private String sfpzjjhft;

private Integer fdsx; // 法定审限

private String sxqk;// 审限情况

private Double ssbd; // 诉讼标的金额

private Double yjssf;// 诉讼费

private String ajzt;

private String pqbg; // 排案变更

private String gsr; // 公诉人

private Date currDate;

private String mode;

private String pqfg;

private String pqfgxm;

private String flag; // 是否调用显示文书

private String spyjly;// 刑事一审立案审批意见

private String lktsj; // 距开庭时间

private String scyjly; // 审查意见;

private Map hythbMap; // 合议庭回避人员

private String sqtj;  //审前调解


public String getAjids() {
return ajids;
}

public void setAjids(String ajids) {
this.ajids = ajids;
}

public String getSqtj() {
return sqtj;
}

public void setSqtj(String sqtj) {
this.sqtj = sqtj;
}

public String getLktsj() {
return lktsj;
}

public void setLktsj(String lktsj) {
this.lktsj = lktsj;
}

public String getFlag() {
return flag;
}

public void setFlag(String flag) {
this.flag = flag;
}

public String getSycxmc() {
if (sycx == null)
return Dict.getInstance().getDictMc("SP108", "2");
else
return Dict.getInstance().getDictMc("SP108", sycx);
}

public void setSycxmc(String sycxmc) {
this.sycxmc = sycxmc;
}

public String getAjzt() {
return ajzt;
}

public String getSjraj() {
return sjraj;
}

public void setSjraj(String sjraj) {
this.sjraj = sjraj;
}

public void setAjzt(String ajzt) {
this.ajzt = ajzt;
}

public String getSxqk() {
return sxqk;
}

public void setSxqk(String sxqk) {
this.sxqk = sxqk;
}

public String getSfpzjjhft() {
return sfpzjjhft;
}

public void setSfpzjjhft(String sfpzjjhft) {
this.sfpzjjhft = sfpzjjhft;
}

public Integer getLanh() {
return lanh;
}

public void setLanh(Integer lanh) {
this.lanh = lanh;
}

public String getBeizhu() {
return beizhu;
}

public void setBeizhu(String beizhu) {
this.beizhu = beizhu;
}

public String getPqxh() {
return pqxh;
}

public void setPqxh(String pqxh) {
this.pqxh = pqxh;
}

public String getHytcy() {
return hytcy;
}

public void setHytcy(String hytcy) {
this.hytcy = hytcy;
}

private String sfcp;

private String ylah;// 案号'
private String yllarq;// 立案日期'
private String ylyjarq;// 应结案日期'
private String ylajfl;// 案件类型'
private String yllaay;// 立案案由'
private String ylayzs;// 案由综述'
private String ylssbd;// 标的金额'
private String ylyjssf;// 预交诉讼费'
private String yljmqk;// 减免情况'
private String ylajsj;// 涉外情况'
private String ylajcs;// 案卷册数'
private String yllar;// 立案人'
private String ylcbbm;// 承办部门'
private String ylzsfg;// 主审法官'
private String ylspz;// 审判长'
private String ylqthytcy;// 合议庭成员'
private String ylsjy;// 跟案书记员'
private String ylktft;// 开庭法庭'
private String ylyjkssj;// 开庭开始时间'
private String ylyjjssj;// 开庭结束时间'
private String yltsbly;// 庭审笔录员'
private String ylgkkt;// 公开开庭'
private String ylftyt;// '法庭用途'
private String yltc;// '庭次'
private String ylqtcyry;// '其他参与人员'
private String ylbz;// '备注'
private String ylpqfgxm;// 排案法官'
private String ylpqsj;// 排案日期'
private String ylpqfs;// 排期方式'
private String ylpqlx;// 排期类型'
private String ylspcx;
private String dsrmc;
private String czr;

public String getCzr() {
return czr;
}

public void setCzr(String czr) {
this.czr = czr;
}

public String getDsrmc() {
return dsrmc;
}

public void setDsrmc(String dsrmc) {
this.dsrmc = dsrmc;
}

public String getYlspcx() {
return ylspcx;
}

public void setYlspcx(String ylspcx) {
this.ylspcx = ylspcx;
}

public String getYlah() {
return ylah;
}

public void setYlah(String ylah) {
this.ylah = ylah;
}

public String getYllarq() {
return yllarq;
}

public void setYllarq(String yllarq) {
this.yllarq = yllarq;
}

public String getYlyjarq() {
return ylyjarq;
}

public void setYlyjarq(String ylyjarq) {
this.ylyjarq = ylyjarq;
}

public String getYlajfl() {
return ylajfl;
}

public void setYlajfl(String ylajfl) {
this.ylajfl = ylajfl;
}

public String getYllaay() {
return yllaay;
}

public void setYllaay(String yllaay) {
this.yllaay = yllaay;
}

public String getYlayzs() {
return ylayzs;
}

public void setYlayzs(String ylayzs) {
this.ylayzs = ylayzs;
}

public String getYlssbd() {
return ylssbd;
}

public void setYlssbd(String ylssbd) {
this.ylssbd = ylssbd;
}

public String getYlyjssf() {
return ylyjssf;
}

public void setYlyjssf(String ylyjssf) {
this.ylyjssf = ylyjssf;
}

public String getYljmqk() {
return yljmqk;
}

public void setYljmqk(String yljmqk) {
this.yljmqk = yljmqk;
}

public String getYlajsj() {
return ylajsj;
}

public void setYlajsj(String ylajsj) {
this.ylajsj = ylajsj;
}

public String getYlajcs() {
return ylajcs;
}

public void setYlajcs(String ylajcs) {
this.ylajcs = ylajcs;
}

public String getYllar() {
return yllar;
}

public void setYllar(String yllar) {
this.yllar = yllar;
}

public String getYlcbbm() {
return ylcbbm;
}

public void setYlcbbm(String ylcbbm) {
this.ylcbbm = ylcbbm;
}

public String getYlzsfg() {
return ylzsfg;
}

public void setYlzsfg(String ylzsfg) {
this.ylzsfg = ylzsfg;
}

public String getYlspz() {
return ylspz;
}

public void setYlspz(String ylspz) {
this.ylspz = ylspz;
}

public String getYlqthytcy() {
return ylqthytcy;
}

public void setYlqthytcy(String ylqthytcy) {
this.ylqthytcy = ylqthytcy;
}

public String getYlsjy() {
return ylsjy;
}

public void setYlsjy(String ylsjy) {
this.ylsjy = ylsjy;
}

public String getYlktft() {
return ylktft;
}

public void setYlktft(String ylktft) {
this.ylktft = ylktft;
}

public String getYlyjkssj() {
return ylyjkssj;
}

public void setYlyjkssj(String ylyjkssj) {
this.ylyjkssj = ylyjkssj;
}

public String getYlyjjssj() {
return ylyjjssj;
}

public void setYlyjjssj(String ylyjjssj) {
this.ylyjjssj = ylyjjssj;
}

public String getYltsbly() {
return yltsbly;
}

public void setYltsbly(String yltsbly) {
this.yltsbly = yltsbly;
}

public String getYlgkkt() {
return ylgkkt;
}

public void setYlgkkt(String ylgkkt) {
this.ylgkkt = ylgkkt;
}

public String getYlftyt() {
return ylftyt;
}

public void setYlftyt(String ylftyt) {
this.ylftyt = ylftyt;
}

public String getYltc() {
return yltc;
}

public void setYltc(String yltc) {
this.yltc = yltc;
}

public String getYlqtcyry() {
return ylqtcyry;
}

public void setYlqtcyry(String ylqtcyry) {
this.ylqtcyry = ylqtcyry;
}

public String getYlbz() {
return ylbz;
}

public void setYlbz(String ylbz) {
this.ylbz = ylbz;
}

public String getYlpqfgxm() {
return ylpqfgxm;
}

public void setYlpqfgxm(String ylpqfgxm) {
this.ylpqfgxm = ylpqfgxm;
}

public String getYlpqsj() {
return ylpqsj;
}

public void setYlpqsj(String ylpqsj) {
this.ylpqsj = ylpqsj;
}

public String getYlpqfs() {
return ylpqfs;
}

public void setYlpqfs(String ylpqfs) {
this.ylpqfs = ylpqfs;
}

public String getYlpqlx() {
return ylpqlx;
}

public void setYlpqlx(String ylpqlx) {
this.ylpqlx = ylpqlx;
}

public String getSfcp() {
return sfcp == null ? "0" : sfcp;
}

public void setSfcp(String sfcp) {
this.sfcp = sfcp;
}

public List getDsr() {
return dsrs;
}

public void setDsrs(List dsrs) {
this.dsrs = dsrs;
}

public String getDsrstr() {
if (dsrs != null) {
this.dsrstr = "";
for (int i = 0; i < dsrs.size(); i++) {
Dsrxx dsrxx = (Dsrxx) dsrs.get(i);
this.dsrstr += "【"
+ Dict.getInstance().getDMMC(this.ajlb, this.spcxdm,
"2", dsrxx.getSsdw()) + "：" + dsrxx.getDsrmc()
+ "】";
}
}
return dsrstr;
}

public void setDsrstr(String dsrstr) {
this.dsrstr = dsrstr;
}

public List getDsrs() {
return dsrs;
}

public String getYsfy() {
return ysfy;
}

public void setYsfy(String ysfy) {
this.ysfy = ysfy;
}

public String getYsah() {
return ysah;
}

public void setYsah(String ysah) {
this.ysah = ysah;
}

public String getCbrxm() {
return cbrxm;
}

public void setCbrxm(String cbrxm) {
this.cbrxm = cbrxm;
}

public String getSycx() {
return sycx;
}

public void setSycx(String sycx) {
this.sycx = sycx;
}

public String getSfda() {
return sfda;
}

public void setSfda(String sfda) {
this.sfda = sfda;
}

public String getSfya() {
return sfya;
}

public void setSfya(String sfya) {
this.sfya = sfya;
}

public String getSfsx() {
return sfsx;
}

public void setSfsx(String sfsx) {
this.sfsx = sfsx;
}

public String getXlabh() {
return xlabh;
}

public void setXlabh(String xlabh) {
this.xlabh = xlabh;
}

public String getAjly() {
return ajly;
}

public void setAjly(String ajly) {
this.ajly = ajly;
}

public String getAjsj() {
return ajsj;
}

public void setAjsj(String ajsj) {
this.ajsj = ajsj;
}

public String getSxdqr() {
return sxdqr;
}

public void setSxdqr(String sxdqr) {
this.sxdqr = sxdqr;
}

public String getLczt() {
return lczt;
}

public void setLczt(String lczt) {
this.lczt = lczt;
}

public String getSpcxdm() {
return spcxdm;
}

public void setSpcxdm(String spcxdm) {
this.spcxdm = spcxdm;
}

public String getSysx() {
return sysx;
}

public void setSysx(String sysx) {
this.sysx = sysx;
}

public String getCbr() {
return cbr;
}

public void setCbr(String cbr) {
this.cbr = cbr;
}

public String getBmdm() {
return bmdm;
}

public void setBmdm(String bmdm) {
this.bmdm = bmdm;
}

public String getZh() {
return zh;
}

public void setZh(String zh) {
this.zh = zh;
}

public Integer getXh() {
return xh;
}

public void setXh(Integer xh) {
this.xh = xh;
}

public String getLaay() {
if (this.ayzs1 != null && (!"".equals(this.ayzs1))) {
return this.ayzs1;
} else
return laay;
}

public void setLaay(String laay) {
this.laay = laay;
}

public String getFjm() {
return fjm;
}

public void setFjm(String fjm) {
this.fjm = fjm;
}

public String getBz() {
// return bz;
return Icons.getSelf().getIcons(fjm, ajid, ajlb, spcxdm, sfsx, sxdqr,
xlabh, sfdb, ajly, ajsj, sfda, sfya, sjraj);
}

public void setBz(String bz) {
this.bz = bz;
}

public String getCbbm() {
return cbbm;
}

public void setCbbm(String cbbm) {
this.cbbm = cbbm;
}

public String getAjid() {
return ajid;
}

public void setAjid(String ajid) {
this.ajid = ajid;
}

public String getAjlb() {
return ajlb;
}

public void setAjlb(String ajlb) {
this.ajlb = ajlb;
}

public String getAh() {
return ah;
}

public void setAh(String ah) {
this.ah = ah;
}

public String getSpcx() {
return spcx;
}

public void setSpcx(String spcx) {
this.spcx = spcx;
}

public String getLarq() {
return larq;
}

public void setLarq(String larq) {
this.larq = larq;
}

public String getLar() {
return lar;
}

public void setLar(String lar) {
this.lar = lar;
}

public String getSfdb() {
return sfdb;
}

public void setSfdb(String sfdb) {
this.sfdb = sfdb;
}

public String getStatus(ApplicationContext context) {
IIbatisDAO dao = (IIbatisDAO) context.getBean("ibatisDAO");
JSONObject retJson = new JSONObject();
retJson.put("res", "true");
retJson.put("mode", 0);
List list = (List) dao.query("Ccpq.getZdpqxx", this);
int i, len = list.size();
JSONArray retList = new JSONArray();
for (i = len - 1; i >= 0; i--) {
Ccpq ccpq = (Ccpq) list.get(i);
JSONArray al = new JSONArray();
al.put(ccpq.getZh());
al.put(ccpq.getAjid());
al.put(ccpq.getAh());
retList.put(al);
}
retJson.put("data", retList);
return retJson.toString();
}

public String getHytxx(ApplicationContext context) {
IIbatisDAO dao = (IIbatisDAO) context.getBean("ibatisDAO");
JSONObject retJson = new JSONObject();
retJson.put("res", "true");
retJson.put("mode", 0);
JSONArray obj = new JSONArray();
Hytcy hytcy = new Hytcy();
hytcy.setFjm(this.getFjm());
hytcy.setZybm(this.getZh());
try {
obj.put(this.pack(dao.query("Hytsz.getHytcyxx", hytcy)));
} catch (SecurityException e) {
e.printStackTrace();
} catch (IllegalArgumentException e) {
e.printStackTrace();
} catch (NoSuchMethodException e) {
e.printStackTrace();
} catch (IllegalAccessException e) {
e.printStackTrace();
} catch (InvocationTargetException e) {
e.printStackTrace();
}
retJson.put("data", obj);
return retJson.toString();
}

public String getFtxx(ApplicationContext context) {


//自动预订法庭时间
IIbatisDAO dao = (IIbatisDAO) context.getBean("ibatisDAO");

JSONObject retJson = new JSONObject();

HashMap map = new HashMap();
map.put("fjm", this.getFjm());
map.put("bmdm", this.getCbbm());
List list = dao.query("Bmfasz.getBmft", map);

JSONArray obj = new JSONArray();
int scktqx = 0;
// 首次开庭期限使用错误 lijf modify
/*
* if (this.getSysx() == null || this.getSysx().equals("")) {
*
* } else { if (dao.query("Ccpq.getScktqx", this).get(0) != null) scktqx
* = ((Integer) dao.query("Ccpq.getScktqx", this).get(0)) .intValue(); }
*/
Integer tmp = (Integer) dao.query("Ccpq.getScktqx", this).get(0);
if (tmp != null) {
scktqx = tmp.intValue();
}
java.util.Calendar calendar = java.util.Calendar.getInstance();
java.text.SimpleDateFormat sdf = new java.text.SimpleDateFormat(
"yyyy-MM-dd");
int i, len = list.size(), j;
Bmft bmft;
Pqxx pqxx = new Pqxx();
Pqxx qtpqxx = new Pqxx();
qtpqxx.setFjm(this.getFjm());
pqxx.setFjm(this.getFjm());
String rq;
boolean rt = false;
boolean zjjh = false;// 证据交换法庭使用标示
String zjjhFtbh = "";
String zjjhFtkssj = "";
String zjjhFtjssj = "";
Dict dict = Dict.getInstance();
String ktsjsz = dict.getSetupInfo(this.getFjm(), "ktsjsz");
String[] sjArr = ktsjsz.split(",");
String sjq1 = "08:50:00", sjz1 = "12:00:00", sjq2 = "14:30:00", sjz2 = "17:30:00";
if (sjArr.length < 2) {

} else {
String[] sj = sjArr[0].split("-");
sjq1 = sj[0];
sjz1 = sj[1];
sj = sjArr[1].split("-");
sjq2 = sj[0];
sjz2 = sj[1];
}
SimpleDateFormat dateFormat = new SimpleDateFormat("yyyy-MM-dd HH:mm:ss");
String hehe1 = dateFormat.format(calendar.getTime());
calendar.add(java.util.Calendar.DATE, scktqx);
calendar.clear(Calendar.HOUR);
calendar.clear(Calendar.MINUTE);
calendar.clear(Calendar.SECOND);
calendar.clear(Calendar.MILLISECOND);

String hehe2 = dateFormat.format(calendar.getTime());
// 获得法官的中止分案时间段
List zzlist = null;
Date zzksrq, zzjsrq;
if (cbr != null) {
cbr = cbr.replaceFirst(":.*", "");
Map tmpMap = new HashMap();
tmpMap.put("CBFY", fjm);
tmpMap.put("CBBM", cbbm);
tmpMap.put("CBR", cbr);
zzlist = dao.query("Ccpq.getZzfad", tmpMap);
}

/**
* 排法庭思路：先获取排法庭的开庭日期，接着从第一天开始， 先找一个可以办此案子的法庭，从上午开始排，校验这个法庭
* 是否已开庭，如果没有开庭记录，再校验这个时间段承办人（可能加书记员） 是否在别的法庭有开庭记录，如果也没有则法庭排成功，否则排下午，
* 如果该法庭该天校验不通过，则寻找其他法庭该提天是否合适，如果所有法庭 都不合适，则寻找第二天是否合适... lijf add
* 20100207
*/
for (j = 0; j < 1000; j++) {
calendar.add(java.util.Calendar.DATE, 1);
if (zzlist != null && zzlist.size() > 0) {
boolean sfzz = false;
for (int zz = 0; zz < zzlist.size(); zz++) {
zzksrq = (Date) ((Map) zzlist.get(zz)).get("ZZKSRQ");
zzjsrq = (Date) ((Map) zzlist.get(zz)).get("ZZJSRQ");
if (calendar.getTime().after(zzksrq)) {// 是否过了中止开始日期
if (calendar.getTime().after(zzjsrq)) {// 是否过了中止结束日期，则清除此条中止
zzlist.remove(zz);
zz--;
} else {
sfzz = true;
break;
}
}
}
if (sfzz) {
continue;
} else {
// 跳过中止的最后一天
calendar.add(java.util.Calendar.DATE, 1);
}
}
if (((Integer) dao.query("kqgl.getSfjjr",
sdf.format(calendar.getTime())).get(0)).intValue() > 0) {
continue;
}
rq = sdf.format(calendar.getTime());
/*
* 老写法，没校验承办人是否在其他法庭开庭 for (i = 0; i < len; i++) { bmft = (Bmft)
* list.get(i); pqxx.setFtbh(bmft.getFtdm().toString());
* pqxx.setYjkssj(rq + " " + sjq1); pqxx.setYjjssj(rq + " " + sjz1);
* if (((Integer) dao.query("Pqxx.getKtxx", pqxx).get(0))
* .intValue() > 0) { pqxx.setYjkssj(rq + " " + sjq2);
* pqxx.setYjjssj(rq + " " + sjz2); if (((Integer)
* dao.query("Pqxx.getKtxx", pqxx).get(0)) .intValue() > 0) {
* continue; } else { rt = true; break; }
*
* } else { rt = true; break; }
*
* }
*/
for (i = 0; i < len; i++) {
bmft = (Bmft) list.get(i);
pqxx.setFtbh(bmft.getFtdm().toString());
pqxx.setYjkssj(rq + " " + sjq1);
pqxx.setYjjssj(rq + " " + sjz1);
qtpqxx.setFtbh(bmft.getCode());
qtpqxx.setYjkssj(rq + " " + sjq1);
qtpqxx.setYjjssj(rq + " " + sjz1);
boolean tflag = true;
/* 深圳地区老系统冲突校验 */
tflag = getFtztFromQt(dao, qtpqxx);
if ((((Integer) dao.query("Pqxx.getKtxx", pqxx).get(0))
.intValue() == 0)
&& tflag) {
// 上午没开庭，校验承办人及书记员是否在别的法庭在此时间开庭
pqxx.setHytcy(this.getHytcy());
if (((Integer) dao.query("Pqxx.doCheck", pqxx).get(0))
.intValue() == 0) {
rt = true;
break;
} else {
// 上午校验不通过则找下午
pqxx.setYjkssj(rq + " " + sjq2);
pqxx.setYjjssj(rq + " " + sjz2);

qtpqxx.setYjkssj(rq + " " + sjq2);
qtpqxx.setYjjssj(rq + " " + sjz2);
tflag = getFtztFromQt(dao, qtpqxx);
if (((Integer) dao.query("Pqxx.getKtxx", pqxx).get(0))
.intValue() == 0
&& tflag) {
pqxx.setHytcy(this.getHytcy());
if (((Integer) dao.query("Pqxx.doCheck", pqxx).get(
0)).intValue() == 0) {
rt = true;
break;
} else {
continue;
}
} else {
continue;
}
}
} else {
pqxx.setYjkssj(rq + " " + sjq2);
pqxx.setYjjssj(rq + " " + sjz2);

qtpqxx.setYjkssj(rq + " " + sjq2);
qtpqxx.setYjjssj(rq + " " + sjz2);
tflag = getFtztFromQt(dao, qtpqxx);
if (((Integer) dao.query("Pqxx.getKtxx", pqxx).get(0))
.intValue() == 0
&& tflag) {
pqxx.setHytcy(this.getHytcy());
if (((Integer) dao.query("Pqxx.doCheck", pqxx).get(0))
.intValue() == 0) {
rt = true;
break;
} else {
continue;
}
} else {
continue;
}
}
}
String pqsfkqzjjh = Dict.getInstance().getSetupInfo(this.getFjm(),
"pqsfkqzjjh");
if (rt
&& ("2".equals(this.ajlb) || ("1".equals(pqsfkqzjjh) && "6"
.equals(this.ajlb))) && "1".equals(this.spcxdm)
&& zjjh == false && "1".equals(this.sfpzjjhft)) {
zjjhFtbh = pqxx.getFtbh();
zjjhFtkssj = pqxx.getYjkssj();
zjjhFtjssj = pqxx.getYjjssj();
zjjh = true;
calendar.add(java.util.Calendar.DATE, 7);
continue;
} else if (rt) {
break;
}

}
if (rt) {
obj.put(pqxx.getFtbh());
obj.put(pqxx.getYjkssj());
obj.put(pqxx.getYjjssj());
if (!"".equals(zjjhFtkssj)) {
obj.put(zjjhFtbh);
obj.put(zjjhFtkssj);
obj.put(zjjhFtjssj);
}
} else {
obj.put("");
obj.put("");
obj.put("");
}
retJson.put("res", "true");
retJson.put("mode", 0);
retJson.put("data", obj);
return retJson.toString();
}

/**
* 从其他库中获得开庭的状态
*
* @return true 表示法庭可以使用没有被占用
*/
public static boolean getFtztFromQt(IIbatisDAO dao, Pqxx pqxx) {
if (Tsxx.checkCourt(pqxx.getFjm())) {
if (pqxx == null || pqxx.getFtbh() == null) {
return true;
}
// 获得深圳中院提供的排期数据库连接
Map map = new HashMap();
map.put("qtftdm", pqxx.getFtbh());
map.put("fjm", pqxx.getFjm());
map.put("kssj", Tsxx.handlerDateTime(pqxx.getYjkssj()));
map.put("jssj", Tsxx.handlerDateTime(pqxx.getYjjssj()));
Ftsyqk ftsyqk = new Ftsyqk();
// List rslist = dao.query("Ftsyqk.getFtsyqkForSz", map);
List rslist = ftsyqk.executeSql(ftsyqk.getTempSql(map,
"Ftsyqk.getFtsyqkForSz"));
if (rslist.size() > 0) {
return false;
} else {
return true;
}
} else {
return true;
}

}

/**
* 返回结果数组各项的含意： 0：排出的适合办案的合议庭成员 7：可办理此案件的主审法官 8：已经请假的主审法官 9：已达限制分案数的主审法官
* 10：优先分案的主审法官 15：系列案的总数 16：此案件是否为发回重审案件--1为是，0为否
* 19：当无法找出适合办此类案件的合议庭时，返回原因，提示给用户 20：当为刑事重审案件时，适回原案件审判合庭成员 21：返回没有配置合议庭的法官
* 22：返回辖区 23：返回分案日志 24：返回承办部门名称 25：返回承办部门代码 26: 配置使用的法庭 27: 是否行政非诉审查程序
*
* @param context
* @return
*/
public String getCbrResult(ApplicationContext context) {
IIbatisDAO dao = (IIbatisDAO) context.getBean("ibatisDAO");
JSONObject retJson = new JSONObject();
retJson.put("res", "true");
retJson.put("mode", 0);
JSONArray obj = new JSONArray();
java.util.HashMap map = new java.util.HashMap();
int i, len;
this.farz = new StringBuffer();
//TODO:首先根据案件ID从数库中查出与自动分案相关的案件信息
List list = (List) dao.query("Ccpq.getAjxx", this.getAjid());
len = list.size();
for (i = 0; i < len; i++) {
map = (java.util.HashMap) list.get(i);
}
Integer falx = Integer.valueOf("0"), cabz = Integer.valueOf("0");
String falxmc = "", ajlx = "";
map.put("AJID", this.getAjid());
map.put("FALX", falx);
map.put("FALXMC", falxmc);
map.put("CABZ", cabz);
map.put("AJLX", ajlx);
//TODO:根据案件ID查询案件的分案类型
dao.update("Pqxx.getFalx", map);
falx = (Integer) map.get("FALX");
cabz = (Integer) map.get("CABZ");

obj.put(27, map.get("XZFSSCCX"));
HashMap tmp;
String cbbm = "";
String strTmp = "";
boolean sfajfl = false;// 是否案件分流
int ajfl_falx = 3;
//TODO:判断当前案件是否属于分流案件
List ajfList = dao.query("Ccpq.getAjflxx", map);
if (ajfList.size() > 0) {
tmp = (HashMap) ajfList.get(0);
String flzh = (String) tmp.get("FLZH");// 分流字号
String flbl = (String) tmp.get("FLBL");// 分流比例
String flbm = "," + (String) tmp.get("FLBM") + ",";// 分流部门
String[] flbmArr = ((String) tmp.get("FLBM")).split(",");
String[] flblArr = flbl == null ? new String[0] : flbl.split(",");
int cbl = 0;
if (flblArr.length != 0) {
for (i = 0; i < flblArr.length; i++) {
cbl += Integer.parseInt(flblArr[i]);
}
} else {
cbl = flbmArr.length;
}
String tmpStr = "";
String flbmstr = "";
for (i = 0; i < flbmArr.length; i++) {
int i_flbl = 1;
if (flblArr.length != 0) {
i_flbl = Integer.parseInt(flblArr[i]);
}

if ("".equals(tmpStr)) {
tmpStr = " select '" + flbmArr[i] + "' BMDM, dec(("
+ i_flbl + " * 1.0) / " + cbl
+ ",10,2) FLBL from (values(1)) ";
} else {
tmpStr += "union all select '" + flbmArr[i]
+ "' BMDM, dec((" + i_flbl + " * 1.0) / " + cbl
+ ",10,2) FLBL from (values(1)) ";
}
if (i == flbmArr.length - 1) {
flbmstr += "'" + flbmArr[i] + "'";
} else {
flbmstr += "'" + flbmArr[i] + "',";
}
}

String flksrq = DateTools.format((Date) tmp.get("FLKSRQ"),
DateTools.FORMAT_DAY);// 分流开始日期
ajfl_falx = ((Integer) tmp.get("FALX")).intValue();
this.addrz((String) tmp.get("BZ"));


if ("6120".equals(map.get("ZH").toString())) {// 判断案件是否属于不允许分给原承办部门的案件
ajfList = dao.query("Ccpq.getYajjbxx", map);// 获得原审案件信息
if (ajfList.size() > 0) {
String ycbbm = (String) ((Map) ajfList.get(0)).get("YCBBM");// 原承办部门
// String yajid = (String)tmp.get("yajid");//原承办部门
flbm = flbm.replaceAll("," + ycbbm + ",", ",");
this.addrz("当前案件<B>"
    + map.get("AH")
    + "</B>是不允许分给原审承办部门<B>"
    + Dict.getInstance().getAllBmDictMc(this.fjm,
    ycbbm, "bmjc") + "</B>");
if (",".equals(flbm)) {
this.addrz("没有可分流当前案件的承办部门，请与系统管理员联系！");
obj.put(19, this.farz.toString());
retJson.put("data", obj);
return retJson.toString();
}
}
}
String flajsfdqgcry = Dict.getInstance().getSetupInfo(fjm, "flajsfdqgcry");//分流案件时是否确定到法官

if ("2".equals(flajsfdqgcry)) {
tmp = new HashMap();
tmp.put("FJM", this.fjm);
tmp.put("FLZH", flzh);
tmp.put("FLBM", flbm);
tmp.put("FLKSRQ", flksrq);
tmp.put("TMPSQL", tmpStr);

ajfList = dao.query("Ccpq.getFlajsl", tmp);// 统计分流案件分案数量
for (i = 0; i < ajfList.size(); i++) {
tmp = (HashMap) ajfList.get(i);

if (i == 0) {// 排在第一个的为当前案件承办部门
cbbm = (String) tmp.get("CBBM");
map.put("BMDM", cbbm);
map.put("CBBM", cbbm);
map.put("SFPCFT", tmp.get("SFPCFT"));
}
strTmp += "、<B>"
    + Dict.getInstance().getAllBmDictMc(this.fjm,
    (String) tmp.get("CBBM"), "bmjc") + "("
    + tmp.get("FXLA") + "+" + tmp.get("XLA") + ":"
    + tmp.get("NUM") + ")</B>";
}
this.addrz("分流当前案件的部门案件分流情况(非系列案+系列案:分流比重)：" + strTmp.substring(1));
sfajfl = true;
} else {
map.put("FLBMDM", flbmstr);
if (map.get("BMDM") != null) {
cbbm = map.get("BMDM").toString();
map.put("CBBM", cbbm);
} else {
obj.put(19, "案件数据有问题，承办部门为空，请与系统管理员联系！");
retJson.put("data", obj);
return retJson.toString();
}
}
} else {
if (map.get("BMDM") != null) {
cbbm = map.get("BMDM").toString();
map.put("CBBM", cbbm);
} else {
obj.put(19, "案件数据有问题，承办部门为空，请与系统管理员联系！");
retJson.put("data", obj);
return retJson.toString();
}
}

map.put("BMMC", Dict.getInstance().getAllBmDictMc(this.fjm, cbbm,
"bmjc"));

strTmp = "";
String strTmp2 = "";
String zybm;
Kfafgxx kfafs;
List retList = new ArrayList();
HashMap hm, o = null;
List zzxxList = null, kqxxList = null;

int fafs = 255, fajs = 1;
String tscl = "1";
if (sfajfl) {// 是否案件分流
fafs = ajfl_falx;
if (fafs == 3) {// 平均分流
fajs = 999;// 指定本部本能分这类案件的，都包含在内
} else {
list = (List) dao.query("Ccpq.getBmfafs", map);
len = list.size();
if (len == 1) {
fajs = ((Integer) ((HashMap) list.get(0)).get("FAJS"))
.intValue();
tscl = ((String) ((HashMap) list.get(0)).get("TSCL"));
}
}
} else {
// 获得部门分案方式
list = (List) dao.query("Ccpq.getBmfafs", map);
len = list.size();
if (len == 1) {
fafs = ((Integer) ((HashMap) list.get(0)).get("FAFS"))
.intValue();
fajs = ((Integer) ((HashMap) list.get(0)).get("FAJS"))
.intValue();
tscl = ((String) ((HashMap) list.get(0)).get("TSCL"));
}
}
map.put("TSCL", tscl);

Calendar cal = Calendar.getInstance();
cal.add(Calendar.YEAR, -10);
cal.clear(Calendar.HOUR);
cal.clear(Calendar.MINUTE);
cal.clear(Calendar.SECOND);
cal.clear(Calendar.MILLISECOND);
currDate = cal.getTime();
// 获得本部门每一个法官的最后结案日期
if ("1".equals(tscl)) {// 特殊处理，当法官各数值都相同时，优先分给最早案件签发的法官
list = (List) dao.query("Ccpq.getMaxJarq", map);
} else if ("2".equals(tscl)) {// 特殊处理，当法官各数值都相同时，优先分给立案时间最早的法官
list = (List) dao.query("Ccpq.getMaxLarq", map);
}
java.util.HashMap t;
Map maxJarq = new HashMap();
len = list.size();
for (i = 0; i < len; i++) {
t = (HashMap) list.get(i);
maxJarq.put(t.get("CBFG"), t.get("JARQ"));
}
String caqsrq = Dict.getInstance()//存案起始时间
.getSetupInfo(this.getFjm(), "caqsrq");
map.put("CAQSRQ", caqsrq);
// 得到所有存案信息,并按承办人进行分组
java.util.HashMap caMap = new java.util.HashMap();
list = (List) dao.query("Ccpq.getCaxx", map);
len = list.size();
List ht;
for (i = 0; i < len; i++) {
t = (HashMap) list.get(i);
ht = (ArrayList) caMap.get(t.get("CBR"));
if (ht == null)
ht = new ArrayList();
ht.add(t);
caMap.put(t.get("CBR"), ht);
}

map.put("bmdm_dm", cbbm);
// 判断承办部门,如果承办部门为空,则从配置表中,找出所有可以办此案件字号的承办部门
// if (cbbm.equals("")) {
// map.put("fjm", map.get("cbfy"));
// map.put("zhdm", map.get("zh"));
// list = (List) dao.query("Ccpq.getCbbmxx", map);
// len = list.size();
// for (i = 0; i < len; i++) {
// if (i == len - 1)
// cbbm += "'" + ((java.util.HashMap) list.get(i)).get("dm")
// + "'";
// else
// cbbm += "'" + ((java.util.HashMap) list.get(i)).get("dm")
// + "',";
// }
// } else {
cbbm = "'" + cbbm + "'";
// }
map.put("BMDM", cbbm);

String yscbr = null, yscbrxm = null;
if ("1".equals(map.get("SFPCFT"))) {// 如果为派出法庭，
// 如果当前案件为执行普通执行案件，执行依据
if ("8".equals(map.get("AJLB").toString())
&& "1".equals(map.get("SPCX").toString())) {
List yscbrlist = dao.query("Ccpq.getyscbr", map);
if (yscbrlist.size() > 0) {
t = (HashMap) yscbrlist.get(0);
yscbr = (String) t.get("CBR");
yscbrxm = (String) t.get("CBRXM");
map.put("YSCBR", yscbr);
this.addrz("外派法庭执行案件不允许分案给原审判案件承办人：<B>" + yscbrxm + "</B>");
}
}
}

Integer xlaxh = (Integer) map.get("XLABH");
if (xlaxh.intValue() > 0) {
// 系列案件总数
obj.put(15, (Integer) dao.query("Ccpq.getXlaxxCount", map).get(0));
}
String spzfz = Dict.getInstance().getSetupInfo(fjm, "spzfz");
map.put("SPZFZ", spzfz);

List spzcylist = null;
Map spzcy = new HashMap();

if ("1".equals(spzfz)) {
this.addrz("启用审判长负责方式进行自动排期处理");
spzcylist = (List) dao.query("Ccpq.getSpzcy", map);
len = spzcylist.size();
for (i = 0; i < len; i++) {
tmp = (HashMap) spzcylist.get(i);
String spz = (String) tmp.get("SPZ");
List arrL = (List) spzcy.get(spz);
if (arrL == null) {
arrL = new ArrayList();
spzcy.put(spz, arrL);
arrL.add(spz);
}
arrL.add(tmp.get("ZYBM"));
}
}

List yxpq = new ArrayList();
boolean tsajyqcl = false;// 提审案件是否优先处理
Map pzMap = new HashMap();
pzMap.put("fjm", this.fjm);
pzMap.put("bmdm", map.get("bmdm_dm"));
// pzMap.put("pzx", "tsajpqsz");
List pzList = dao.query("Bmfasz.getTsfaszByPzx", pzMap);
pzMap.clear();
for (int idpz = 0; idpz < pzList.size(); idpz++) {
Map tmpMap = (Map) pzList.get(idpz);
pzMap.put(tmpMap.get("PZX"), tmpMap.get("PZZ"));
}
String tsajpqsz = "3";
if (pzMap != null && pzMap.size() > 0) {
tsajpqsz = (String) pzMap.get("tsajpqsz");
}

String eszsxlapz = "2";
if (pzMap != null && pzMap.size() > 0) {
eszsxlapz = (String) pzMap.get("eszsxlapz");
}
String zskstscl = "2";
if (pzMap != null && pzMap.size() > 0) {
zskstscl = (String) pzMap.get("zskstscl");
}
//是否组成五人合议庭
String zc5rhytscl = "3";
boolean need5rhyt = false;
if (pzMap != null && pzMap.size() > 0) {
zc5rhytscl = (String) pzMap.get("zc5rhytscl");
}
if (("1".equals(zc5rhytscl) || "2".equals(zc5rhytscl))) {
//
String zc5rsql = "";
if (pzMap != null && pzMap.size() > 0) {
zc5rsql = (String) pzMap.get("zc5rsql");
}
map.put("ZC5RSQL", zc5rsql);
List need5rhytch = dao.query("Ccpq.checkSfzc5rhyt", map);
if ((Integer) need5rhytch.get(0) > 0) {
need5rhyt = true;
}
if (need5rhyt) {
//在原来的合议庭增加2人
if ("1".equals(zc5rhytscl)) {
map.put("NEED5RHYT", "ADD2R");
} else {
//全部重新组成
map.put("NEED5RHYT", "ALL");
}
}
}
//是否配置固定审判组织
String sxksajgdspz = "2";
if (pzMap != null && pzMap.size() > 0) {
sxksajgdspz = (String) pzMap.get("sxksajgdspz");
}

if ("1".equals(sxksajgdspz) && "2".equals(map.get("SPCX")) && "1".equals(map.get("AJLB"))) {
if ("1".equals(map.get("SFSXAJ")) || "102".equals(map.get("AJLY"))) {
map.put("GDSPZZ", true);
} else {
map.put("GDSPZZ", false);
}
} else {
map.put("GDSPZZ", false);
}


List zsszcbr = new ArrayList();
String bmhycy = null;
String dlhycy = null;
boolean zskstscltj = ("1".equals(zskstscl) && !"8".equals(map.get("AJLB")) && "3".equals(map.get("SPCX")) && !"204".equals(map.get("AJLY")));//这个是非抗诉的案件。。
//TODO 针对提审的再审案件，优先分派给原再审审查承办法官办理
if ((!"3".equals(tsajpqsz)
&& !"8".equals(map.get("AJLB"))
&& "3".equals(map.get("SPCX"))
&& ("202".equals(map.get("AJLY")) || "212".equals(map
.get("AJLY")) || ("2".equals(map.get("AJLB")) && "2".equals(map.get("ZSFS"))))) || zskstscltj) {
if (zskstscltj) {
map.put("FKSAJ", "FKSAJ");
}
list = (List) dao.query("Ccpq.getTsajYcbr", map);
if (list.size() != 0) {
for (int idx = 0; idx < list.size(); idx++) {
tmp = (HashMap) list.get(idx);
zybm = tmp.get("ZYBM").toString();
String xm = tmp.get("XM").toString();
String zzfa = tmp.get("ZZFA").toString();
if (map.get("bmdm_dm").equals(tmp.get("BM"))) {//是本部门人员
if (bmhycy == null) {
bmhycy = xm;
} else {
bmhycy += "、" + xm;
}
if ("2".equals(tsajpqsz)) {
zsszcbr.add(tmp);
continue;
} else if (!"0".equals(zzfa)) {//如果存在中止分案信息，则不能分案给此法官
bmhycy += "(中止)";

if (dlhycy == null) {
dlhycy = xm + "(中止)";
} else {
dlhycy += "、" + xm + "(中止)";
}
continue;
}
tmp.put("FABL", new Double(((BigDecimal) tmp
.get("FABL")).doubleValue()));
kfafs = new Kfafgxx();
kfafs.setZybm(zybm);
if ("1".equals(spzfz)) {
List arrL = (List) spzcy.get(zybm);
for (int zyi = 0; zyi < arrL.size(); zyi++) {
String tmpZybm = (String) arrL.get(zyi);
getCaxx(caMap, tmpZybm, tmp, maxJarq);
}
} else {
getCaxx(caMap, zybm, tmp, maxJarq);
}

kfafs.setXm(tmp.get("XM").toString());
kfafs.setPaxh(tmp.get("PAXH").toString());
kfafs.setFajs(tmp.get("FAJS").toString());
kfafs.setCasl(tmp.get("CASL").toString());
kfafs.setFabl(tmp.get("FABL").toString());
yxpq.add(tmp);
retList.add(kfafs);
tsajyqcl = true;
} else {
if (!"0".equals(zzfa)) {
xm += "(中止)";
}
if (bmhycy == null) {
bmhycy = xm + "(非本部门)";
} else {
bmhycy += "、" + xm + "(非本部门)";
}
if (dlhycy == null) {
dlhycy = xm;
} else {
dlhycy += "、" + xm;
}
}
}


if ("1".equals(tsajpqsz) || zskstscltj) {
if (retList.size() > 0 && (tsajyqcl || zskstscltj)) {
try {
// 优先分案法官信息
obj.put(10, this.pack(retList));
} catch (Exception e) {
e.printStackTrace();
}
retList.clear();
try {
obj.put(8, this.pack(retList));
} catch (Exception e) {
e.printStackTrace();
}
try {
obj.put(9, this.pack(retList));
} catch (Exception e) {
e.printStackTrace();
}
strTmp = "找到当前提审案件的原审查案件合议庭成员“<B>" + bmhycy
    + "</B>”，案件优化分派给本部门的这些法官";
tsajyqcl = true;
} else {
strTmp = "找到当前提审案件的原审查案件合议庭成员“<B>" + dlhycy
    + "</B>”都已经中止或调离当前部门，继续自动分案";
}
}
} else {
strTmp = "未找到当前提审案件的原审查案件承办人，继续自动分案";
}
} else if ("1".equals(eszsxlapz) && !"8".equals(map.get("AJLB"))
&& ("3".equals(map.get("SPCX")) || "2".equals(map.get("SPCX")))) {
list = (List) dao.query("Ccpq.getYsXlaHytcy", map);
if (list.size() != 0) {
strTmp = "当前案件的原审案件为系列案，并且当前部门启用这此类案件优化分派给原承办合议庭";
this.addrz(strTmp);
strTmp = "";
for (int idx = 0; idx < list.size(); idx++) {
tmp = (HashMap) list.get(idx);
zybm = tmp.get("ZYBM").toString();
String xm = tmp.get("XM").toString();
String zzfa = tmp.get("ZZFA").toString();
if (map.get("bmdm_dm").equals(tmp.get("BM"))) {
if (bmhycy == null) {
bmhycy = xm;
} else {
bmhycy += "、" + xm;
}
if ("2".equals(tsajpqsz)) {
zsszcbr.add(tmp);
continue;
} else if (!"0".equals(zzfa)) {//如果存在中止分案信息，则不能分案给此法官
bmhycy += "(中止)";
if (dlhycy == null) {
dlhycy = xm + "(中止)";
} else {
dlhycy += "、" + xm + "(中止)";
}
continue;
}
tmp.put("FABL", new Double(((BigDecimal) tmp
.get("FABL")).doubleValue()));
kfafs = new Kfafgxx();
kfafs.setZybm(zybm);
if ("1".equals(spzfz)) {
List arrL = (List) spzcy.get(zybm);
for (int zyi = 0; zyi < arrL.size(); zyi++) {
String tmpZybm = (String) arrL.get(zyi);
getCaxx(caMap, tmpZybm, tmp, maxJarq);
}
} else {
getCaxx(caMap, zybm, tmp, maxJarq);
}

kfafs.setXm(tmp.get("XM").toString());
kfafs.setPaxh(tmp.get("PAXH").toString());
kfafs.setFajs(tmp.get("FAJS").toString());
kfafs.setCasl(tmp.get("CASL").toString());
kfafs.setFabl(tmp.get("FABL").toString());
yxpq.add(tmp);
retList.add(kfafs);
tsajyqcl = true;
} else {
if (!"0".equals(zzfa)) {
xm += "(中止)";
}
if (bmhycy == null) {
bmhycy = xm + "(非本部门)";
} else {
bmhycy += "、" + xm + "(非本部门)";
}
if (dlhycy == null) {
dlhycy = xm;
} else {
dlhycy += "、" + xm;
}
}
}

if (tsajyqcl) {
try {
// 优先分案法官信息
obj.put(10, this.pack(retList));
} catch (Exception e) {
e.printStackTrace();
}
retList.clear();
try {
obj.put(8, this.pack(retList));
} catch (Exception e) {
e.printStackTrace();
}
try {
obj.put(9, this.pack(retList));
} catch (Exception e) {
e.printStackTrace();
}
strTmp = "找到本院审理过此原审系列案案件的合议庭成员“<B>" + bmhycy
    + "</B>”，案件优化分派给本部门的这些法官";
tsajyqcl = true;
} else {
strTmp = "找到本院审理过此原审系列案案件的合议庭成员“<B>" + dlhycy
    + "</B>”都已经中止或调离当前部门，继续自动分案";
}
}
}
this.addrz(strTmp);
strTmp = "";


//是否2274访审2275访终2014-04-23增加访审和访终的字号的进行判断，根据高院的报告
//先原承办人，其次原审判长，再次原合议庭成员
boolean sfFsFzAj = "2274".equals(map.get("ZH").toString()) || "2275".equals(map.get("ZH").toString());

if (sfFsFzAj) {
String FsFzhycy = null;//所有人员
String FsFzzzhycy = null;//中止的人员
String FsFzdlcy = null;//调离的人员
list = (List) dao.query("Ccpq.getFsFzajYcbr", map);
if (list.size() != 0) {
boolean cyjsStr = true;
for (int idx = 0; idx < list.size(); idx++) {
tmp = (HashMap) list.get(idx);
zybm = tmp.get("ZYBM").toString();
String xm = tmp.get("XM").toString();
String zzfa = tmp.get("ZZFA").toString();
if (FsFzhycy == null) {
FsFzhycy = xm;
} else {
FsFzhycy += "、" + xm;
}
if (!map.get("bmdm_dm").equals(tmp.get("BM"))) {
FsFzhycy += "(调离)";
if (FsFzdlcy == null) {
FsFzdlcy = xm + "(调离)";
} else {
FsFzdlcy += "、" + xm + "(调离)";
}
}
if (!"0".equals(zzfa)) {//如果存在中止分案信息，则不能分案给此法官
FsFzhycy += "(中止)";

if (FsFzzzhycy == null) {
FsFzzzhycy = xm + "(中止)";
} else {
FsFzzzhycy += "、" + xm + "(中止)";
}
continue;
}
if (map.get("bmdm_dm").equals(tmp.get("BM"))) {//是本部门人员

if (cyjsStr) {//优先承办人
tmp.put("FABL", new Double(((BigDecimal) tmp
.get("FABL")).doubleValue()));
kfafs = new Kfafgxx();
kfafs.setZybm(zybm);
if ("1".equals(spzfz)) {
List arrL = (List) spzcy.get(zybm);
for (int zyi = 0; zyi < arrL.size(); zyi++) {
String tmpZybm = (String) arrL.get(zyi);
getCaxx(caMap, tmpZybm, tmp, maxJarq);
}
} else {
getCaxx(caMap, zybm, tmp, maxJarq);
}

kfafs.setXm(tmp.get("XM").toString());
kfafs.setPaxh(tmp.get("PAXH").toString());
kfafs.setFajs(tmp.get("FAJS").toString());
kfafs.setCasl(tmp.get("CASL").toString());
kfafs.setFabl(tmp.get("FABL").toString());
yxpq.add(tmp);
retList.add(kfafs);
//只有其他合议庭成员能全部加到优先分案中，承办人和审判长只有其中一个
if (!"99999".equals(tmp.get("PAXH").toString())) {
cyjsStr = false;
}
tsajyqcl = true;
}
}
}

if (tsajyqcl) {
try {
// 优先分案法官信息
obj.put(10, this.pack(retList));
} catch (Exception e) {
e.printStackTrace();
}
retList.clear();
try {
obj.put(8, this.pack(retList));
} catch (Exception e) {
e.printStackTrace();
}
try {
obj.put(9, this.pack(retList));
} catch (Exception e) {
e.printStackTrace();
}
strTmp = "找到当前案件的原审查案件合议庭成员“<B>" + FsFzhycy
    + "</B>”，案件优化分派给本部门的这些法官";
tsajyqcl = true;
} else {
strTmp = "找到当前案件的原审查案件合议庭成员“<B>" + FsFzhycy
    + "</B>”中" + (FsFzzzhycy != null ? FsFzzzhycy + "已经中止，" : "") + (FsFzdlcy != null ? FsFzdlcy + "已经调离部门" : "") + "，请设置后再分案";
}

} else {
strTmp = "未找到当前案件的原审查案件承办人，请设置后再分案";
}
this.addrz(strTmp);
strTmp = "";

}

if (!tsajyqcl && !sfFsFzAj) {//2014-04-23增加访审和访终的字号不要进行判断，根据高院的报告
// 查出设置了优先分案的法官
list = (List) dao.query("Ccpq.getYxfa", map);
len = list.size();
if (len != 0) {
for (i = 0; i < len; i++) {
tmp = (HashMap) list.get(i);
zybm = tmp.get("ZYBM").toString();
tmp.put("FABL", new Double(((BigDecimal) tmp.get("FABL"))
.doubleValue()));
kfafs = new Kfafgxx();
kfafs.setZybm(zybm);
if ("1".equals(spzfz)) {
List arrL = (List) spzcy.get(zybm);
for (int zyi = 0; zyi < arrL.size(); zyi++) {
String tmpZybm = (String) arrL.get(zyi);
getCaxx(caMap, tmpZybm, tmp, maxJarq);
}
} else {
getCaxx(caMap, zybm, tmp, maxJarq);
}

strTmp += "、" + tmp.get("XM");
kfafs.setXm(tmp.get("XM").toString());
kfafs.setPaxh(tmp.get("PAXH").toString());
kfafs.setFajs(tmp.get("FAJS").toString());
kfafs.setCasl(tmp.get("CASL").toString());
kfafs.setFabl(tmp.get("FABL").toString());
yxpq.add(tmp);
retList.add(kfafs);
}
try {
// 优先分案法官信息
obj.put(10, this.pack(retList));
} catch (Exception e) {
e.printStackTrace();
}
if (strTmp.length() > 0) {
strTmp = "针对当前案件设置了<B>" + strTmp.substring(1)
    + "</B>法官优先分案，案件将优先分给他们";
}
retList.clear();
try {
obj.put(8, this.pack(retList));
} catch (Exception e) {
e.printStackTrace();
}
try {
obj.put(9, this.pack(retList));
} catch (Exception e) {
e.printStackTrace();
}
this.addrz(strTmp);
strTmp = "";
} else {

try {
// 优先分案法官信息
obj.put(10, this.pack(retList));
} catch (Exception e) {
e.printStackTrace();
}

String ajlb = map.get("AJLB").toString();
String str = "''";
if (ajlb.equals("10")) {

} else {
// map.put("ay", "'" + map.get("laay") + "'");
// 处理层级案由
list = (List) dao.query("Ccpq.getFaay", map);
len = list.size();

for (i = 0; i < len; i++) {
str += ",'"
+ ((java.util.HashMap) list.get(i)).get("AYDM")
+ "'";
}
}
map.put("AY", str);

// 如果系列案原有案件的承办人不为空，那么要将案件分给该法官所在的合议庭的法官
String cy = "";
if (xlaxh.intValue() > 0) {
map.put("SFKBXLA", "SFKBXLA IN ('1','3')");
//ajlb为8并且spcx为1是新执行系统，否则是综合业务系统
if ("8".equals(ajlb) && "1".equals(map.get("SPCX").toString())) {
list = dao.query("Ccpq.getXzxXlaxx", map);
} else {
list = dao.query("Ccpq.getXlaxx", map);
}
len = list.size();
if ("1".equals(pqbg) || len == 0) {
// 执行恢复案件特殊分案
String zhdm = map.get("ZH").toString();
if ("8".equals(ajlb) && "4300".equals(zhdm)) {
list = (List) dao.query("Ccpq.getHfajxx", map);
len = list.size();
for (i = 0; i < len; i++) {
tmp = (HashMap) list.get(i);
if (tmp.get("CYJS").toString().equals("2")) {
cy = "'" + (list.get(i)).toString() + "',";
break;
} else {
cy += "'" + (list.get(i)).toString() + "',";
}
}
len = cy.length();
if (len > 0) {
cy = cy.substring(0, len - 1);
map.put("ZYBM", cy);
}
}
} else {
xlapq(list, dao, obj, map);
retJson.put("data", obj);
return retJson.toString();
}
} else {
map.put("SFKBXLA", "VALUE(SFKBXLA,'2')!='3'");
// 执行恢复案件特殊分案90
String zhdm = map.get("ZH").toString();
if ("8".equals(ajlb) && "4300".equals(zhdm)) {
list = (List) dao.query("Ccpq.getHfajxx", map);
len = list.size();
for (i = 0; i < len; i++) {
tmp = (HashMap) list.get(i);
if (tmp.get("CYJS").toString().equals("2")) {
cy = "'" + (list.get(i)).toString() + "',";
break;
} else {
cy += "'" + (list.get(i)).toString() + "',";
}
}
len = cy.length();
if (len > 0) {
cy = cy.substring(0, len - 1);
map.put("ZYBM", cy);
}
}
}
if ("1".equals(map.get("SYCX"))) {
map.put("AJSYCX", " VALUE(AJSYCX,'3') in ('1','3') ");
} else {
map.put("AJSYCX", " VALUE(AJSYCX,'3') in ('2','3') ");
}

// 如果立案没有指定案件辖区，则使用原有的依据原审法院的方式获得案件辖区
if (map.get("XQMC") == null) {
// 针对执行案件辖区的
if (!"8".equals(ajlb)
|| ("8".equals(ajlb) && "1".equals(map.get("SPCX")
.toString()))) {
// 获取案件的辖区
list = (List) dao.query("Ccpq.getAjxq", map);
if (list.size() > 0) {
map.put("XQFJM", list.get(0));
}
} else {
list = (List) dao.query("Ccpq.getZxajxq", map);
if (list.size() > 0) {
map.put("XQFJM", list.get(0));
}
}
} else {
map.put("XQFJM", map.get("XQMC"));
}
if (map.get("XQFJM") == null) {
map.put("XQFJM", "无");
}
// 在页面上显示辖区
obj.put(22, map.get("XQFJM"));

strTmp = "当前案件<B>"
    + map.get("AH")
    + "</B>为<B>"
    + map.get("BMMC")
    + map.get("AJLBMC")
    + map.get("SPCXMC")
    + "</B>"
+ ("1".equals(map.get("SYCX")) ? ("8".equals(map
.get("AJLB")) ? "，<B>独任审理（执行）案件</B>"
: "，<B>简易程序案件</B>") : "") + "，分案类型为<B>"
    + map.get("FALXMC") + "</B>";
if (!ajlb.equals("10")) {
strTmp += "，案由为<B>"
    + Dict.getInstance().getAyDictMc(
    (Integer) map.get("LAAY"), "aynr") + "</B>";
}
if (!"无".equals(map.get("XQFJM"))) {
strTmp += "，辖区为<B>" + map.get("XQFJM") + "</B>";
}
// SP51
if (!"255".equals(map.get("AJSJ"))) {
strTmp += "<B>"
    + Dict.getInstance().getDictMc("SP51",
    (String) map.get("AJSJ")) + "</B>";
}
if (xlaxh.intValue() > 0) {
strTmp += "<B>系列</B>";
}
strTmp += "案件";
this.addrz(strTmp);
strTmp = "";
// 获取承办部门能分该类案件的法官
map.put("FABZ", "1");
//五人合议，则需要判断5人合议配置
if (need5rhyt == true) {
map.put("zc5rhy", "1");
}
list = (List) dao.query("Ccpq.getFagz", map);

// 不办此类案件的法官
map.put("FABZ", "2");
List noList = (List) dao.query("Ccpq.getFagz", map);
// 去除能办此案人员中，不能办此案件的人员
for (i = list.size() - 1; noList.size() > 0 && i >= 0; i--) {
Map tempMap = (Map) list.get(i);
for (int j = 0; j < noList.size(); j++) {
if (tempMap.get("ZYBM").equals(
((Map) noList.get(j)).get("ZYBM"))) {
list.remove(i);
noList.remove(j);
break;
}
}
}
int casl = 0;
double caslqz;
Hashtable table = new Hashtable();
// ArrayList tmpList = new ArrayList(); // 存储新的存案超过分案基数的法官

strTmp = "";
if (hythbMap != null && hythbMap.size() > 0) {
for (i = list.size() - 1; list.size() > 0 && i >= 0; i--) {
Map tempMap = (Map) list.get(i);
String hbrmc = (String) hythbMap.get(tempMap
.get("ZYBM"));
if (hbrmc != null) {
list.remove(i);
strTmp += "、" + hbrmc;
}
}
}
if (strTmp.length() > 0) {
strTmp = "去除合议庭中有回避法官的承办法官：<B>" + strTmp.substring(1)
    + "</B>";
}
this.addrz(strTmp);
strTmp = "";

zzxxList = (List) dao.query("Ccpq.getZzxx", map);// 查询中止分案的法官
len = zzxxList.size();
retList.clear();
strTmp = "";

for (i = list.size() - 1; list.size() > 0 && i >= 0; i--) {
Map tempMap = (Map) list.get(i);
for (int j = 0; j < zzxxList.size(); j++) {
if (tempMap.get("ZYBM").equals(zzxxList.get(j))) {
tmp = (HashMap) list.remove(i);

strTmp += "、" + tmp.get("XM");
kfafs = new Kfafgxx();
kfafs.setZybm(tmp.get("ZYBM").toString());
kfafs.setXm(tmp.get("XM").toString());
retList.add(kfafs);
break;
}
}
}
if (strTmp.length() > 0) {
strTmp = "去除今天中止分案的法官：<B>" + strTmp.substring(1) + "</B>";
}
this.addrz(strTmp);
strTmp = "";

if (strTmp.length() > 0 && list.isEmpty()) {
obj.put(19, this.farz.toString()
+ "<BR>能够办理此案件的法官已中止分案，请与系统管理员联系！");
retJson.put("data", obj);
return retJson.toString();
}

kqxxList = (List) dao.query("kqgl.getZzxx", map);
len = kqxxList.size();
strTmp = "";
for (i = list.size() - 1; list.size() > 0 && i >= 0; i--) {
Map tempMap = (Map) list.get(i);
for (int j = 0; j < kqxxList.size(); j++) {
if (tempMap.get("ZYBM").equals(kqxxList.get(j))) {
tmp = (HashMap) list.get(i);

strTmp += "、" + tmp.get("XM");
kfafs = new Kfafgxx();
kfafs.setZybm(tmp.get("ZYBM").toString());
kfafs.setXm(tmp.get("XM").toString());
retList.add(kfafs);
break;
}
}
}
try {
// 请假法官信息
obj.put(8, this.pack(retList));
} catch (Exception e) {
e.printStackTrace();
}
if (strTmp.length() > 0) {
strTmp = "今天请假的法官：<B>" + strTmp.substring(1) + "</B>";
}
this.addrz(strTmp);
strTmp = "";

retList.clear();
len = list.size();
if (len == 0) {
obj.put(19, this.farz.toString()
+ "<BR>自动分案系统获取不到当前案件的承办人，请与系统管理员联系！");
retJson.put("data", obj);
return retJson.toString();
}
ArrayList tmpList = new ArrayList();
for (i = 0; i < len; i++) {
tmp = (HashMap) list.get(i);
zybm = tmp.get("ZYBM").toString();
tmp.put("FALX", map.get("FALX"));
// 获得可分案法官的存案数和当前分案类型的存案数

if ("1".equals(spzfz)) {
List arrL = (List) spzcy.get(zybm);
if (arrL != null) {
for (int zyi = 0; zyi < arrL.size(); zyi++) {
String tmpZybm = (String) arrL.get(zyi);
casl = getCaxx(caMap, tmpZybm, tmp, maxJarq);
}
} else {
casl = getCaxx(caMap, zybm, tmp, maxJarq);
}
} else {
casl = getCaxx(caMap, zybm, tmp, maxJarq);
}

tmp.put("FABL", new Double(((BigDecimal) tmp.get("FABL"))
.doubleValue()));
double fabl = ((Double) tmp.get("FABL")).doubleValue();
// 排除存案数量大于个人分案基数的法官
caslqz = casl * 1.0 / fabl;
if (caslqz >= ((Integer) tmp.get("FAJS")).intValue()) {
// 这里应该记录下所有,存案数量大于个人分案基数的法官,便于当所有法官都大于个人分案基数时,
// 还是对这些法官进行分案.
tmpList.add(tmp);
strTmp += "、" + tmp.get("XM") + "(" + casl + ":"
+ DecimalFormat(caslqz, 0, 2) + ":"
+ tmp.get("FAJS") + ")";
} else {
table.put(zybm, tmp);
strTmp2 += "、<BR>" + tmp.get("XM") + "(" + casl + ":"
+ DecimalFormat(caslqz, 0, 2) + ":"
+ tmp.get("CASLBYFALX") + ":" + tmp.get("FAJS")
+ ":" + tmp.get("FABL") + ")";
}
kfafs = new Kfafgxx();
kfafs.setZybm(tmp.get("ZYBM").toString());
kfafs.setXm(tmp.get("XM").toString());
kfafs.setPaxh(tmp.get("PAXH").toString());
kfafs.setFajs(tmp.get("FAJS").toString());
kfafs.setCaslByFalx(tmp.get("CASLBYFALX").toString());
kfafs.setCasl(casl + "");
kfafs.setFabl(tmp.get("FABL").toString());
kfafs.setJarq((Date) tmp.get("LAST_JARQ"));
retList.add(kfafs);
}
try {
// 可办理案件法官信息
sortIncreaseForKfafgxx(retList);
obj.put(7, this.pack(retList));
} catch (Exception e) {
e.printStackTrace();
}

if (table.isEmpty()) {
// obj.put(19, "能够办理此案件的法官存案数量大于设置的个人分案基数，请与系统管理员联系！");
// retJson.put("data", obj);
// return retJson.toString();

// 如果所有法官存案数量都大于个人分案基数，所有人员继续分案
strTmp2 = "";
for (i = 0; i < tmpList.size(); i++) {
tmp = (HashMap) tmpList.get(i);
table.put(tmp.get("ZYBM"), tmp);
double fabl = ((Double) tmp.get("FABL")).doubleValue();
casl = ((Integer) tmp.get("CASL")).intValue();
caslqz = casl * 1.0 / fabl;
strTmp2 += "、<BR>" + tmp.get("XM") + "(" + casl + ":"
+ DecimalFormat(caslqz, 0, 2) + ":"
+ tmp.get("CASLBYFALX") + ":" + tmp.get("FAJS")
+ ":" + tmp.get("FABL") + ")";
}
strTmp = "所有可办此案件法官总存案权值都大于分案基数，所有法官继续分案";
} else {
if (strTmp.length() > 0) {
strTmp = "去除总存案权值大于分案基数的法官(总存案数:总存案权值:基数)：<B>"
    + strTmp.substring(1) + "</B>";
}
}
this.addrz(strTmp);
this.addrz("适合办当前案件法官为(总存案数:总存案权值:分案类型存案数:基数:分案比例)：<B>"
    + strTmp2.substring(1) + "</B>");
// 根据中止分案情况、法官请假情况删除不能分案的法官

// kqxxList = list = (List) dao.query("kqgl.getZzxx", map);
// len = list.size();
// strTmp = "";
// for (i = 0; i < len; i++) {
// // tmp = (HashMap) table.remove(list.get(i));
// tmp = (HashMap) table.get(list.get(i));
// if (tmp == null)
// continue;
// strTmp += "、" + tmp.get("XM");
// kfafs = new Kfafgxx();
// kfafs.setZybm(tmp.get("ZYBM").toString());
// kfafs.setXm(tmp.get("XM").toString());
// kfafs.setPaxh(tmp.get("PAXH").toString());
// kfafs.setFajs(tmp.get("FAJS").toString());
// kfafs.setCasl(tmp.get("CASL").toString());
// kfafs.setFabl(tmp.get("FABL").toString());
// retList.add(kfafs);
// }
// try {
// // 请假法官信息
// obj.put(8, this.pack(retList));
// } catch (Exception e) {
// e.printStackTrace();
// }
// if (table.isEmpty()) {
// obj.put(19, this.farz.toString()
// + "<BR>能够办理此案件的法官已请假，请与系统管理员联系！");
// retJson.put("data", obj);
// return retJson.toString();
// }
// if (strTmp.length() > 0) {
// strTmp = "今天请假的法官：<B>" + strTmp.substring(1) + "</B>";
// }
// this.addrz(strTmp);
strTmp = "";
/**
* 分流案件时是否确定到法官
*/
String flajsfdqgcry = Dict.getInstance().getSetupInfo(fjm, "flajsfdqgcry");

Iterator kt = table.keySet().iterator();
String cyid = "";
while (kt.hasNext()) {
if (cyid.length() == 0) {
cyid = "'" + (String) kt.next() + "'";
} else {
cyid += ",'" + (String) kt.next() + "'";
}
}
map.put("cyid", cyid);
// String falxdm = falx.toString();
if (!"1".equals(flajsfdqgcry)) {
list = (List) dao.query("Ccpq.getCLTFASRY", map);
len = list.size();
for (i = 0; i < len; i++) {
tmp = (HashMap) list.get(i);
zybm = tmp.get("ZYBM").toString();
hm = (HashMap) table.get(zybm);
if (hm != null) {
// 新增对全部类型案件存案数进行判断
o = (HashMap) table.remove(zybm);
strTmp += "、" + o.get("XM") + "(已分" + tmp.get("YFAJS")
+ "件/允许分" + tmp.get("LTFAS") + "件)";
}
}
if (table.isEmpty()) {
obj
.put(
19,
this.farz.toString()
+ "<BR>可办当前案件的法官都已因超过两天内分案数量而被排除，自动分案系统获取不到当前案件的承办人，请与系统管理员联系！");
retJson.put("data", obj);
return retJson.toString();
}
if (strTmp.length() > 0) {
strTmp = "去除超过两天内分案数量的法官：<B>" + strTmp.substring(1)
    + "</B>";
}
this.addrz(strTmp);
}
strTmp = "";

// String falxdm = falx.toString();
list = (List) dao.query("Ccpq.getCaxz", map);
len = list.size();
retList.clear();
for (i = 0; i < len; i++) {
tmp = (HashMap) list.get(i);
zybm = tmp.get("ZYBM").toString();
hm = (HashMap) table.get(zybm);
if (hm != null) {
// 新增对全部类型案件存案数进行判断
o = null;
if ("0".equals(tmp.get("FALX").toString())) {
if (((Integer) hm.get("CASL")).intValue() >= ((Integer) tmp
.get("AJSL")).intValue()) {
o = (HashMap) table.remove(zybm);
}
} else {
if (((Integer) hm.get("CASLBYFALX")).intValue() >= ((Integer) tmp
.get("AJSL")).intValue()) {
o = (HashMap) table.remove(zybm);
}
}

if (o == null)
continue;
strTmp += "、" + o.get("XM");
kfafs = new Kfafgxx();
kfafs.setZybm(o.get("ZYBM").toString());
kfafs.setXm(o.get("XM").toString());
kfafs.setPaxh(o.get("PAXH").toString());
kfafs.setFajs(o.get("FAJS").toString());
kfafs.setCasl(o.get("CASL").toString());
kfafs.setFabl(o.get("FABL").toString());
retList.add(kfafs);
}
}
if (table.isEmpty()) {
obj
.put(
19,
this.farz.toString()
+ "<BR>可办当前案件的法官都已因存案数量控制而限制分案，自动分案系统获取不到当前案件的承办人，请与系统管理员联系！");
retJson.put("data", obj);
return retJson.toString();
}
if (strTmp.length() > 0) {
strTmp = "去除存案数达到限制数的法官：<B>" + strTmp.substring(1) + "</B>";
}
this.addrz(strTmp);
strTmp = "";

java.util.Enumeration enums = table.elements();
str = "''";
while (enums.hasMoreElements()) {
str += ",'" + ((HashMap) enums.nextElement()).get("ZYBM")
+ "'";
}
tmp = new HashMap();
tmp.put("FALX", map.get("FALX"));
tmp.put("RY", str);
tmp.put("CBFY", map.get("CBFY"));
list = (List) dao.query("Ccpq.getFasl", tmp);//--------------------------------------------------
len = list.size();
HashMap tmp1 = new HashMap();
String ksrq, jsrq;
int count;
Iterator itor;
for (i = 0; i < len; i++) {
tmp = (HashMap) list.get(i);
zybm = tmp.get("ZYBM").toString();
hm = (HashMap) table.get(zybm);
if (hm != null) {
ksrq = DateTools.format((Date) tmp.get("KSRQ"),
DateTools.FORMAT_DAY);
jsrq = DateTools.format((Date) tmp.get("JSRQ"),
DateTools.FORMAT_DAY);
tmp1.clear();
tmp1.put("CBFY", map.get("CBFY"));
tmp1.put("ZYBM", zybm);
tmp1.put("KSRQ", ksrq);
tmp1.put("JSRQ", jsrq);
List list1 = (List) dao.query("Ccpq.getAjFasl", tmp1);
if (0 == ((Integer) tmp.get("GRFALX")).intValue()) {
count = 0;
itor = list1.iterator();
Map slMap = null;
while (itor.hasNext()) {
slMap = (HashMap) itor.next();
int tmpSl = ((Integer) slMap.get("NUM"))
.intValue();
if (slMap.get("XLABH") == null) {
count += tmpSl;
} else {
count += xlaZS(
((Integer) slMap.get("FALX"))
.intValue(), tmpSl);
}

}

if (count >= ((Integer) tmp.get("AJSL")).intValue()) {
o = (HashMap) table.remove(zybm);
if (o == null)
continue;
strTmp += "、" + o.get("XM");
kfafs = new Kfafgxx();
kfafs.setZybm(tmp.get("ZYBM").toString());
kfafs.setXm(o.get("XM").toString());
kfafs.setPaxh(o.get("PAXH").toString());
kfafs.setFajs(o.get("FAJS").toString());
kfafs.setCasl(o.get("CASL").toString());
kfafs.setFabl(o.get("FABL").toString());
retList.add(kfafs);
}
} else {
count = 0;
itor = list1.iterator();

while (itor.hasNext()) {
HashMap tmp2 = (HashMap) itor.next();
if (tmp.get("GRFALX") != null
&& tmp.get("GRFALX").equals(
tmp2.get("FALX"))) {

int tmpSl = ((Integer) tmp2.get("NUM"))
.intValue();
if (tmp2.get("XLABH") == null) {
count += tmpSl;
} else {
count += xlaZS(((Integer) tmp2
.get("FALX")).intValue(), tmpSl);
}
}
}
if (count >= ((Integer) tmp.get("AJSL")).intValue()) {
o = (HashMap) table.remove(zybm);
if (o == null)
continue;
strTmp += "、" + o.get("XM");
kfafs = new Kfafgxx();
kfafs.setZybm(tmp.get("ZYBM").toString());
kfafs.setXm(o.get("XM").toString());
kfafs.setPaxh(o.get("PAXH").toString());
kfafs.setFajs(o.get("FAJS").toString());
kfafs.setCasl(o.get("CASL").toString());
kfafs.setFabl(o.get("FABL").toString());
retList.add(kfafs);
}
}
}
}
try {

obj.put(9, this.pack(retList));
} catch (Exception e) {
e.printStackTrace();
}
if (table.isEmpty()) {
obj
.put(
19,
this.farz.toString()
+ "<BR>可办当前案件的法官都已限制分案，自动分案系统获取不到当前案件的承办人，请与系统管理员联系！");
retJson.put("data", obj);
return retJson.toString();
}
retList.clear();

if (strTmp.length() > 0) {
strTmp = "去除已分案件数达到限制数的法官：<B>" + strTmp.substring(1)
    + "</B>";
}
this.addrz(strTmp);
strTmp = "";

enums = table.elements();
while (enums.hasMoreElements()) {
yxpq.add(enums.nextElement());
}
}
}

if ("2".equals(tsajpqsz)) {
len = zsszcbr.size();
for (i = 0; i < len; i++) {
tmp = (HashMap) zsszcbr.get(i);
zybm = tmp.get("ZYBM").toString();
for (int j = 0; j < yxpq.size(); j++) {
if (zybm.equals(((HashMap) yxpq.get(j)).get("ZYBM"))) {
o = (HashMap) yxpq.remove(j);
break;
}
}
}
if (len > 0) {
strTmp = "找到当前提审案件的原审查案件合议庭成员“<B>" + bmhycy
    + "</B>”，案件禁止分派给原审查案件合议庭成员";
this.addrz(strTmp);
strTmp = "";
}
}

retList.clear();
List tempList = new ArrayList();
// 如果案件为发回重审的案件，合议庭不能为原刑事案件的合议庭成员
java.util.HashMap m = new java.util.HashMap();
// 如果案件为发回重审的案件，主审法官不能为原刑事案件的审判成员
if ("1".equals(map.get("SFCS"))) {
StringBuffer strB = new StringBuffer();
len = yxpq.size();
for (i = 0; i < len; i++) {
tmp = (HashMap) yxpq.get(i);
strB.append(",'").append(tmp.get("ZYBM")).append("'");
}
strB.deleteCharAt(0);
java.util.HashMap tmap = new java.util.HashMap();
tmap.put("AJID", this.getAjid());
tmap.put("HYTCY", strB.toString());
list = dao.query("Ccpq.checkXSSpzz", tmap);
len = list.size();
String csZybm;
int j;
for (i = 0; i < len; i++) {
tmp = (HashMap) list.get(i);
csZybm = tmp.get("CYID").toString();

kfafs = new Kfafgxx();
kfafs.setZybm(csZybm);
kfafs.setXm(tmp.get("CYXM").toString());
kfafs.setFajs(tmp.get("CYJS").toString());
tempList.add(kfafs);
m.put(csZybm, csZybm);
for (j = 0; j < yxpq.size(); j++) {
if (csZybm.equals(((HashMap) yxpq.get(j)).get("ZYBM"))) {
o = (HashMap) yxpq.remove(j);
strTmp += "、" + o.get("XM");
retList.add(kfafs);
break;
}
}
}
obj.put(16, "1");
try {
obj.put(17, this.pack(retList));
} catch (Exception e) {
e.printStackTrace();
}
try {
obj.put(20, this.pack(tempList));
} catch (Exception e) {
e.printStackTrace();
}

} else {
obj.put(16, "0");
}
if (strTmp.length() > 0) {
strTmp = "当前案件为<B>发回重审</B>案件，<B>" + strTmp.substring(1)
    + "</B>法官参与了原案件的办理，不能参与此案件办理。";
}
this.addrz(strTmp);
strTmp = "";

//2014-04-23增加访审和访终的字号不要进行判断，根据高院的报告
if (!sfFsFzAj && !"8".equals(map.get("AJLB"))
&& ("3".equals(map.get("SPCX")) || "4".equals(map.get("SPCX"))) && !zskstscltj) {// 针对再审审查和再审案件，审理过相关案件的承办人与审判长需要回避
StringBuffer strB = new StringBuffer();
len = yxpq.size();
for (i = 0; i < len; i++) {
tmp = (HashMap) yxpq.get(i);
strB.append(",'").append(tmp.get("ZYBM")).append("'");
}
strB.deleteCharAt(0);
java.util.HashMap tmap = new java.util.HashMap();
tmap.put("AJID", this.getAjid());
tmap.put("HYTCY", strB.toString());
tmap.put("cbfy", this.fjm);
list = dao.query("Ccpq.checkZSSQSpzz", tmap);
len = list.size();
String csZybm;
int j;
for (i = 0; i < len; i++) {
tmp = (HashMap) list.get(i);
csZybm = tmp.get("CYID").toString();

kfafs = new Kfafgxx();
kfafs.setZybm(csZybm);
kfafs.setXm(tmp.get("CYXM").toString());
tempList.add(kfafs);
m.put(csZybm, csZybm);
for (j = 0; j < yxpq.size(); j++) {
if (csZybm.equals(((HashMap) yxpq.get(j)).get("ZYBM"))) {
o = (HashMap) yxpq.remove(j);
strTmp += "、" + o.get("XM");
retList.add(kfafs);
break;
}
}
}
if (tempList.size() > 0) {
obj.put(16, "2");
try {
obj.put(17, this.pack(retList));
} catch (Exception e) {
e.printStackTrace();
}
try {
obj.put(20, this.pack(tempList));
} catch (Exception e) {
e.printStackTrace();
}

if (strTmp.length() > 0) {
strTmp = "当前案件为<B>"
    + ("3".equals(map.get("SPCX")) ? "审判监督" : "申诉申请")
    + "</B>案件，<B>" + strTmp.substring(1)
    + "</B>法官参与了相关案件的审理，不能参与此案件办理。";
}
this.addrz(strTmp);
strTmp = "";
}
}
if (yxpq.isEmpty()) {
obj.put(19, this.farz.toString());
retJson.put("data", obj);
return retJson.toString();
}

map.put("FAJS", Integer.valueOf(fajs + ""));

// 去除前一个案件被分到案件的法官--2014-04-23增加访审和访终的字号不要进行判断，根据高院的报告
list = (List) dao.query("Ccpq.getFaxxMin", map);
List removeList = new ArrayList();
if (!sfFsFzAj && !list.isEmpty() && yxpq.size() > 2 && !zskstscltj) {//当可办案法官为两个以上时才去除之前分到案件的法官，防止出现最后两个法官只能一人一件的问题
len = yxpq.size();
String lastUser = (String) ((Map) list.get(0)).get("CYID");
String lastUserXm = (String) ((Map) list.get(0)).get("CYXM");
for (i = len - 1; i >= 0; i--) {
tmp = (HashMap) yxpq.get(i);
removeList.add(tmp);
if (lastUser != null) {
if (lastUser.equals(tmp.get("ZYBM").toString())) {
yxpq.remove(i);
this.addrz("去除前一个案件被分到案件的法官：<B>" + lastUserXm + "</B>");
break;
}
}
}
}

String ret = null;
if (fafs == 3) {
// 依平圴轮排
obj.put(12, "0");
this.addrz("将通过<B>平均轮排</B>方式，从可办案法官中选中最佳的办案法官");
ret = turnModeByNormal(map, dao, obj, yxpq, fajs, zzxxList,
kqxxList, m);
} else if (fafs == 5) {
// TODO 依本年分案数量平均轮排
obj.put(12, "0");
this.addrz("将通过<B>依本年分案数量平均轮排</B>方式，从可办案法官中选中最佳的办案法官");
map.put("FAPJLX", "1");
ret = turnModeByBnfasl(map, dao, obj, yxpq, zzxxList, kqxxList, m);
} else if (fafs == 6) {
// TODO 依本年分案数量平均轮排
obj.put(12, "0");
this.addrz("将通过<B>依本月分案数量平均轮排</B>方式，从可办案法官中选中最佳的办案法官");
map.put("FAPJLX", "2");
ret = turnModeByBnfasl(map, dao, obj, yxpq, zzxxList, kqxxList, m);
} else if (fafs == 7) {
// TODO 依本年分案数量平均轮排
obj.put(12, "0");
this.addrz("将通过<B>依本季分案数量平均轮排</B>方式，从可办案法官中选中最佳的办案法官");
map.put("FAPJLX", "3");
ret = turnModeByBnfasl(map, dao, obj, yxpq, zzxxList, kqxxList, m);
} else if (fafs == 8) {
// TODO 按照设置比例轮排
obj.put(12, "0");
this.addrz("将通过<B>依比例轮排</B>方式，从可办案法官中选中最佳的办案法官");
map.put("PQFG", this.czr);
ret = turnModeByPzBlLb(map, dao, obj, yxpq, removeList, zzxxList, kqxxList, m, need5rhyt);
} else if (fafs == 4) {
// TODO 依分案比例轮排，未完成
obj.put(12, "0");
this.addrz("将通过<B>依分案比例轮排</B>方式，从可办案法官中选中最佳的办案法官");
ret = turnModeByFabl(map, dao, obj, yxpq, zzxxList, kqxxList, m);
} else if (fafs == 2) {
// 排给存案最小的
obj.put(12, "0");
this.addrz("将通过<B>排给存案最小法官</B>方式，从可办案法官中选中最佳的办案法官");
ret = toMinMode(map, dao, obj, yxpq, zzxxList, kqxxList, m);
} else {
// 默认
// 依轮排
obj.put(12, "1");// 分案方式
Dict dict = Dict.getInstance();
String sfajpjfp = dict.getSetupInfo(this.getFjm(), "sfajpjfp");
if (sfajpjfp.equals("1")) {
this.addrz("将通过<B>平均轮排</B>方式，从可办案法官中选中最佳的办案法官");
ret = turnModeByNormal(map, dao, obj, yxpq, fajs, zzxxList,
kqxxList, m);
} else {
this.addrz("将通过<B>轮排</B>方式，从可办案法官中选中最佳的办案法官");
ret = turnMode(map, dao, obj, yxpq, fajs, zzxxList, kqxxList, m);
}
}
if (ret != null) {
return ret;
}
if (!"plzdpq".equals(this.mode) || obj.get(0) instanceof String) {
obj.put(14, "0");
obj.put(23, this.farz.toString());
retJson.put("data", obj);
} else {// 批量自动排期时，自动保存排期结果到案件中
Pqsz pq = new Pqsz();
if (this.getAjids() != null) {
pq.setAjids(this.ajids);
pq.setXlabh(this.xlabh);
pq.setNum(this.ajids.split(",").length); //设置系列案个数

if (this.getAh() != null) {
pq.setAh(this.getAh());
} else {
pq.setAh((String) map.get("AH"));
}
} else {
pq.setAjids(this.ajid);
pq.setAh((String) map.get("AH"));
}
pq.setFalx(falx);
pq.setCabz(cabz);
pq.setFjm(this.fjm);
pq.setPdfs(new Integer(1));
pq.setPalx(new Integer(0));
pq.setCbbm((String) map.get("CBBM"));
pq.setPqfg(this.pqfg);
pq.setPqfgxm(this.pqfgxm);
pq.setAjlb(map.get("AJLB").toString());

List spzzList = (List) obj.get(0);
for (i = 0; i < spzzList.size(); i++) {
JSONObject spzz = (JSONObject) spzzList.get(i);
if ("1".equals(spzz.get("drjs"))) {
pq.setSpzdm(spzz.get("zybm") + ":" + spzz.get("bmdm"));
pq.setSpz((String) spzz.get("cyxm"));
} else if ("2".equals(spzz.get("drjs"))) {
pq.setZsfgdm(spzz.get("zybm") + ":" + spzz.get("bmdm"));
pq.setZsfg(spzz.getString("cyxm"));
} else if ("3".equals(spzz.get("drjs"))) {
pq.setSjydm(spzz.get("zybm") + ":" + spzz.get("bmdm"));
pq.setSjy(spzz.getString("cyxm"));
} else {
if (pq.getQthytcy() == null) {
pq.setQthytcydm(spzz.get("zybm") + ":"
+ spzz.get("bmdm"));
pq.setQthytcy(spzz.getString("cyxm"));
} else {
pq.setQthytcydm(pq.getQthytcydm() + ","
+ spzz.get("zybm") + ":" + spzz.get("bmdm"));
pq.setQthytcy(pq.getQthytcy() + ","
+ spzz.getString("cyxm"));
}
}
}
retJson.put("data", pq.saveSpzz(context));
}
return retJson.toString();
}

/**
* 依本年分案数量平均轮排
* 依本季分案数量平均轮排
* 依本月分案数量平均轮排
*
* @param map
* @param dao
* @param obj
* @param yxpq
* @param zzxxList
* @param kqxxList
* @param m
* @return
*/
private String turnModeByBnfasl(HashMap map, IIbatisDAO dao, JSONArray obj,
List yxpq, List zzxxList, List kqxxList, HashMap m) {

int len = yxpq.size(), i;
String cyid = "";
StringBuffer sql = new StringBuffer();
Map tmp = null;
if (len > 0) {
for (i = 0; i < len; i++) {
tmp = (HashMap) yxpq.get(i);
cyid += "'" + tmp.get("ZYBM").toString() + "',";
if (sql.length() == 0) {
sql.append(" select '" + tmp.get("ZYBM") + "' C_ZYBM, "
+ tmp.get("CASL") + " ZCAS from (values(1)) ");
} else {
sql.append(" union all select '" + tmp.get("ZYBM")
+ "' C_ZYBM, " + tmp.get("CASL")
+ " ZCAS  from (values(1)) ");// 将各法官的总存案数存在表，用于按总存案数排序
}
}
}
len = cyid.length();
if (len > 0) {
cyid = cyid.substring(0, len - 1);
}
map.put("CYID", cyid);
Tjsj tjsj = new Tjsj(fjm);
String fapjlx = (String) map.get("FAPJLX");
String kssj = null;
if ("2".equals(fapjlx)) {
kssj = tjsj.getKssjYtj();
} else if ("3".equals(fapjlx)) {
kssj = tjsj.getKssjJtj();
} else {
kssj = tjsj.getKssjNtj();
}
kssj = kssj.substring(0, 10);
map.put("FASJ_START", kssj);
map.put("CAS_SQL", sql.toString());

List list = null;
if ("1".equals(map.get("SPZFZ"))) {
list = (List) dao.query("Ccpq.getFaxxByBndfaslForSpzfz", map);
} else {
list = (List) dao.query("Ccpq.getFaxxByBndfasl", map);//------------------------------------
}

len = list.size();
String s = "";
for (i = 0; i < len; i++) {
tmp = (HashMap) list.get(i);
if (tmp.get("PQSJ") == null
&& "1.00000".equals(tmp.get("NUM").toString())) {
tmp.put("NUM", "0");
}
s += "、<BR>"
+ tmp.get("XM")
+ "("
+ (tmp.get("PQSJ") == null ? "未分过案" : tmp.get("PQSJ"))
+ ")"
+ "("
+ (tmp.get("NUM") == null ? ""
: ("分案权值为" + tmp.get("NUM") + "")) + ")";
}
String falxmc = map.get("FALXMC").toString().endsWith("案件") ? map.get(
"FALXMC").toString() : map.get("FALXMC").toString() + "案件";
this.addrz("从" + kssj + "至今各法官分到案件最少最后排到<B>" + falxmc + "</B>的时间为：<B>"
    + s.substring(1) + "</B>");
return getHytcyxx(map, dao, obj, this.getFjm(), list, zzxxList,
kqxxList, m);
}

private String turnModeByFabl(HashMap map, IIbatisDAO dao, JSONArray obj,
List yxpq, List zzxxList, List kqxxList, HashMap m) {
int len = yxpq.size(), i;
String cyid = "";
HashMap tmp;
if (len > 0) {
for (i = 0; i < len; i++) {
tmp = (HashMap) yxpq.get(i);
cyid += "'" + tmp.get("ZYBM").toString() + "',";
}
}
len = cyid.length();
if (len > 0) {
cyid = cyid.substring(0, len - 1);
}
map.put("CYID", cyid);
List list = (List) dao.query("Ccpq.getFaxxByNormal", map);
len = list.size();
List tmpList = new ArrayList();
HashMap hm = new HashMap();
String s;
for (i = len - 1; i >= 0; i--) {
s = ((HashMap) list.get(i)).get("ZYBM").toString();
if (hm.get(s) == null)
tmpList.add(list.get(i));
hm.put(s, s);
}
len = tmpList.size();
List t = new ArrayList();
int j = 0;
for (i = len - 1; i >= 0; i--) {
t.add(j, tmpList.get(i));
j++;
}
return getHytcyxx(map, dao, obj, this.getFjm(), t, zzxxList, kqxxList,
m);
}

private void addrz(String str) {
if (str != null && str.length() > 0) {
this.farz.append(str + "。<BR>");
}
}

private int xlaZS(int falx, int xlaNum) {
if (xlaNum <= 0) {
return 0;
}
if (xlaNum == 1) {// 如果系列案只有一个案件则算一件
return 1;
}
Map tmp = null;
if (xlaZSlist != null && xlaZSlist.size() != 0) {
for (int k = 0; k < xlaZSlist.size(); k++) {
tmp = (Map) xlaZSlist.get(k);
Integer kssl = (Integer) tmp.get("KSSL");
Integer jssl = (Integer) tmp.get("JSSL");
Integer zssl = (Integer) tmp.get("ZSSL");
if (xlaNum >= kssl.intValue() && jssl == null) {
xlaNum = zssl.intValue();
break;
} else if (xlaNum >= kssl.intValue()
&& xlaNum <= jssl.intValue()) {
xlaNum = zssl.intValue();
break;
}
}
}
return xlaNum;
}

private void xlapq(List list, IIbatisDAO dao, JSONArray obj, HashMap map) {
int len, i, drjs, idx;
len = list.size();
java.util.HashMap tCbr = new java.util.HashMap();
String s, s1 = "";
HashMap tmp;
for (i = 0; i < len; i++) {
tmp = (HashMap) list.get(i);
s = tmp.get("CBR").toString();
if (i == 0) {
s1 = tmp.get("AJID").toString();
}
tCbr.put(s, s);
}
ArrayList tmpList = (ArrayList) dao.query("Hytsz.getSpzzByAjid", s1);

// ArrayList tmpList1 = (ArrayList) tmpList.clone();
Hytcy hytcy;
len = tmpList.size();
boolean rt = false;
List zzxxList, kqxxList;
Map m = new HashMap();
m.put("CBFY", map.get("CBFY"));
m.put("CBBM", map.get("CBBM"));
zzxxList = (List) dao.query("Ccpq.getZzxxNew", m);// 查询中止分案的法官
kqxxList = (List) dao.query("kqgl.getZzxx", "");
for (i = 0; i < len; i++) {
hytcy = (Hytcy) tmpList.get(i);
drjs = hytcy.getDrjs().intValue();
s = hytcy.getZybm();
if (drjs == 255) {
if (tCbr.get(s) == null && !rt) {
// hytcy.setDrjs(new Integer("2"));
rt = true;
}
} else if (drjs == 2) {
hytcy.setDrjs(new Integer("255"));
}
// drjs = hytcy.getDrjs().intValue();
// if (drjs == 2) {
// hytcy.setHytid(new Integer("0"));
// continue;
// }

if (drjs == 3) {
idx = kqxxList.indexOf(s);
if (idx >= 0) {
hytcy.setHytid(new Integer("2"));
} else {
hytcy.setHytid(new Integer("0"));
}
} else {
idx = zzxxList.indexOf(s);
if (idx >= 0) {
hytcy.setHytid(new Integer("1"));
continue;
} else {
hytcy.setHytid(new Integer("0"));
}
idx = kqxxList.indexOf(s);
if (idx >= 0) {
hytcy.setHytid(new Integer("2"));
}
}
}
// if (!rt) {
// obj.put(14, "2");
// try {
// obj.put(0, this.pack(tmpList1));
// } catch (Exception e) {
// e.printStackTrace();
// }
// } else {
if (rt)
obj.put(14, "1");// 系列案件标志，是否显示分案情况
else
obj.put(14, "2");
try {
obj.put(0, this.pack(tmpList));
} catch (Exception e) {
e.printStackTrace();
}
// }
obj.put(1, map.get("AJLBMC").toString());
Object o = map.get("SPCXMC");
if (o == null)
obj.put(2, "无");
else
obj.put(2, o.toString());
obj.put(3, map.get("AJLX").toString());
obj.put(4, map.get("CBBM").toString());
obj.put(5, map.get("FALX").toString());
obj.put(6, map.get("CABZ").toString());
obj.put(11, map.get("BMMC").toString());
obj.put(18, "1");// 存在合议庭配置
}

//yxpq 可用
//zzxxList 终止信息
//kqxxList 考勤信息
private String turnModeByNormal(HashMap map, IIbatisDAO dao, JSONArray obj,
List yxpq, int fajs, List zzxxList, List kqxxList, HashMap m) {
int len = yxpq.size(), i;
String cyid = "";
HashMap tmp;
if (len > 0) {
for (i = 0; i < len; i++) {
tmp = (HashMap) yxpq.get(i);
cyid += "'" + tmp.get("ZYBM").toString() + "',";
}
}
len = cyid.length();
if (len > 0) {
cyid = cyid.substring(0, len - 1);
}
map.put("CYID", cyid);
List list = (List) dao.query("Ccpq.getFaxxByNormal", map);
len = list.size();
String s = "";
for (i = 0; i < len; i++) {
tmp = (HashMap) list.get(i);
s += "、<BR>" + tmp.get("XM") + "("
+ (tmp.get("PQSJ") == null ? "未分过案" : tmp.get("PQSJ"))
+ ")";
}
String falxmc = map.get("FALXMC").toString().endsWith("案件") ? map.get(
"FALXMC").toString() : map.get("FALXMC").toString() + "案件";
if (s == null || s.equals("") || s.length() < 2) {
s = "";
this.addrz("各法官最后排到<B>" + falxmc + "</B>的时间为：<B>" + s + "</B>");
} else {
this.addrz("各法官最后排到<B>" + falxmc + "</B>的时间为：<B>" + s.substring(1)
    + "</B>");
}

return getHytcyxx(map, dao, obj, this.getFjm(), list, zzxxList,
kqxxList, m);
}

/**
* 按比例轮排
*
* @param map
* @param dao
* @param obj
* @param yxpq      可用
* @param fajs
* @param zzxxList  终止信息
* @param kqxxList  考勤信息
* @param m
* @param need5rhyt 是否需要五人合议
* @return
*/
private String turnModeByPzBlLb(HashMap map, IIbatisDAO dao, JSONArray obj,
List yxpq, List removeList, List zzxxList, List kqxxList, HashMap m, boolean need5rhyt) {
//深圳南山法院依比例轮排不区分分案类型
map.put("TMPFALX", map.get("FALX"));

//根据配置：轮次轮排不分案件类型轮排
new Pqsz().setFalxBySetup(map, map.get("CBFY").toString());

int len = yxpq.size(), i;
Vector cyids = new Vector();
String cyxms = "";
HashMap tmp;
String s = "部门分案轮次情况:";
List lclist = (List) dao.query("Ccpq.getFaxxByByPzBlLbALL", map);
for (int j = 0; j < lclist.size(); j++) {
tmp = (HashMap) lclist.get(j);
s += "<BR>" + tmp.get("XM") + "(分案类型：" + tmp.get("FALX") + "，个人比例：" + tmp.get("FABL") + "，个人轮次："
+ ("0".equals(tmp.get("GRLC")) ? "未分过案" : tmp.get("GRLC")) + "，部门轮次：" + tmp.get("BMLC") + ")";
}
if (len > 0) {
for (i = 0; i < len; i++) {
tmp = (HashMap) yxpq.get(i);
cyids.add("'" + tmp.get("ZYBM").toString() + "'");
cyxms += tmp.get("XM").toString() + ",";
}
}
map.put("CYID", StringUtils.join(cyids, ","));
if (need5rhyt == true) {
s += ";<BR>由于本案件采用五人合议，因此不比较个人与部门轮次";
map.put("zc5rhy", 1);
}
List list = (List) dao.query("Ccpq.getFaxxByByPzBlLb", map);
len = list.size();
if (len == 0) {
for (int j = 0; j < removeList.size(); j++) {
tmp = (HashMap) removeList.get(j);
cyids.add("'" + tmp.get("ZYBM").toString() + "'");
cyxms += tmp.get("XM").toString() + ",";
}
map.put("CYID", StringUtils.join(cyids, ","));
list = (List) dao.query("Ccpq.getFaxxByByPzBlLb", map);
len = list.size();
//增加删除的人员，还是没有合适 的人员，进行对部门轮次增加一个轮次
if (!cyids.isEmpty()) {
for (i = 0; len == 0; i++) {
List bmlcList = dao.query("Ccpq.checkBmlc", map);
if (!bmlcList.isEmpty()) {
Map cntmap = (Map) bmlcList.get(0);
if (((Integer) cntmap.get("CNT")).intValue() > 0) {
s += ";<BR>自动挑选待排期人员:" + cyxms + "无分案权限，无法排期;";
break;  //已经大于全部个人轮次，则直接退出
}
}
dao.update("Ccpq.updatebmlcadd", map);
list = (List) dao.query("Ccpq.getFaxxByByPzBlLb", map);
len = list.size();
}
}
}
s += ";<BR>合适本轮排案的是：";
for (i = 0; i < len; i++) {
tmp = (HashMap) list.get(i);
s += "<BR>" + tmp.get("XM") + "(分案类型：" + tmp.get("FALX") + "，个人比例：" + tmp.get("FABL") + "，个人轮次："
+ ("0".equals(tmp.get("GRLC")) ? "未分过案" : tmp.get("GRLC")) + "，部门轮次：" + tmp.get("BMLC") + ")";
}
this.addrz("<B>" + s + "</B>");
return getHytcyxx(map, dao, obj, this.getFjm(), list, zzxxList,
kqxxList, m);
}

private String turnMode(HashMap map, IIbatisDAO dao, JSONArray obj,
List yxpq, int fajs, List zzxxList, List kqxxList, HashMap m) {
double dblCmp = 1000;
int casFalx;
double fabl;
double caqz;
HashMap tmp;
java.util.Enumeration enums = null;
int i, len = yxpq.size();
List zeroList = new ArrayList();
String strTmp = "";
if (len > 0) {
for (i = 0; i < len; i++) {
tmp = (HashMap) yxpq.get(i);
casFalx = ((Integer) tmp.get("CASLBYFALX")).intValue();
fabl = ((Double) tmp.get("FABL")).doubleValue();
caqz = 1.0 * casFalx / fabl;
if (caqz < dblCmp) {
dblCmp = caqz; // 替换最小权值
}
if (((Integer) tmp.get("CASL")).intValue() == 0) {
zeroList.add(tmp.get("ZYBM").toString());
strTmp += "、" + tmp.get("XM");
}
}
}

ArrayList listSuit = new ArrayList(); // 用来存储合适的法官
String zybm;
// 当总存案数为0的法官，优先分给这些法官
if (zeroList.size() > 0) {
this.addrz("优先给总存案数为0的<B>" + strTmp.substring(1) + "</B>法官分案");
strTmp = "";

len = yxpq.size();
int fablTmp, fablCmp = 0; // 最大分案比例
for (i = 0; i < len; i++) {
tmp = (HashMap) yxpq.get(i);
if (zeroList.contains(tmp.get("ZYBM"))) {
listSuit.add(tmp);
}
}
yxpq.clear();
yxpq.addAll(listSuit);
listSuit.clear();

if (!filter(yxpq, listSuit, null)) {
// throw new Exception("类CbrTools的filter方法获取承办人出错，请与系统管理员联系！");
}
} else {
this.addrz("当前分案类型最小存案权值（注：分案类型存案数与分案比例的比值）为<B>"
    + DecimalFormat(dblCmp, 0, 2) + "</B>，部门分案基数为<B>" + fajs
    + "</B>");

dblCmp += fajs;// 取当前部门合适的分案基数，即最小存案权值加上部门分案基数
this.addrz("当前部门合适的分案基数（注：最小存案权值加上部门分案基数）为<B>"
    + DecimalFormat(dblCmp, 0, 2) + "</B>");
len = yxpq.size();
String cyid = "";
String strTmp1 = "";
double fablTmp, fablCmp = 0; // 最大分案比例
for (i = 0; i < len; i++) {
tmp = (HashMap) yxpq.get(i);
casFalx = ((Integer) tmp.get("CASLBYFALX")).intValue();
fabl = ((Double) tmp.get("FABL")).doubleValue();
caqz = 1.0 * casFalx / fabl;
strTmp1 += "、" + tmp.get("XM") + "("
+ DecimalFormat(caqz, 0, 2) + ")";
zybm = tmp.get("ZYBM").toString();
cyid += "'" + zybm + "',";
if (caqz <= dblCmp) { // 选出存案权值小于最小存案权值的法官
fablTmp = ((Double) tmp.get("FABL")).doubleValue(); // 取最大分案比例的法官
if (fablTmp > fablCmp) {
fablCmp = fablTmp; // 如果发现一个新的最大分案比例，则清除原最适合分案名单，加入新
listSuit.clear();
listSuit.add(zybm);
strTmp = tmp.get("XM").toString();
} else if (Math.abs(fablTmp - fablCmp) <= 0.0000001) {// 将与最大分案比例相同的法官放到最适合分案名单中
listSuit.add(zybm);
strTmp += "、" + tmp.get("XM").toString();
}
}
}
len = cyid.length();
if (len > 0) {
cyid = cyid.substring(0, len - 1);
strTmp1 = strTmp1.substring(1);
}

this.addrz("各法官分案类型存案权重为：<B>" + strTmp1 + "</B>");
this.addrz("小于部门合适的分案基数并等于最大分案比例（<B>" + fablCmp + "</B>）的法官为：<B>"
    + strTmp + "</B>");
strTmp = "";

String lpyfasl = Dict.getInstance().getSetupInfo(this.fjm,
"lpyfasl");
if ("".equals(lpyfasl)) {
lpyfasl = "3";
}
map.put("CYID", cyid);
map.put("lpyfasl", lpyfasl);
List list = (List) dao.query("Ccpq.getFaxx", map);
len = list.size();
ArrayList tmpList;
ArrayList listHistory = new ArrayList();
HashMap tmpFa = new HashMap(); // 存储总的分案情况
List tmpSuit = new ArrayList();
tmpSuit.addAll(listSuit);
int tmpIndex;
boolean emptyed = false;
for (i = 0; i < len; i++) {
if (listSuit.isEmpty()) {
// break; // 如果最大分案比例的法官已取完全部当前类型案件分案数据，那么退出循环
emptyed = true;
}
tmp = (HashMap) list.get(i);
zybm = tmp.get("CYID").toString();

if (!listHistory.contains(zybm)) {
listHistory.add(0, zybm);
}
if (emptyed) {
continue;
}
tmpList = (ArrayList) tmpFa.get(zybm);
if (tmpList == null)
tmpList = new ArrayList();
tmpList.add(tmp.get("NUM"));
tmpFa.put(zybm, tmpList);
tmpIndex = listSuit.indexOf(zybm);
if (tmpIndex != -1 && (fablCmp * 4 <= tmpList.size())) {

listSuit.remove(tmpIndex);
strTmp += "、" + tmp.get("CYXM").toString(); // 如果该法官轮数已满4轮，那么去除该法官信息
}
}

if (listSuit.size() == 0) {// 如果所有可分案的法官都满4轮，则全部人继续分案
listSuit.addAll(tmpSuit);
} else {
if (strTmp.length() != 0) {
this.addrz("去除已经分到<B>" + fablCmp * 4 + "</B>轮案件的法官：<B>"
    + strTmp.substring(1) + "</B>");
}
}
strTmp = "";
len = yxpq.size();
List retList = new ArrayList();
Kfafgxx kfafs;
for (i = len - 1; i >= 0; i--) {
tmp = (HashMap) yxpq.get(i);
if (!listSuit.contains(tmp.get("ZYBM").toString())) {
yxpq.remove(i);
}
}
listSuit.clear();

// 找出本轮尚未分案的法官
len = yxpq.size();
for (i = 0; i < len; i++) {
tmp = (HashMap) yxpq.get(i);
zybm = tmp.get("ZYBM").toString();
tmpList = (ArrayList) tmpFa.get(zybm);
if (tmpList == null || tmpList.isEmpty()) {
listSuit.add(tmp);
strTmp += "、" + tmp.get("XM").toString();
} else {
kfafs = new Kfafgxx();
kfafs.setZybm(tmp.get("ZYBM").toString());
kfafs.setXm(tmp.get("XM").toString());
kfafs.setPaxh(tmp.get("PAXH").toString());
kfafs.setFajs(tmp.get("FAJS").toString());
kfafs.setCasl(tmp.get("CASL").toString());
kfafs.setFabl(tmp.get("FABL").toString());
retList.add(kfafs);
}
}
try {
obj.put(13, this.pack(retList));// 有分案的法官
} catch (Exception e) {
e.printStackTrace();
}

if (listSuit.size() == 0) {// 没有未分过案的法官
double tmpCmp;
dblCmp = 1000; // 设置为一个较大的值
len = yxpq.size();
String strFa = "";
for (i = 0; i < len; i++) {
tmp = (HashMap) yxpq.get(i);
zybm = tmp.get("ZYBM").toString();
tmpList = (ArrayList) tmpFa.get(zybm);
if (tmpList == null) {
if (dblCmp == 0) {
tmpCmp = 0;
listSuit.add(tmp);
strTmp += "、" + tmp.get("XM").toString();
} else {
dblCmp = 0;
tmpCmp = 0;
listSuit.clear();
listSuit.add(tmp);
strTmp = tmp.get("XM").toString();
}
} else {
Iterator iter = tmpList.iterator();
int count = 0;
while (iter.hasNext()) {
int ctmp = ((Integer) iter.next()).intValue();
if (ctmp > 1) {
count += xlaZS(((Integer) map.get("FALX"))
.intValue(), ctmp);
} else {
count += ctmp;
}
}

tmpCmp = 1.0 * tmpList.size()
/ ((Double) tmp.get("FABL")).doubleValue();
if (tmpCmp < dblCmp) {
dblCmp = tmpCmp;
listSuit.clear();
listSuit.add(tmp);
strTmp = tmp.get("XM").toString();
} else if (tmpCmp == dblCmp) {
listSuit.add(tmp);
strTmp += "、" + tmp.get("XM").toString();
}
}
strFa += "、" + tmp.get("XM").toString() + "(" + tmpCmp
+ ")";

}

if (strTmp.length() > 0) {

this.addrz("各法官分案权值为：<B>" + strFa.substring(1) + "</B>");
this.addrz("最小分案权值为<B>" + dblCmp + "</B>的法官为：<B>" + strTmp
    + "</B>");
strTmp = "";
}
yxpq.clear();
yxpq.addAll(listSuit);
listSuit.clear();

if (!filter(yxpq, listSuit, listHistory)) {
// throw new
// Exception("类CbrTools的filter方法获取承办人出错，请与系统管理员联系！");
}
} else if (listSuit.size() != 1) {
if (strTmp.length() > 0) {
this.addrz("优先给" + numMap.get(lpyfasl) + "个月内还未分过案的<B>"
    + strTmp.substring(1) + "</B>法官分案");
strTmp = "";
}

yxpq.clear();
yxpq.addAll(listSuit);
listSuit.clear();

if (!filter(yxpq, listSuit, listHistory)) {
// throw new
// Exception("类CbrTools的filter方法获取承办人出错，请与系统管理员联系！");
}
}
}

sortIncrease(listSuit);
logrz(listSuit, map);
return getHytcyxx(map, dao, obj, this.getFjm(), listSuit, zzxxList,
kqxxList, m);

}

/**
* 根据相应规则取出最合适的法官
*
* @param listCbr     承办人对象（ObjCbr）集合
* @param cbrResult   承办人结果
* @param listHistory 法官分案历史记录
*/
private boolean filter(List listCbr, ArrayList listSuit,
ArrayList listHistory) {
if (listCbr.isEmpty())
return false; // 当前用于过滤的可办案的法官为空
if (listHistory == null) // 如果历史分案记录为空
listHistory = new ArrayList();
String tmpStr1 = "";

if (tmpStr1.length() > 0) {
this.addrz("去除最近三个月分过案件的法官：<B>" + tmpStr1.substring(1) + "</B>");
tmpStr1 = "";
}

double dblCmp = 1000; // 最小的存案权值
// ArrayList listSuit = new ArrayList(); // 用来存储没有分过当前类型案件的法官
for (int i = 0; i < listCbr.size(); i++) { // 找出最小的存案权值和拥有最小存案权值的法官
HashMap objCbr = (HashMap) listCbr.get(i);
int cas = ((Integer) objCbr.get("CASL")).intValue();
double fabl = ((Double) objCbr.get("FABL")).doubleValue();
double dblTmp = 1.0 * cas / fabl;
if (dblTmp < dblCmp) {
dblCmp = dblTmp;
listSuit.clear();
listSuit.add(objCbr);
tmpStr1 = objCbr.get("XM").toString();
} else if (dblTmp == dblCmp) {
listSuit.add(objCbr);
tmpStr1 += "、" + objCbr.get("XM");
}
}
if (tmpStr1.length() > 0) {
this.addrz("找出最小存案权值为<B>" + DecimalFormat(dblCmp, 0, 2)
    + "</B>的法官：<B>" + tmpStr1 + "</B>");
tmpStr1 = "";
}

if (listSuit.size() == 1) { // 如果合适的法官只有一个人，那么设定该法官作为当前案件的承办人
return true; // 已经完成了操作，那么直接返回
}

double intCmp = 0; // 最大的分案比例
// String sql = "";
ArrayList tmpList = new ArrayList();// 如果此轮中有多个法官的存案权值相等，那么设定这些法官可以办理当前案件
for (int i = 0; i < listSuit.size(); i++) { // 找出最大的分案比例和拥有最大比例的法官
HashMap objCbr = (HashMap) listSuit.get(i);
// sql += "、" + objCbr.getYhmc();
double intTmp = ((Double) objCbr.get("FABL")).doubleValue();
if (intTmp > intCmp) {
intCmp = intTmp;
tmpList.clear();
tmpList.add(objCbr);
tmpStr1 = objCbr.get("XM").toString();
} else if (intTmp == intCmp) {
tmpList.add(objCbr);
tmpStr1 += "、" + objCbr.get("XM");
}
}
if (tmpStr1.length() > 0) {
this.addrz("找出最大分案比例为<B>" + DecimalFormat(dblCmp, 0, 2)
    + "</B>的法官：<B>" + tmpStr1 + "</B>");
tmpStr1 = "";
}
listSuit.clear();
listSuit.addAll(tmpList);

if (listSuit.size() == 1) { // 如果合适的法官只有一个人，那么设定该法官作为当前案件的承办人
return true; // 已经完成了操作，那么直接返回
}

if (!listHistory.isEmpty()) { // 如果历史分案记录不为空，所有可分案的人都应该在历史记录中有数据
String fg = "";
for (int i = 0; i < listHistory.size(); i++) {
boolean isOk = false;
fg = (String) listHistory.get(i);
for (int j = 0; j < listSuit.size(); j++) {
HashMap objCbr = (HashMap) listSuit.get(j);
if (fg.equals(objCbr.get("ZYBM"))) {
isOk = true;
break; // 如果当前法官存在于可分案的法官中，那么中止循环，继续下一个判断
}
}
if (!isOk) {
listHistory.remove(i--); // 去掉当前法官的分案数据
}
}
tmpList.clear();
if (!listHistory.isEmpty()) {
fg = (String) listHistory.get(0);
for (int j = 0; j < listSuit.size(); j++) {
HashMap objCbr = (HashMap) listSuit.get(j);
if (fg.equals(objCbr.get("ZYBM"))) {
tmpList.add(objCbr);
tmpStr1 = objCbr.get("XM").toString();
break; // 如果当前法官存在于可分案的法官中，那么中止循环，继续下一个判断
}
}

if (tmpStr1.length() > 0) {
this.addrz("最早分案的法官为：<B>" + tmpStr1 + "</B>");
tmpStr1 = "";
}

listSuit.clear();
listSuit.addAll(tmpList);
return true; // 已经完成了操作，那么直接返回
}
}
return true; // 已经完成了操作，那么直接返回
}

private String toMinMode(HashMap map, IIbatisDAO dao, JSONArray obj,
List yxpq, List zzxxList, List kqxxList, HashMap m) {
sortIncrease(yxpq);
logrz(yxpq, map);
return getHytcyxx(map, dao, obj, this.getFjm(), yxpq, zzxxList,
kqxxList, m);
}

/**
* 打印出各法官排序用的日期数据
*
* @param rylist
* @param map
*/
private void logrz(List rylist, HashMap map) {
if (rylist.size() > 0) {
StringBuffer tmpsb = new StringBuffer();
for (int i = 0; i < rylist.size(); i++) {
Map tempMap = (HashMap) rylist.get(i);
Date lastJarq2 = (Date) tempMap.get("LAST_JARQ");
String dstr = (currDate.equals(lastJarq2) ? "无" : DateTools
.format(lastJarq2, DateTools.FORMAT_DAY));
if (tmpsb.length() == 0) {
tmpsb.append(tempMap.get("XM") + "(<B>" + dstr + "</B>)");
} else {
tmpsb.append("<BR>" + tempMap.get("XM") + "(<B>" + dstr
    + "</B>)");
}

}
if ("1".equals(map.get("TSCL"))) {
this.addrz("各法官最近一个案件签发日期：<BR>" + tmpsb);
} else if ("2".equals(map.get("TSCL"))) {
this.addrz("各法官最近一个案件立案日期：<BR>" + tmpsb);
}
}
}

/**
* 数字四舍五入到小数第几位
*
* @value 要四舍五入的数字
* @min 四舍五入后保留的最小的小数位数
* @max 四舍五入后保留的最大的小数位数
**/
public static String DecimalFormat(double value, int min, int max) {
DecimalFormat df = new DecimalFormat();
df.setMinimumFractionDigits(min);
df.setMaximumFractionDigits(max);
return df.format(value);
}

private String getHytcyxx(HashMap map, IIbatisDAO dao, JSONArray obj,
String fjm, List pqry, List zzxxList, List kqxxList, HashMap m) {
Hytcy hytcy = new Hytcy();
Hytcy h = new Hytcy();
hytcy.setFjm(fjm);
hytcy.setBmdm((String) map.get("CBBM"));
boolean sfgdspzz = (Boolean) map.get("GDSPZZ");//获得是否固定审判组织
int i, len = pqry.size(), idx, j, drjs;
List list = null;
String iczhyt = "", s, tmpStr = "";
String bm;
java.util.HashMap hm = null;
if (len != 0) {
// 处理当设置了只排主审法官时，只输出主审法官
if ("1".equals(Dict.getInstance().getSetupInfo(fjm, "sfzpzsfg"))
|| "1".equals(map.get("SYCX"))
|| (!"1".equals(map.get("XZFSSCCX")) && "8".equals(map.get("AJLB"))
&& "1".equals(map.get("SPCX")) && "1".equals(Dict
.getInstance().getSetupInfo(fjm, "zxajwhyt")))) {
list = new ArrayList();
hytcy.setDrjs(new Integer(2));
hm = (HashMap) pqry.get(0);
// bm = hm.get("bmdm").toString();
// if(map.get("cbbm")==null){
// map.put("cbbm",bm);
// map.put("bmmc",dao.query("Ccpq.getBmmc", bm).get(0));
// }
// hytcy.setBmdm(bm);
hytcy.setCyxm(hm.get("XM").toString());
hytcy.setZybm(hm.get("ZYBM").toString());
list.add(hytcy);

List tmpList = dao.query("Hytsz.getAllHytcyxx", hytcy);
int l = tmpList.size();
for (i = 0; i < l; i++) {
Hytcy tmp = (Hytcy) tmpList.get(i);
if ("3".equals(tmp.getDrjs().toString())) {
list.add(tmp);
obj.put(18, "1");// 存在合议庭配置
}
}
this.addrz("最佳办案法官为：<B>" + hm.get("XM") + "</B>");
} else {
List retList = new ArrayList();
int l;
boolean rt = false;
boolean yhb = false;


if (m.isEmpty()) {
for (i = 0; i < len; i++) {
hm = (HashMap) pqry.get(i);
hytcy.setZybm(hm.get("ZYBM").toString());
if (sfgdspzz) {
list = dao.query("Hytsz.getAllHytcyxxGD", hytcy);
this.addrz("开启了固定审判长的配置，优先从固定审判长配置取人");
} else {
list = dao.query("Hytsz.getAllHytcyxx", hytcy);
}
l = list.size();
if (l > 0) {
obj.put(18, "1");// 存在合议庭配置
this.addrz("最佳办案法官为：<B>" + hm.get("XM") + "</B>");
// if(map.get("cbbm")==null){
// bm = hm.get("bmdm").toString();
// map.put("cbbm",bm);
// map.put("bmmc",dao.query("Ccpq.getBmmc",
// bm).get(0));
// }
break;
} else {
// 标识此主审法官未配置合议庭信息
Kfafgxx kfafs = new Kfafgxx();
iczhyt += "、" + hm.get("XM").toString();
kfafs.setZybm(hm.get("ZYBM").toString());
retList.add(kfafs);
}
}
} else {
for (i = 0; i < len; i++) {
hm = (HashMap) pqry.get(i);
hytcy.setZybm(hm.get("ZYBM").toString());
if (sfgdspzz) {
list = dao.query("Hytsz.getAllHytcyxxGD", hytcy);
this.addrz("开启了固定审判长的配置，优先从固定审判长配置取人");
} else {
list = dao.query("Hytsz.getAllHytcyxx", hytcy);
}
l = list.size();
for (j = 0; j < l; j++) {
rt = false;
h = (Hytcy) list.get(j);
s = h.getZybm();
if (m.get(s) != null) {
rt = true;
break;
}
}
if (rt) {
list = null;
yhb = true;
if (this.hythbMap == null) {
this.hythbMap = new HashMap<String, String>();
}
this.hythbMap.put(hm.get("ZYBM"), hm.get("XM"));
continue;
} else {
if (l > 0) {
obj.put(18, "1");// 存在合议庭配置
this.addrz("最佳办案法官为：<B>" + hm.get("XM")
    + "</B>");
// if(map.get("cbbm")==null){
// bm = hm.get("bmdm").toString();
// map.put("cbbm",bm);
// map.put("bmmc",dao.query("Ccpq.getBmmc",
// bm).get(0));
// }
break;
} else {
// 标识此主审法官未配置合议庭信息
Kfafgxx kfafs = new Kfafgxx();
iczhyt += "、" + hm.get("XM").toString();
kfafs.setZybm(hm.get("ZYBM").toString());
retList.add(kfafs);
}
}
}
}

if (iczhyt.length() > 0) {
this.addrz("还未配置合议庭的法官：<B>" + iczhyt.substring(1) + "</B>");
} else {
if (yhb) {
return this
.getCbrResult(InitServlet.getSpringContext());
}
}
try {
obj.put(21, this.pack(retList));// 未配置合议庭法官
} catch (Exception e) {
e.printStackTrace();
}
// 高院不允许存在没有配置合议庭就分案
// hytcy.setZybm(((HashMap)
// pqry.get(0)).get("zybm").toString());
// list = dao.query("Hytsz.getAllHytcyxx", hytcy);
// if (list.size() > 0) {
// obj.put(18, "1");// 存在合议庭配置
// }
// // 如果没有找到配置了合议庭成员的主审法官，则选第一个为主审法官，合议庭成员到页面中自由选择
// if (list == null || list.size() == 0) {
// if (list == null) {
// list = new ArrayList();
// }
// hytcy.setBmdm(((HashMap) pqry.get(0)).get("bmdm")
// .toString());
// hytcy.setCyxm(((HashMap) pqry.get(0)).get("xm").toString());
// hytcy.setZybm(((HashMap) pqry.get(0)).get("zybm")
// .toString());
// hytcy.setDrjs(new Integer(2));
// list.add(hytcy);
// obj.put(18, "2");// 不存在合议庭配置
// }
}
}
try {
if (list != null && list.size() > 0) {
len = list.size();
List spzList = new ArrayList();
List qthytList = new ArrayList();
List sjyList = new ArrayList();
Map hytxxMap = new HashMap();
String sjyfafs = null;
//NEED5RHYT-------------------------
for (i = 0; i < len; i++) {
hytcy = (Hytcy) list.get(i);
drjs = hytcy.getDrjs().intValue();
if (sjyfafs == null) {
sjyfafs = hytcy.getSjyfafs();
}
s = hytcy.getZybm();
if (drjs == 2) {
hytcy.setHytid(new Integer("0"));
hytxxMap.put("CBR", s);
continue;
}
if (drjs == 3) {
if (kqxxList != null) {
idx = kqxxList.indexOf(s);
if (idx >= 0) {
hytcy.setHytid(new Integer("2"));
} else {
hytcy.setHytid(new Integer("0"));
}
}
sjyList.add(s);
String syjTmp = (String) hytxxMap.get("SJY");
if (syjTmp == null) {
syjTmp = "'" + s + "'";
} else {
syjTmp += ",'" + s + "'";
}

hytxxMap.put("SJY", syjTmp);
} else {
if (drjs == 1) {
spzList.add(s);
String syjTmp = (String) hytxxMap.get("SPZ");
if (syjTmp == null) {
syjTmp = "'" + s + "'";
} else {
syjTmp += ",'" + s + "'";
}

hytxxMap.put("SPZ", syjTmp);
} else if (drjs == 255 || drjs == 4) {
qthytList.add(s);
String syjTmp = (String) hytxxMap.get("QTHYT");
if (syjTmp == null) {
syjTmp = "'" + s + "'";
} else {
syjTmp += ",'" + s + "'";
}

hytxxMap.put("QTHYT", syjTmp);
}
if (zzxxList != null) {
idx = zzxxList.indexOf(s);
if (idx >= 0) {
hytcy.setHytid(new Integer("1"));
continue;
} else {
hytcy.setHytid(new Integer("0"));
}
}
if (kqxxList != null) {
idx = kqxxList.indexOf(s);
if (idx >= 0) {
hytcy.setHytid(new Integer("2"));
}
}
}
}
if (sfgdspzz) {
if (spzList.size() == 0) {
list.removeAll(list);
len = 0;
obj.put(19, "此案件是死刑、抗诉的案件，又开始了固定审判长的配置，对应的承办人没有配置相应固定的审判长，请先在固定审判长！");

} else {
this.addrz("固定了审判长::" + spzList.get(0));
}
}
// 如果普通执行案件配置的执行案件无合议庭，则不自排合议庭成员(非诉审查案件除外)
if (!(!"1".equals(map.get("XZFSSCCX")) && "8".equals(map.get("AJLB"))
&& "1".equals(map.get("SPCX")) && "1".equals(Dict
.getInstance().getSetupInfo(fjm, "zxajwhyt")))) {
if ("1".equals(Dict.getInstance().getSetupInfo(fjm,
"sfzdphyt"))
|| "plzdpq".equals(this.mode)) {// 如果是批量自动排期时强行使用自动排合议庭成员功能
if (!"1".equals(Dict.getInstance().getSetupInfo(fjm,
"sfzpzsfg"))) {// 不为只排主审法官才进入自动筛选
List tmplist = null;
if (!"1".equals(map.get("SYCX"))) {
// 当合议庭配置了多个审判长，多个书记员（高院除外）或多个其他合议庭成员，则自动筛选出合适的成员
String spz = "";
if (!spzList.isEmpty()) {
if (spzList.size() > 1) {// 存在多个审判长
hytxxMap.put("HYTCY", hytxxMap.get("SPZ"));
hytxxMap.put("CYJS", "'1'");
hytxxMap.put("SPZ", null);
tmplist = dao
.query("Ccpq.getHytcyFA", hytxxMap);
tmpStr = "";
for (i = tmplist.size() - 1; i >= 0; i--) {
Map t = (Map) tmplist.get(i);
String xm = null;
if (zzxxList != null
&& zzxxList.indexOf(t.get("ZYBM")) >= 0) {
if ("2".equals(t.get("ZZLX"))) {
tmplist.remove(i);
xm = (String) t.get("XM")
+ "(中止合议分案)";
} else {
xm = (String) t.get("XM")
+ "(中止承办分案)";
}


} else {
xm = (String) t.get("XM");
}
tmpStr += "、<BR>"
+ xm
+ "("
+ (t.get("PQSJ") == null ? "未组过"
: t.get("PQSJ")) + ")";
if (tmplist.size() < 1) {
this.addrz("要组成的审判长已经中止分案，无法组成完整合议庭。");
list.removeAll(list);
qthytList.removeAll(qthytList);
qthytList.clear();
len = 0;
obj.put(19, "自动排期分到的承办人：<B><H>“" + hm.get("XM") + "”</H></B>配置的合议庭中审判长已经中止分案，无法组成完整合议庭，请检查相关配置！");

}
}
this.addrz("各审判长组成合议庭时间：<B>"
    + tmpStr.substring(1) + "</B>");
spz = (String) ((Map) tmplist.get(tmplist
.size() - 1)).get("ZYBM");
} else {
spz = (String) (spzList.get(0));
}
spzList.clear();
spzList.add(spz);
}
boolean spzcbr = spz.equals(hytxxMap.get("CBR"));// 如果审判长为主审法官时，要获得两名其他合议庭成员
if ((spzcbr && qthytList.size() >= 2)// 当审判长为主审法官时，其他合议庭成员数超过2人以上才处理
|| (!spzcbr && qthytList.size() >= 1))// 当审判长不为主审法官时，其他合议庭成员数超过1人以上才处理
{// 存在多个其他合议庭成员
hytxxMap.put("HYTCY", hytxxMap.get("QTHYT"));
hytxxMap.put("CYJS", "'255','4'");
hytxxMap.put("SPZ", spz);
tmplist = dao
.query("Ccpq.getHytcyFA", hytxxMap);

tmpStr = "";

for (i = tmplist.size() - 1; i >= 0; i--) {
Map t = (Map) tmplist.get(i);
String xm = null;
if (zzxxList != null
&& zzxxList.indexOf(t.get("ZYBM")) >= 0) {
if ("2".equals(t.get("ZZLX"))) {
tmplist.remove(i);
xm = (String) t.get("XM")
+ "(中止合议分案)";
} else {
xm = (String) t.get("XM")
+ "(中止承办分案)";
}

} else {
xm = (String) t.get("XM");
}
tmpStr += "、<BR>"
+ xm
+ "("
+ (t.get("PQSJ") == null ? "未组过"
: t.get("PQSJ")) + ")";
if ((spzcbr && tmplist.size() < 2) || (!spzcbr && tmplist.size() < 1)) {
this.addrz("要组成的其它合议成员已经中止分案，无法组成完整合议庭。");
list.removeAll(list);
qthytList.removeAll(qthytList);
qthytList.clear();
len = 0;
obj.put(19, "自动排期分到的承办人：<B>" + hm.get("XM") + "</B>配置的合议庭中其它合议庭成员已经中止分案，无法组成完整合议庭，请检查相关配置！");
}
}
this.addrz("各其他合议庭成员组成合议庭时间：<B>"
    + tmpStr.substring(1) + "</B>");

qthytList.clear();

tmpStr = "";
if (tmplist.size() > 0) {

qthytList.add((String) ((Map) tmplist
.get(tmplist.size() - 1)).get("ZYBM"));
tmpStr = (String) ((Map) tmplist
.get(tmplist.size() - 1)).get("XM");
if (spzcbr) {// 如果审判长为主审法官时，要获得两名其他合议庭成员
if (tmplist.size() >= 2) {
qthytList.add((String) ((Map) tmplist
.get(tmplist.size() - 2))
.get("ZYBM"));
tmpStr += "、" + (String) ((Map) tmplist
.get(tmplist.size() - 2)).get("XM");
} else {
this.addrz("要组成的其它合议成员已经中止分案，无法组成完整合议庭。");
list.removeAll(list);
qthytList.removeAll(qthytList);
qthytList.clear();
len = 0;
obj.put(19, "自动排期分到的承办人：<B>" + hm.get("XM") + "</B>配置的合议庭中其它合议庭成员已经中止分案，无法组成完整合议庭，请检查相关配置！");
}
}
}
this.addrz("自排合议庭成员选定成员为：<B>"
    + tmpStr + "</B>");
}
}
if (sjyList.size() > 1) {// 存在多个书记员

if ("1".equals(sjyfafs)) {
hytxxMap.put("HYTCY", hytxxMap.get("SJY"));
hytxxMap.put("CYJS", "'3'");
hytxxMap.put("SPZ", null);
hytxxMap.put("CBR", null);// 不根据承办人区分书记员的轮排
hytxxMap.put("FJM", fjm);
tmplist = dao.query("Ccpq.getSjyFa",
hytxxMap);

tmpStr = "";
for (i = 0; i < tmplist.size(); i++) {
Map t = (Map) tmplist.get(i);
tmpStr += "、<BR>"
+ t.get("XM")
+ "("
+ t.get("CASL")
+ ":"
+ t.get("FAJS")
+ ")"
+ ("1".equals(t.get("DQSFZZ")) ? "(当前中止分案)"
: "");
}
this.addrz("各书记员存案比重信息：<B>"
    + tmpStr.substring(1) + "</B>");
if (tmplist.size() > 0) {
sjyList.clear();
sjyList.add((String) ((Map) tmplist
.get(0)).get("ZYBM"));
}
} else {
hytxxMap.put("HYTCY", hytxxMap.get("SJY"));
hytxxMap.put("CYJS", "'3'");
hytxxMap.put("FJM", fjm);// 不根据承办人区分书记员的轮排
tmplist = dao.query("Ccpq.getSjyFasj",
hytxxMap);

tmpStr = "";
for (i = 0; i < tmplist.size(); i++) {
Map t = (Map) tmplist.get(i);
tmpStr += "、<BR>"
+ t.get("XM")
+ "("
+ (t.get("FASJ") == null ? "三个月内未分案"
: t.get("FASJ"))
+ ")"
+ ("1".equals(t.get("DQSFZZ")) ? "(当前中止分案)"
: "");
}
this.addrz("各书记员分案时间信息：<B>"
    + tmpStr.substring(1) + "</B>");
if (tmplist.size() > 0) {
sjyList.clear();
sjyList.add((String) ((Map) tmplist
.get(0)).get("ZYBM"));
}
}
}
boolean cbrisftz = false;
//是否要组成5人合议庭
String need5rhty = (String) map.get("NEED5RHYT");
String cbrzybm = null;
String cbrxm = null;
for (i = len - 1; i >= 0; i--) {
hytcy = (Hytcy) list.get(i);
drjs = hytcy.getDrjs().intValue();
s = hytcy.getZybm();
if (drjs == 2) {
if ("4".equals(hytcy.getFyzw())) {
cbrisftz = true;
}
cbrzybm = s;
cbrxm = hytcy.getCyxm();
continue;
}
if (drjs == 3) {
if (sjyList.indexOf(s) == -1) {
list.remove(hytcy);
}
} else {
if (drjs == 1) {
if (spzList.indexOf(s) == -1) {
list.remove(hytcy);
}
} else if (drjs == 255 || drjs == 4) {
qthytList.add(hytcy);
if (qthytList.indexOf(s) == -1) {
list.remove(hytcy);
}

}
}
}

if ("ADD2R".equals(need5rhty) || "ALL".equals(need5rhty)) {
int htcy = 0;
String spzzybm = "";
for (int k = 0; k < list.size(); k++) {
hytcy = (Hytcy) list.get(k);
drjs = hytcy.getDrjs().intValue();
s = hytcy.getZybm();
if (drjs == 2) {
continue;
}
if (drjs == 1) {
if ("ADD2R".equals(need5rhty) || "ALL".equals(need5rhty)) {
if (cbrisftz) {
List<Map<String, String>> tzList = dao.query("Hytsz.getBMTZ", map);
if (tzList.size() == 0) {
list.removeAll(list);
obj.put(19, "此案件适合组成五人合议庭，自动分到的承办人为副庭长，在人事系统找到庭长，请与系统管理员联系检查人事数据！");
} else {
list.remove(hytcy);
hytcy.setDrjs(1);
hytcy.setBmdm((String) map.get("CBBM"));
hytcy.setZybm(tzList.get(0).get("ZYBM"));
hytcy.setCyxm(tzList.get(0).get("XM"));
spzzybm = tzList.get(0).get("ZYBM");
list.add(hytcy);
}
} else {
spzzybm = s;
}
}
} else if (drjs == 255 || drjs == 4) {
if ("ALL".equals(need5rhty)) {
list.remove(hytcy);
}
if (!cbrzybm.equals(s)) {
htcy++;
}
}
}
Hytcy hytcybx = new Hytcy();
hytcybx.setFjm(fjm);
hytcybx.setBmdm((String) map.get("CBBM"));
hytcybx.setZybm(cbrzybm);
if (cbrzybm.equals(spzzybm)) {
htcy += 1;
} else {
htcy += 2;
}
if ("ADD2R".equals(need5rhty)) {
hytcybx.setFyzw("--");
List<Hytcy> hytcybxs = dao.query("Hytsz.getAllHytcyxxBX", hytcybx);//----------------------------------
    int listlen = hytcybxs.size();
    int needadd = 5 - htcy;
    if (listlen < needadd) {
    list.removeAll(list);
    obj.put(19, "此案件适合组成五人合议庭，" + cbrxm + ":分配好的五人合议成员只有" + listlen + "！请重新配置五人合议");
    } else {
    Map addMap = new HashMap();
    while (needadd > 0) {
    int get = (int) (Math.random() * listlen);
    if (!addMap.containsKey(get)) {
    addMap.put(get, get);
    Hytcy addHytcy = hytcybxs.get(get);
    list.add(addHytcy);
    this.addrz("从五人其他合议成员中随机加入：<B>"
        + addHytcy.getCyxm() + "</B>");
    needadd--;
    }
    }
    }
    } else {
    hytcybx.setFyzw(null);
    list.removeAll(list);
    List<Hytcy> hytcybxs = dao.query("Hytsz.getAllHytcyxxBX", hytcybx);//----------------------------------
        List allSpzcy = new ArrayList();//用于保存五人合议庭的所有审判长
        List cbrSjyList = new ArrayList();//用于保存主审法官和书记员
        for (Hytcy hytcy2 : hytcybxs) {
        if (hytcy2.getDrjs() != 1) {
        cbrSjyList.add(hytcy2);//保存主审法官和书记员
        }
        if (hytcy2.getDrjs() == 1) {
        spzzybm = hytcy2.getZybm();
        allSpzcy.add(hytcy2);//保存审判长
        /*this.addrz("从五人合议中加入审判长：<B>"
            + hytcy2.getCyxm() + "</B>");*/
        continue;
        }
        if (hytcy2.getDrjs() == 2) {
        cbrzybm = hytcy2.getZybm();
        continue;
        }
        }
        //因现在五人合议庭可以配置多个，所以要随机选择一个审判长
        int allspzLen = allSpzcy.size();
        int spz_idx = (int) (Math.random() * allspzLen);
        Hytcy selectedSpz = (Hytcy) allSpzcy.get(spz_idx);
        spzzybm = selectedSpz.getZybm();
        this.addrz("从五人合议中加入审判长：<B>"
            + selectedSpz.getCyxm() + "</B>");

        //list.addAll(hytcybxs);
        list.addAll(cbrSjyList);//添加合议庭的主审法官和书记员
        list.add(selectedSpz);//添加审判长
        if (cbrzybm.equals(spzzybm)) {
        htcy = 1;
        } else {
        htcy = 2;
        }
        hytcybx.setFyzw("-----");
        List<Hytcy> qthytcybxs = dao.query("Hytsz.getAllHytcyxxBX", hytcybx);//----------------------------------

            int listlen = qthytcybxs.size();
            int needadd = 5 - htcy;
            if (listlen < needadd) {
            list.removeAll(list);
            obj.put(19, "此案件适合组成五人合议庭，" + cbrxm + ":分配好的五人合议成员只有" + listlen + "！请重新配置五人合议");
            } else {
            Map addMap = new HashMap();
            while (needadd > 0) {
            int get = (int) (Math.random() * listlen);
            if (!addMap.containsKey(get)) {
            addMap.put(get, get);
            Hytcy addHytcy = qthytcybxs.get(get);
            list.add(addHytcy);
            this.addrz("从五人其他合议成员中随机加入：<B>"
                + addHytcy.getCyxm() + "</B>");
            needadd--;
            }
            }
            }
            }

            }
            //-
            }
            }
            }
            // 分案合议庭信息
            obj.put(0, this.pack(list));
            } else {
            obj.put(0, "");
            if (iczhyt.length() > 0) {
            iczhyt = iczhyt.substring(1);
            obj.put(19, "允许办理此类案件的主审法官（" + iczhyt
            + "）未配置合议庭信息，请与系统管理员联系！");
            } else {
            obj.put(19, this.farz.toString());
            }
            }
            // 案件类别名称
            obj.put(1, map.get("AJLBMC").toString());
            // 审判程序名称
            Object o = map.get("SPCXMC");
            if (o == null)
            obj.put(2, "无");
            else
            obj.put(2, o.toString());
            // 案件类型
            obj.put(3, map.get("AJLX").toString());
            // 承办部门
            obj.put(4, map.get("CBBM").toString());
            // 分案类型
            obj.put(5, map.get("FALX").toString());
            // 存案比重
            obj.put(6, map.get("CABZ").toString());
            // 承办部门名称
            obj.put(11, map.get("BMMC").toString());

            hm = new HashMap();
            hm.put("AJID", map.get("AJID"));
            hm.put("FJM", fjm);
            hm.put("RZ", this.farz.toString());
            hm.put("CZR", this.czr);
            dao.insert("Ccpq.insertPQRZ", hm);
            } catch (SecurityException e) {
            e.printStackTrace();
            } catch (IllegalArgumentException e) {
            e.printStackTrace();
            } catch (NoSuchMethodException e) {
            e.printStackTrace();
            } catch (IllegalAccessException e) {
            e.printStackTrace();
            } catch (InvocationTargetException e) {
            e.printStackTrace();
            }
            return null;
            }

            private int getCaxx(java.util.HashMap caMap, String cbr, HashMap map,
            Map maxJarq) {
            ArrayList list = (ArrayList) caMap.get(cbr);
            if (list == null) {
            int casl = 0;
            if (map.get("CASL") == null) {
            map.put("CASL", Integer.valueOf("0"));
            } else {
            casl = (Integer) map.get("CASL");
            }
            if (map.get("CASLBYFALX") == null) {
            map.put("CASLBYFALX", Integer.valueOf("0"));
            }
            Date jarq = (Date) maxJarq.get(cbr);
            if (jarq == null) {
            jarq = currDate;
            }
            map.put("LAST_JARQ", jarq);
            return casl;
            }
            int falx; // 系列案序号

            int casl = 0, caslByFalx = 0, tmpsl = 0; // 个人的总的存案数
            Integer oldcasl = (Integer) map.get("CASL");
            if (oldcasl != null) {
            casl = oldcasl.intValue();
            }
            Integer oldcaslbyfals = (Integer) map.get("CASLBYFALX");
            if (oldcaslbyfals != null) {
            caslByFalx = oldcaslbyfals.intValue();
            }

            int i, len = list.size();
            Date jarq = null;
            HashMap temp;
            int o = ((Integer) map.get("FALX")).intValue();

            for (i = 0; i < len; i++) {
            temp = (HashMap) list.get(i);
            falx = ((Integer) temp.get("FALX")).intValue(); // 分案类型
            tmpsl = ((Integer) temp.get("CASLBYFALX")).intValue();
            if (temp.get("XLABH") != null) {
            tmpsl = xlaZS(falx, tmpsl);
            }
            if (o == falx) {
            caslByFalx += tmpsl;
            casl += tmpsl;
            } else {
            casl += tmpsl;
            }
            if (jarq == null) {
            jarq = (Date) temp.get("JARQ");
            }
            }
            if (jarq == null) {
            jarq = currDate;
            }
            map.put("CASLBYFALX", Integer.valueOf(caslByFalx + ""));
            map.put("CASL", Integer.valueOf(casl + ""));
            map.put("LAST_JARQ", jarq);

            return casl;
            }

            private void sortIncrease(java.util.List al) {
            HashMap map = null;
            HashMap tmp = null;
            int MaxSize = 1, j;
            int casl, caslFl, t1, t1fl, paxh1, paxh2;
            double fabl, t2;
            Date lastJarq1, lastJarq2;
            double t3, t4;
            for (int i = 1; i < al.size(); i++) {
            map = (HashMap) al.remove(i);
            if (map == null)
            continue;
            casl = ((Integer) map.get("CASL")).intValue();
            caslFl = ((Integer) map.get("CASLBYFALX")).intValue();
            fabl = ((Double) map.get("FABL")).doubleValue();
            paxh1 = ((Integer) map.get("PAXH")).intValue();
            lastJarq1 = (Date) map.get("LAST_JARQ");
            tmp = (HashMap) al.get(MaxSize - 1);
            t1 = ((Integer) tmp.get("CASL")).intValue();
            t1fl = ((Integer) tmp.get("CASLBYFALX")).intValue();
            t2 = ((Double) tmp.get("FABL")).doubleValue();
            paxh2 = ((Integer) tmp.get("PAXH")).intValue();
            lastJarq2 = (Date) tmp.get("LAST_JARQ");
            t3 = 1.0 * casl / fabl;
            t4 = 1.0 * t1 / t2;
            if (t3 > t4) {
            al.add(MaxSize, map);
            MaxSize++;
            } else if (t3 == t4) {
            if (t2 > fabl) {
            al.add(MaxSize, map);
            MaxSize++;
            } else if (t2 == fabl) {
            if (t1fl > caslFl) {
            if (lastJarq1.after(lastJarq2)) {
            if (paxh1 >= paxh2) {
            al.add(MaxSize, map);
            MaxSize++;
            } else {
            for (j = 0; j < MaxSize; j++) {
            tmp = (HashMap) al.get(j);
            t1 = ((Integer) tmp.get("CASL")).intValue();
            t1fl = ((Integer) tmp.get("CASLBYFALX"))
            .intValue();
            t2 = ((Double) tmp.get("FABL"))
            .doubleValue();
            paxh2 = ((Integer) tmp.get("PAXH"))
            .intValue();
            lastJarq2 = (Date) tmp.get("LAST_JARQ");
            t4 = 1.0 * t1 / t2;
            if (t4 > t3) {
            al.add(j, map);
            MaxSize++;
            break;
            } else if (t3 == t4) {
            if (fabl > t2) {
            al.add(j, map);
            MaxSize++;
            break;
            } else if (t2 == fabl) {
            if (caslFl < t1fl) {
            al.add(j, map);
            MaxSize++;
            break;
            } else if (caslFl == t1fl) {
            if (lastJarq1.before(lastJarq2)) {
            al.add(j, map);
            MaxSize++;
            break;
            } else if (lastJarq1
            .equals(lastJarq2)) {
            if (paxh2 >= paxh1) {
            al.add(j, map);
            MaxSize++;
            break;
            }
            }
            }
            }
            }
            }
            }
            } else {
            for (j = 0; j < MaxSize; j++) {
            tmp = (HashMap) al.get(j);
            t1 = ((Integer) tmp.get("CASL")).intValue();
            t1fl = ((Integer) tmp.get("CASLBYFALX"))
            .intValue();
            t2 = ((Double) tmp.get("FABL")).doubleValue();
            paxh2 = ((Integer) tmp.get("PAXH")).intValue();
            lastJarq2 = (Date) tmp.get("LAST_JARQ");
            t4 = 1.0 * t1 / t2;
            if (t4 > t3) {
            al.add(j, map);
            MaxSize++;
            break;
            } else if (t3 == t4) {
            if (fabl > t2) {
            al.add(j, map);
            MaxSize++;
            break;
            } else if (t2 == fabl) {
            if (caslFl < t1fl) {
            al.add(j, map);
            MaxSize++;
            break;
            } else if (caslFl == t1fl) {
            if (lastJarq1.before(lastJarq2)) {
            al.add(j, map);
            MaxSize++;
            break;
            } else if (lastJarq1
            .equals(lastJarq2)) {
            if (paxh2 >= paxh1) {
            al.add(j, map);
            MaxSize++;
            break;
            }
            }
            }
            }
            }
            }
            }
            } else {
            for (j = 0; j < MaxSize; j++) {
            tmp = (HashMap) al.get(j);
            t1 = ((Integer) tmp.get("CASL")).intValue();
            t1fl = ((Integer) tmp.get("CASLBYFALX")).intValue();
            t2 = ((Double) tmp.get("FABL")).doubleValue();
            paxh2 = ((Integer) tmp.get("PAXH")).intValue();
            lastJarq2 = (Date) tmp.get("LAST_JARQ");
            t4 = 1.0 * t1 / t2;
            if (t4 > t3) {
            al.add(j, map);
            MaxSize++;
            break;
            } else if (t3 == t4) {
            if (fabl > t2) {
            al.add(j, map);
            MaxSize++;
            break;
            } else if (t2 == fabl) {
            if (caslFl < t1fl) {
            al.add(j, map);
            MaxSize++;
            break;
            } else if (caslFl == t1fl) {
            if (lastJarq1.before(lastJarq2)) {
            al.add(j, map);
            MaxSize++;
            break;
            } else if (lastJarq1.equals(lastJarq2)) {
            if (paxh2 >= paxh1) {
            al.add(j, map);
            MaxSize++;
            break;
            }
            }
            }
            }
            }
            }
            }
            } else {
            for (j = 0; j < MaxSize; j++) {
            tmp = (HashMap) al.get(j);
            t1 = ((Integer) tmp.get("CASL")).intValue();
            t1fl = ((Integer) tmp.get("CASLBYFALX")).intValue();
            t2 = ((Double) tmp.get("FABL")).doubleValue();
            paxh2 = ((Integer) tmp.get("PAXH")).intValue();
            lastJarq2 = (Date) tmp.get("LAST_JARQ");
            t4 = 1.0 * t1 / t2;
            if (t4 > t3) {
            al.add(j, map);
            MaxSize++;
            break;
            } else if (t3 == t4) {
            if (fabl > t2) {
            al.add(j, map);
            MaxSize++;
            break;
            } else if (t2 == fabl) {
            if (caslFl < t1fl) {
            al.add(j, map);
            MaxSize++;
            break;
            } else if (caslFl == t1fl) {
            if (lastJarq1.before(lastJarq2)) {
            al.add(j, map);
            MaxSize++;
            break;
            } else if (lastJarq1.equals(lastJarq2)) {
            if (paxh2 >= paxh1) {
            al.add(j, map);
            MaxSize++;
            break;
            }
            }
            }
            }
            }
            }
            }
            } else {
            for (j = 0; j < MaxSize; j++) {
            tmp = (HashMap) al.get(j);
            t1 = ((Integer) tmp.get("CASL")).intValue();
            t1fl = ((Integer) tmp.get("CASLBYFALX")).intValue();
            t2 = ((Double) tmp.get("FABL")).doubleValue();
            paxh2 = ((Integer) tmp.get("PAXH")).intValue();
            lastJarq2 = (Date) tmp.get("LAST_JARQ");
            t4 = 1.0 * t1 / t2;
            if (t4 > t3) {
            al.add(j, map);
            MaxSize++;
            break;
            } else if (t3 == t4) {
            if (fabl > t2) {
            al.add(j, map);
            MaxSize++;
            break;
            } else if (t2 == fabl) {
            if (caslFl < t1fl) {
            al.add(j, map);
            MaxSize++;
            break;
            } else if (caslFl == t1fl) {
            if (lastJarq1.before(lastJarq2)) {
            al.add(j, map);
            MaxSize++;
            break;
            } else if (lastJarq1.equals(lastJarq2)) {
            if (paxh2 >= paxh1) {
            al.add(j, map);
            MaxSize++;
            break;
            }
            }
            }
            }
            }
            }
            }
            }
            }

            private void sortIncreaseForKfafgxx(java.util.List al) {
            Kfafgxx map = null;
            Kfafgxx tmp = null;
            int MaxSize = 1, j;
            int casl, caslFl, t1, t1fl, paxh1, paxh2;
            double fabl, t2;
            Date lastJarq1, lastJarq2;
            double t3, t4;
            for (int i = 1; i < al.size(); i++) {
            map = (Kfafgxx) al.remove(i);
            if (map == null)
            continue;

            casl = Integer.parseInt(map.getCasl());
            caslFl = Integer.parseInt(map.getCaslByFalx());
            fabl = Double.parseDouble(map.getFabl());
            paxh1 = Integer.parseInt(map.getPaxh());
            lastJarq1 = map.getJarq();
            tmp = (Kfafgxx) al.get(MaxSize - 1);
            t1 = Integer.parseInt(tmp.getCasl());
            t1fl = Integer.parseInt(tmp.getCaslByFalx());
            t2 = Double.parseDouble(tmp.getFabl());
            paxh2 = Integer.parseInt(tmp.getPaxh());
            lastJarq2 = tmp.getJarq();
            t3 = 1.0 * casl / fabl;
            t4 = 1.0 * t1 / t2;
            if (t3 > t4) {
            al.add(MaxSize, map);
            MaxSize++;
            } else if (t3 == t4) {
            if (t2 > fabl) {
            al.add(MaxSize, map);
            MaxSize++;
            } else if (t2 == fabl) {
            if (t1fl > caslFl) {
            if (lastJarq1.after(lastJarq2)) {
            if (paxh1 >= paxh2) {
            al.add(MaxSize, map);
            MaxSize++;
            } else {
            for (j = 0; j < MaxSize; j++) {
            tmp = (Kfafgxx) al.get(j);
            t1 = Integer.parseInt(tmp.getCasl());
            t1fl = Integer
            .parseInt(tmp.getCaslByFalx());
            t2 = Double.parseDouble(tmp.getFabl());
            paxh2 = Integer.parseInt(tmp.getPaxh());
            lastJarq2 = tmp.getJarq();
            t4 = 1.0 * t1 / t2;
            if (t4 > t3) {
            al.add(j, map);
            MaxSize++;
            break;
            } else if (t3 == t4) {
            if (fabl > t2) {
            al.add(j, map);
            MaxSize++;
            break;
            } else if (t2 == fabl) {
            if (caslFl < t1fl) {
            al.add(j, map);
            MaxSize++;
            break;
            } else if (caslFl == t1fl) {
            if (lastJarq1.before(lastJarq2)) {
            al.add(j, map);
            MaxSize++;
            break;
            } else if (lastJarq1
            .equals(lastJarq2)) {
            if (paxh2 >= paxh1) {
            al.add(j, map);
            MaxSize++;
            break;
            }
            }
            }
            }
            }
            }
            }
            } else {
            for (j = 0; j < MaxSize; j++) {
            tmp = (Kfafgxx) al.get(j);
            t1 = Integer.parseInt(tmp.getCasl());
            t1fl = Integer.parseInt(tmp.getCaslByFalx());
            t2 = Double.parseDouble(tmp.getFabl());
            paxh2 = Integer.parseInt(tmp.getPaxh());
            lastJarq2 = tmp.getJarq();
            t4 = 1.0 * t1 / t2;
            if (t4 > t3) {
            al.add(j, map);
            MaxSize++;
            break;
            } else if (t3 == t4) {
            if (fabl > t2) {
            al.add(j, map);
            MaxSize++;
            break;
            } else if (t2 == fabl) {
            if (caslFl < t1fl) {
            al.add(j, map);
            MaxSize++;
            break;
            } else if (caslFl == t1fl) {
            if (lastJarq1.before(lastJarq2)) {
            al.add(j, map);
            MaxSize++;
            break;
            } else if (lastJarq1
            .equals(lastJarq2)) {
            if (paxh2 >= paxh1) {
            al.add(j, map);
            MaxSize++;
            break;
            }
            }
            }
            }
            }
            }
            }
            } else {
            for (j = 0; j < MaxSize; j++) {
            tmp = (Kfafgxx) al.get(j);
            t1 = Integer.parseInt(tmp.getCasl());
            t1fl = Integer.parseInt(tmp.getCaslByFalx());
            t2 = Double.parseDouble(tmp.getFabl());
            paxh2 = Integer.parseInt(tmp.getPaxh());
            lastJarq2 = tmp.getJarq();
            t4 = 1.0 * t1 / t2;
            if (t4 > t3) {
            al.add(j, map);
            MaxSize++;
            break;
            } else if (t3 == t4) {
            if (fabl > t2) {
            al.add(j, map);
            MaxSize++;
            break;
            } else if (t2 == fabl) {
            if (caslFl < t1fl) {
            al.add(j, map);
            MaxSize++;
            break;
            } else if (caslFl == t1fl) {
            if (lastJarq1.before(lastJarq2)) {
            al.add(j, map);
            MaxSize++;
            break;
            } else if (lastJarq1.equals(lastJarq2)) {
            if (paxh2 >= paxh1) {
            al.add(j, map);
            MaxSize++;
            break;
            }
            }
            }
            }
            }
            }
            }
            } else {
            for (j = 0; j < MaxSize; j++) {
            tmp = (Kfafgxx) al.get(j);
            t1 = Integer.parseInt(tmp.getCasl());
            t1fl = Integer.parseInt(tmp.getCaslByFalx());
            t2 = Double.parseDouble(tmp.getFabl());
            paxh2 = Integer.parseInt(tmp.getPaxh());
            lastJarq2 = tmp.getJarq();
            t4 = 1.0 * t1 / t2;
            if (t4 > t3) {
            al.add(j, map);
            MaxSize++;
            break;
            } else if (t3 == t4) {
            if (fabl > t2) {
            al.add(j, map);
            MaxSize++;
            break;
            } else if (t2 == fabl) {
            if (caslFl < t1fl) {
            al.add(j, map);
            MaxSize++;
            break;
            } else if (caslFl == t1fl) {
            if (lastJarq1.before(lastJarq2)) {
            al.add(j, map);
            MaxSize++;
            break;
            } else if (lastJarq1.equals(lastJarq2)) {
            if (paxh2 >= paxh1) {
            al.add(j, map);
            MaxSize++;
            break;
            }
            }
            }
            }
            }
            }
            }
            } else {
            for (j = 0; j < MaxSize; j++) {
            tmp = (Kfafgxx) al.get(j);
            t1 = Integer.parseInt(tmp.getCasl());
            t1fl = Integer.parseInt(tmp.getCaslByFalx());
            t2 = Double.parseDouble(tmp.getFabl());
            paxh2 = Integer.parseInt(tmp.getPaxh());
            lastJarq2 = tmp.getJarq();
            t4 = 1.0 * t1 / t2;
            if (t4 > t3) {
            al.add(j, map);
            MaxSize++;
            break;
            } else if (t3 == t4) {
            if (fabl > t2) {
            al.add(j, map);
            MaxSize++;
            break;
            } else if (t2 == fabl) {
            if (caslFl < t1fl) {
            al.add(j, map);
            MaxSize++;
            break;
            } else if (caslFl == t1fl) {
            if (lastJarq1.before(lastJarq2)) {
            al.add(j, map);
            MaxSize++;
            break;
            } else if (lastJarq1.equals(lastJarq2)) {
            if (paxh2 >= paxh1) {
            al.add(j, map);
            MaxSize++;
            break;
            }
            }
            }
            }
            }
            }
            }
            }
            }

            /**
            * 获得排定单信息
            *
            * @param context
            * @return jsonstring
            */
            public String getPDDInfo(ApplicationContext context) {
            IIbatisDAO dao = (IIbatisDAO) context.getBean("ibatisDAO");
            JSONObject returnJson = new JSONObject();
            SimpleDateFormat sf = new SimpleDateFormat("yyyy-MM-dd");
            SimpleDateFormat sft = new SimpleDateFormat("yyyy-MM-dd HH:mm:ss");
            String ajids[] = ajid.split(",");
            JSONArray ja = new JSONArray();
            for (int j = 0; j < ajids.length; j++) {
            JSONObject retJson = new JSONObject();
            List list = dao.query("Ccpq.getPDDInfo", ajids[j]);
            HashMap ajjbxx = (HashMap) list.get(0);
            String sfjm = ajjbxx.get("CBFY").toString();
            Date dt = new Date();
            retJson.put("xtrq", sf.format(dt));
            retJson.put("ah", ajjbxx.get("AH"));
            Object o = ajjbxx.get("LARQ");
            if (o == null)
            retJson.put("larq", "");
            else
            retJson.put("larq", o.toString());
            if (ajjbxx.get("LAAY") != null)
            retJson
            .put("ay", Dict.getInstance().getAyDictMc(
            Integer.valueOf(ajjbxx.get("LAAY").toString()),
            "aynr"));
            o = ajjbxx.get("YJARQ");
            if (o == null)
            retJson.put("sxdqr", "");
            else
            retJson.put("sxdqr", o.toString());
            retJson.put("larxm", ajjbxx.get("LAR"));
            // 原审情况
            Ysqk ysinfo = new Ysqk();
            ysinfo.setAjid(ajids[j]);
            ysinfo.setSfdq("1");
            List yslist = dao.query("Ladj.Ysqk.selectByAjid", ysinfo);
            if (yslist.size() > 0) {
            Ysqk ys = (Ysqk) yslist.get(0);
            String ysfymc = ys.getYysfymc();
            if (ysfymc != null && ysfymc.length() > 0)
            retJson.put("ysfy", ysfymc);
            else
            retJson.put("ysfy", "");
            String ysah = ys.getYysah();
            if (ysah != null && ysah.length() > 0)
            retJson.put("ysah", ysah);
            else
            retJson.put("ysah", "");
            } else {
            retJson.put("ysfy", "");
            retJson.put("ysah", "");
            }
            List ls = dao.query("Ccpq.getPqInfo", ajids[j]);
            if (ls.size() > 0) {
            HashMap pqxx = (HashMap) ls.get(0);
            retJson.put("cbt", Dict.getInstance().getBmDictMc(sfjm,
            pqxx.get("CBBM").toString(), "bmqc"));
            retJson.put("cbr", pqxx.get("ZSFG"));
            retJson.put("spz", pqxx.get("SPZ"));
            retJson.put("qthytcy", pqxx.get("QTHYTCY"));
            retJson.put("sjy", pqxx.get("SJY"));
            if (pqxx.get("KTFT") != null
            && pqxx.get("KTFT").toString().length() > 0)
            retJson.put("ktdd", pqxx.get("KTFT"));
            else
            retJson.put("ktdd", "");
            if (pqxx.get("YJKSSJ") != null)
            retJson.put("ktkssj", sft.format(pqxx.get("YJKSSJ")));
            else
            retJson.put("ktkssj", "");

            if (pqxx.get("YJJSSJ") != null)
            retJson.put("ktjssj", sft.format(pqxx.get("YJJSSJ")));
            else
            retJson.put("ktjssj", "");

            if (pqxx.get("TSBLY") != null)
            retJson.put("tsbly", pqxx.get("TSBLY"));
            else
            retJson.put("tsbly", "");

            o = pqxx.get("GKKT");
            if (o != null)
            retJson.put("gkkt", Dict.getInstance().getDictMc("310",
            o.toString()));
            else
            retJson.put("gkkt", "");

            if (pqxx.get("QTCYRY") != null)
            retJson.put("qtcyry", pqxx.get("QTCYRY"));
            else
            retJson.put("qtcyry", "");

            retJson.put("far", pqxx.get("PQFGXM"));
            retJson.put("farq", sf.format(pqxx.get("PQSJ")));
            o = pqxx.get("FTYT");
            if (o != null)
            retJson.put("ftyt", Dict.getInstance().getDictMc("SP106",
            o.toString()));
            else
            retJson.put("ftyt", "");
            if (pqxx.get("TC") != null)
            retJson.put("tc", pqxx.get("TC"));
            else
            retJson.put("tc", "1");
            if (pqxx.get("PQFS").toString().equals("1"))
            retJson.put("pdfs", "自动");
            else
            retJson.put("pdfs", "手动");

            if (pqxx.get("pqlx").toString().equals("0"))
            retJson.put("falx", "初排");
            else
            retJson.put("falx", "重排");
            }
            // 当事人信息
            Dsrxx dsr = new Dsrxx();
            dsr.setAjid(ajids[j]);
            List dsrList = dao.query("Dsrxx.getDsrOdrBy", dsr);
            String dsrStr = "";
            for (int i = 0; i < dsrList.size(); i++) {
            Dsrxx dx = (Dsrxx) dsrList.get(i);
            String tmp = dx.getSsdwmc() + ":" + dx.getDsrmc();
            dsrStr += tmp + "\r";
            }
            retJson.put("dsr", dsrStr);
            ja.put(retJson);
            }
            returnJson.put("data", ja);
            returnJson.put("res", "true");
            return returnJson.toString();
            }

            public void getPDDInfoWord(ApplicationContext ctx,
            HttpServletResponse response) throws Exception {
            response.setHeader("Content-Disposition", "attachment;filename="
            + new String("案件排定通知单".getBytes("GBK"), "ISO8859-1"));
            response.setContentType("application/msword");

            IIbatisDAO dao = (IIbatisDAO) ctx.getBean("ibatisDAO");
            String[] ajids = this.ajid.split(",");
            if (ajids.length <= 10) {
            for (int i = 0; i < ajids.length; i++) {
            List list = dao.query("Ccpq.getAjlbSpcx", ajids[i]);
            HashMap map = (HashMap) list.get(0);
            String spcx = map.get("SPCX").toString();
            String ajlb = map.get("AJLB").toString();

            HashMap tabMap = null;
            String wordname = "";
            if (this.getSfcp().equals("1")) {
            wordname = "ajcxpdd.doc";
            } else {
            wordname = "ajpdtzd.doc";
            }
            // 深圳中院使用的排定单
            if ("J30".equals(this.fjm)) {
            wordname = "szpqpdd.doc";
            tabMap = makeWordTabMapForSzpdd(ctx);
            } else if ("4".equals(spcx) && "2".equals(ajlb)) {//民事申诉申请的需要把“原审被告”放在“第三人”的前面
            tabMap = printWordTabMapMs_sssq(ctx);
            } else {
            tabMap = printWordTabMap(ctx);
            }
            if (this.getSfcp().equals("1")) {
            WritManager wmcp = new WritManager(wordname);
            wmcp.setTabMap(tabMap);
            // /wm.createDocsToFile("court/oa/baobiao/dbajdy1.doc");
            wmcp.createDocsToResp(response);
            } else {
            WritManager wm = new WritManager(wordname);
            wm.setTabMap(tabMap);
            wm.createDocsToResp(response);
            }
            }
            }
            }

            /**
            * 组装排定单为深圳中院使用
            *
            * @param ctx
            * @return
            */
            public HashMap makeWordTabMapForSzpdd(ApplicationContext ctx) {
            IIbatisDAO dao = (IIbatisDAO) ctx.getBean("ibatisDAO");
            String[] ajids = this.ajid.split(",");
            HashMap tabMap = new HashMap();
            List tableCols = new ArrayList();
            tableCols.add("案件类别");
            tableCols.add("案号");
            tableCols.add("原审案号");
            tableCols.add("案由");
            tableCols.add("收案日期");
            tableCols.add("立案日期");
            tableCols.add("诉讼标的");
            tableCols.add("受理费");
            tableCols.add("是否保全");
            tableCols.add("开庭时间");
            tableCols.add("审判法庭");
            tableCols.add("审判长");
            tableCols.add("主审法官");
            tableCols.add("合议成员");
            tableCols.add("书记官");
            tableCols.add("当事人");
            tableCols.add("庭长确认");
            tableCols.add("当事人");
            tableCols.add("备注");
            tableCols.add("打印人");
            tableCols.add("审限日期");
            List tabColsList = new ArrayList();
            tabColsList.add(tableCols);

            for (int i = 0; i < ajids.length; i++) {
            Map rows = new HashMap();
            List lista = dao.query("Ccpq.getPDDInfo", ajids[i]);
            HashMap ajjbxx = (HashMap) lista.get(0);
            String sfjm = ajjbxx.get("CBFY").toString();
            Object tempstr = null;

            tempstr = ajjbxx.get("AJLB");
            if (tempstr != null) {
            tempstr = Dict.getInstance().getDictMc("SP50",
            tempstr.toString());
            }
            rows.put("案件类别", tempstr.toString());
            tempstr = ajjbxx.get("AH");
            rows.put("案号", tempstr == null ? "" : tempstr.toString());

            // 原审情况
            Ysqk ysinfo = new Ysqk();
            ysinfo.setAjid(ajids[i]);
            ysinfo.setSfdq("1");
            List yslist = dao.query("Ladj.Ysqk.selectYSxxAll", ysinfo);
            String ysahAll = "";
            if (yslist.size() > 0) {
            for (int k = 0; k < yslist.size(); k++) {
            Ysqk ys = (Ysqk) yslist.get(k);
            if (ys.getYysah() != null)
            ysahAll += "\r" + ys.getYysah();
            }
            if (ysahAll.length() > 0)
            ysahAll = ysahAll.substring(1);
            rows.put("原审案号", ysahAll);
            } else {
            rows.put("原审案号", "");
            }

            if (ajjbxx.get("LAAY") != null)
            rows
            .put("案由", Dict.getInstance().getAyDictMc(
            Integer.valueOf(ajjbxx.get("LAAY").toString()),
            "aynr"));

            tempstr = ajjbxx.get("SDSZRQ");
            rows.put("收案日期", tempstr == null ? "" : tempstr.toString());

            tempstr = ajjbxx.get("LARQ");
            rows.put("立案日期", tempstr == null ? "" : tempstr.toString());

            tempstr = ajjbxx.get("SSBD");
            rows.put("诉讼标的", (tempstr == null ? "0.00" : tempstr.toString())
            + "元");

            tempstr = ajjbxx.get("YJSSF");
            rows.put("受理费", tempstr == null ? "" : tempstr.toString()
            .substring(0, tempstr.toString().length() - 2));

            tempstr = ajjbxx.get("YJARQ");
            rows.put("审限日期", tempstr == null ? "" : tempstr.toString());

            List ssbqList = dao.query("Ccpq.checkSfbq", ajids[i]);
            if (ssbqList.size() > 0) {
            tempstr = "是";
            } else {
            tempstr = "无";
            }
            rows.put("是否保全", tempstr);

            List ls = null;
            if (this.getPqxh() == null || "".equals(this.getPqxh())) {
            ls = dao.query("Ccpq.getPqInfo", ajids[i]);
            } else {
            Map temp = new HashMap();
            temp.put("ajid", ajids[i]);
            temp.put("pqxh", this.pqxh);
            ls = dao.query("Ccpq.getPqInfoByPqxhXG", temp);
            }

            if (ls.size() > 0) {
            HashMap pqxx = (HashMap) ls.get(0);

            tempstr = pqxx.get("YJKSSJ");
            rows.put("开庭时间", tempstr == null ? "" : tempstr.toString());

            tempstr = pqxx.get("KTFT");
            rows.put("审判法庭", tempstr == null ? "" : tempstr.toString());

            tempstr = pqxx.get("SPZ");
            String spz = tempstr == null ? "" : tempstr.toString();

            tempstr = pqxx.get("ZSFG");
            rows.put("主审法官", tempstr == null ? "" : tempstr.toString());

            tempstr = pqxx.get("QTHYTCY");
            rows.put("合议成员", tempstr == null ? spz : ("".equals(spz) ? ""
            : spz + "、")
            + tempstr.toString().replaceAll(",", "、"));

            tempstr = pqxx.get("SJY");
            rows.put("书记官", tempstr == null ? "" : tempstr.toString());

            tempstr = pqxx.get("BZ");
            rows.put("备注", tempstr == null ? "" : tempstr.toString());

            }

            // 当事人信息
            Dsrxx dsr = new Dsrxx();
            dsr.setAjid(ajids[i]);
            List dsrList = dao.query("Dsrxx.getDsrOdrBy", dsr);
            String dsrStr = "";
            String Ai = "";
            for (int j = 0; j < dsrList.size(); j++) {
            Dsrxx dx = (Dsrxx) dsrList.get(j);
            String yssdwxx = "";
            if ("2".equals(dx.getSpcx()) && !"8".equals(dx.getSpcx())) {
            yssdwxx = "（原审" + dx.getYsssdwmc() + ")";
            }
            if (dx.getSsdw() == null) {
            String tmp = dx.getDsrmc();
            if (j == 0) {
            dsrStr += tmp;
            } else {
            dsrStr += "\r" + tmp;
            }
            } else {
            if (Ai.equals(dx.getSsdw())) {

            String tmp = "、" + yssdwxx + dx.getDsrmc();
            dsrStr += tmp;
            } else {
            String tmp = dx.getSsdwmc() + yssdwxx + "："
            + dx.getDsrmc();
            if (j == 0) {
            dsrStr += tmp;
            } else {
            dsrStr += "\r" + tmp;
            }
            }

            /*
            * if (j == 9) { dsrStr += "更多、、"; break; }
            */
            Ai = dx.getSsdw();
            }
            }
            rows.put("当事人", dsrStr);

            tempstr = ajjbxx.get("TZQR");
            rows.put("庭长确认", tempstr == null ? "" : tempstr.toString());

            tempstr = SessionManager.getInstance().getCurrentUser(this.czr)
            .getXm();
            rows.put("打印人", tempstr == null ? "" : tempstr.toString());

            tabColsList.add(rows);

            }

            tabMap.put("szpqpdd", tabColsList);

            return tabMap;
            }

            //民事申诉申请
            public HashMap printWordTabMapMs_sssq(ApplicationContext ctx) {
            IIbatisDAO dao = (IIbatisDAO) ctx.getBean("ibatisDAO");
            SimpleDateFormat sf = new SimpleDateFormat("yyyy-MM-dd");
            SimpleDateFormat sft = new SimpleDateFormat("yyyy-MM-dd HH:mm:ss");
            String[] ajids = this.ajid.split(",");
            HashMap tabMap = new HashMap();
            List tableCols = new ArrayList();
            tableCols.add("案号");
            tableCols.add("立案时间");
            tableCols.add("原审案号");
            tableCols.add("原审法院");
            tableCols.add("案由");
            tableCols.add("审限时间");
            tableCols.add("立案人");
            tableCols.add("当事人");
            tableCols.add("业务庭");
            tableCols.add("承办人");
            tableCols.add("审判长");
            tableCols.add("合议庭成员");
            tableCols.add("书记员");
            tableCols.add("开庭法庭");
            tableCols.add("开庭时间");
            tableCols.add("预计开庭截止时间");
            tableCols.add("排期日期");
            tableCols.add("排期法官");
            tableCols.add("排定方式");
            tableCols.add("速记员");
            tableCols.add("备注");
            tableCols.add("查询密码");//add by yy
            tableCols.add("当前时间");
            tableCols.add("争议标的金额");
            tableCols.add("审判程序");
            tableCols.add("预交诉讼费");
            tableCols.add("涉外情况");
            tableCols.add("减免情况");
            tableCols.add("册数");
            tableCols.add("案件来源");
            tableCols.add("录入人");

            tableCols.add("最高刑罚");
            tableCols.add("最高刑罚内容");
            tableCols.add("适用程序");
            tableCols.add("适用程序内容");
            tableCols.add("一审欠费金额");
            tableCols.add("一审金额");
            tableCols.add("二审欠费金额");
            tableCols.add("二审金额");
            tableCols.add("再审欠费金额");
            tableCols.add("再审金额");
            tableCols.add("公诉人");
            tableCols.add("公诉人内容");
            tableCols.add("立案庭审批");

            tableCols.add("立案庭签名");
            tableCols.add("立案庭审批时间");

            tableCols.add("业务庭审批");

            tableCols.add("业务庭签名");
            tableCols.add("业务庭审批时间");
            tableCols.add("重排原因");

            // 重排信息
            tableCols.add("业务庭2");
            tableCols.add("承办人2");
            tableCols.add("审判长2");
            tableCols.add("合议庭成员2");
            tableCols.add("书记员2");
            tableCols.add("开庭法庭2");
            tableCols.add("开庭时间2");
            tableCols.add("预计开庭截止时间2");
            tableCols.add("排期日期2");
            tableCols.add("排期法官2");
            tableCols.add("排定方式2");
            tableCols.add("速记员2");

            List temp = new ArrayList();
            List list = new ArrayList();
            String lwdwlxr;
            temp.add(tableCols);
            for (int i = 0; i < ajids.length; i++) {
            Map rows = new HashMap();
            List lista = dao.query("Ccpq.getPDDInfo", ajids[i]);
            HashMap ajjbxx = (HashMap) lista.get(0);
            String sfjm = ajjbxx.get("CBFY").toString();
            Date dt = new Date();
            rows.put("当前时间", sf.format(dt));
            rows.put("案号", ajjbxx.get("AH"));

            Object o = ajjbxx.get("LARQ");
            if (o == null)
            rows.put("立案时间", "");
            else
            rows.put("立案时间", sf.format(o));
            if (ajjbxx.get("LAAY") != null)
            rows
            .put("案由", Dict.getInstance().getAyDictMc(
            Integer.valueOf(ajjbxx.get("LAAY").toString()),
            "aynr"));
            o = ajjbxx.get("BEIZHU");
            if (o == null)
            rows.put("备注", "");
            else
            rows.put("备注", o);
            //省高院的备注设置为空,2015年4月2日,ljb
            if (this.getFjm().equals("J00")) {
            rows.put("备注", "");
            }

            //惠东加查询密码     add by yy
            if (ajjbxx.get("CBFY").equals("JD4")) {
            o = ajjbxx.get("CXMM");
            if (o == null) {
            rows.put("查询密码", "");
            } else
            rows.put("查询密码", o);
            } else {
            o = ajjbxx.get("CXMM");
            rows.put("查询密码", "");
            }

            o = ajjbxx.get("YJARQ");
            if (o == null)
            rows.put("审限时间", "");
            else
            rows.put("审限时间", sf.format(o));

            rows.put("争议标的金额", ajjbxx.get("SSBD") == null ? "" : ajjbxx.get(
            "SSBD").toString());

            String lbbm = "";
            String ajlb = (String) ajjbxx.get("AJLB");
            switch (Integer.parseInt(ajlb)) {
            case 1:
            lbbm = "SP107";
            break;
            case 2:
            lbbm = "SP154";
            break;
            case 6:
            lbbm = "SP184";
            break;
            case 7:
            lbbm = "SP294";
            break;
            case 8:
            lbbm = "SP260";
            break;
            }

            String spcx = (String) ajjbxx.get("SPCX");
            rows.put("审判程序", Dict.getInstance().getDictMc(lbbm, spcx));

            // rows.put("审判程序",
            // this.yltsbly==null?"":Escape.unescape(Base64.base64Decode
            // (yltsbly)));

            rows.put("预交诉讼费", ajjbxx.get("YJSSF") == null ? "" : ajjbxx.get(
            "YJSSF").toString().substring(0,
            ajjbxx.get("YJSSF").toString().length() - 2));
            if (ajjbxx.get("AJSJ") == null) {
            rows.put("涉外情况", "");
            } else {
            rows.put("涉外情况", Dict.getInstance().getDictMc("SP51",
            (String) ajjbxx.get("AJSJ")));
            }

            rows.put("减免情况", ajjbxx.get("JMQK") == null ? "" : ajjbxx.get(
            "JMQK").toString());
            rows.put("册数", ajjbxx.get("AJCS") == null ? "" : ajjbxx.get("AJCS")
            .toString());
            if (ajjbxx.get("AJLY") == null) {
            rows.put("案件来源", "");
            } else {
            rows.put("案件来源", Dict.getInstance().getDMMC(
            (String) ajjbxx.get("AJLB"),
            (String) ajjbxx.get("SPCX"), "3",
            (String) ajjbxx.get("AJLY")));
            }

            Object lar = ajjbxx.get("LAR");
            rows.put("立案人", lar == null ? "" : lar);

            Object lrrxm = ajjbxx.get("LRRXM");
            rows.put("录入人", lrrxm == null ? "" : lrrxm);

            // 原审情况
            Ysqk ysinfo = new Ysqk();
            ysinfo.setAjid(ajids[i]);
            ysinfo.setSfdq("1");
            List yslist = dao.query("Ladj.Ysqk.selectYSxxAll", ysinfo);
            String ysfyAll = "";
            String ysahAll = "";
            String ysje = "";
            String esje = "";
            String zsje = "";
            if (yslist.size() > 0) {
            for (int k = 0; k < yslist.size(); k++) {
            Ysqk ys = (Ysqk) yslist.get(k);
            if ("1".equals(ys.getSpcx())) {
            ysje = ys.getQfje();
            } else if ("2".equals(ys.getSpcx())) {
            esje = ys.getQfje();
            } else if ("3".equals(ys.getSpcx())) {
            zsje = ys.getQfje();
            }
            if (ys.getYysfymc() != null)
            ysfyAll += "\r" + ys.getYysfymc();
            if (ys.getYysah() != null)
            ysahAll += "\r" + ys.getYysah();
            }
            if (ysfyAll.length() > 0)
            ysfyAll = ysfyAll.substring(1);
            if (ysahAll.length() > 0)
            ysahAll = ysahAll.substring(1);
            rows.put("原审法院", ysfyAll);
            rows.put("原审案号", ysahAll);
            } else {
            rows.put("原审法院", "");
            rows.put("原审案号", "");
            }

            if (ajlb.equals("8") && spcx.equals("1")) {
            rows.put("一审欠费金额", "一审欠费金额");
            rows.put("一审金额", ysje);
            rows.put("二审欠费金额", "二审欠费金额");
            rows.put("二审金额", esje);
            rows.put("再审欠费金额", "再审欠费金额");
            rows.put("再审金额", zsje);
            } else {
            rows.put("一审欠费金额", "");
            rows.put("一审金额", "");
            rows.put("二审欠费金额", "");
            rows.put("二审金额", "");
            rows.put("再审欠费金额", "");
            rows.put("再审金额", "");
            }

            if (ajlb.equals("1") && !(spcx.equals("1"))) {
            rows.put("最高刑罚", "原审最重刑罚");

            List zgxf = dao.query("Ladj.Ysqk.selectByAjidForPJQK", ysinfo);
            if (zgxf.size() > 0) {
            String zgxfnr = (String) zgxf.get(0);
            rows.put("最高刑罚内容", Dict.getInstance().getDictMc("SP116",
            zgxfnr));
            } else {
            rows.put("最高刑罚内容", "");
            }
            } else {
            if (ajlb.equals("1") && spcx.equals("1")) {
            o = ajjbxx.get("GSR1");
            if (o == null) {
            rows.put("公诉人内容", "");
            } else {
            rows.put("公诉人内容", o.toString());
            }
            rows.put("公诉人", "公诉人");
            }
            rows.put("最高刑罚", "");
            rows.put("最高刑罚内容", "");
            }

            if (("1".equals(ajlb) || "2".equals(ajlb)) && "1".equals(spcx)) {
            rows.put("适用程序", "适用程序");
            o = ajjbxx.get("SYCX");
            if (o == null)
            rows.put("适用程序内容", Dict.getInstance().getDictMc("SP108",
            "2"));
            else
            rows.put("适用程序内容", Dict.getInstance().getDictMc("SP108",
            (String) o));

            } else {
            rows.put("适用程序", "");
            rows.put("适用程序内容", "");
            }

            List ls = dao.query("Ccpq.getPqInfo", ajids[i]);

            List lsnext = dao.query("Ccpq.getPqInfoMinone", ajids[i]);
            if (ls.size() > 0) {
            for (int j = 0; j < ls.size(); j++) {
            HashMap pqxx = (HashMap) ls.get(j);
            // 法庭用途为证据交换时，不取值
            if ("5".equals(pqxx.get("FTYT"))) {
            continue;
            } else {
            rows.put("业务庭", Dict.getInstance().getBmDictMc(sfjm,
            pqxx.get("CBBM").toString(), "bmqc"));
            rows.put("承办人", pqxx.get("ZSFG"));
            rows.put("审判长", pqxx.get("SPZ"));
            rows.put("合议庭成员", pqxx.get("QTHYTCY"));
            rows.put("书记员", pqxx.get("SJY"));
            Object object = pqxx.get("PQFGXM");
            if (object == null) {
            rows.put("排期法官", "");
            } else {
            rows.put("排期法官", object);
            }
            if (pqxx.get("PQSJ") != null) {
            rows.put("排期日期", sf.format(pqxx.get("PQSJ")));
            } else {
            rows.put("排期日期", "");
            }
            if (pqxx.get("KTFT") != null
            && pqxx.get("KTFT").toString().length() > 0)
            rows.put("开庭法庭", pqxx.get("KTFT"));
            else
            rows.put("开庭法庭", "");
            if (pqxx.get("YJKSSJ") != null)
            rows.put("开庭时间", sft.format(pqxx.get("YJKSSJ")));
            else
            rows.put("开庭时间", "");
            if (pqxx.get("YJJSSJ") != null)
            rows
            .put("预计开庭截止时间", sft.format(pqxx
            .get("YJJSSJ")));
            else
            rows.put("预计开庭截止时间", "");

            if (pqxx.get("PQFS").toString().equals("1"))
            rows.put("排定方式", "自动");
            else
            rows.put("排定方式", "手动");
            if (pqxx.get("TSBLY") != null)
            rows.put("速记员", pqxx.get("TSBLY"));
            else
            rows.put("速记员", "");

            if (pqxx.get("CPYY") == null) {
            rows.put("重排原因", "");
            } else {
            rows.put("重排原因", pqxx.get("CPYY"));
            }
            break; // 只取一次值
            }
            }
            }

            // 重排信息

            if (lsnext.size() > 0) {

            List spqk = dao.query("Ccpq.getSpYJ", ajids[i]);// 审批情况
            if (spqk.size() > 0) {
            HashMap ywtsp = (HashMap) spqk.get(0);

            if (ywtsp.get("spyj") == null) {
            rows.put("业务庭审批", "");
            } else {
            rows.put("业务庭审批", ywtsp.get("SPYJ"));
            }
            Object xm = ywtsp.get("XM");

            rows.put("业务庭签名", xm == null ? "" : xm);

            Object sprq = sf.format(ywtsp.get("SPRQ"));
            rows.put("业务庭审批时间", sprq == null ? "" : sprq);
            if (spqk.size() > 1) {
            HashMap latsp = (HashMap) spqk.get(1);
            if (latsp.get("SPYJ") == null) {
            rows.put("立案庭审批", "");
            } else {
            rows.put("立案庭审批", latsp.get("SPYJ"));
            }
            rows.put("立案庭签名", latsp.get("XM"));
            if (latsp.get("SPRQ") == null) {
            rows.put("立案庭审批时间", "");
            } else {
            rows.put("立案庭审批时间", sf.format(latsp.get("SPRQ")));
            }
            } else {
            rows.put("立案庭审批", "");
            rows.put("立案庭签名", "");
            rows.put("立案庭审批时间", "");
            }
            }

            for (int j = 0; j < lsnext.size(); j++) {
            HashMap pqxx2 = (HashMap) lsnext.get(j);
            // 法庭用途为证据交换时，不取值
            if ("5".equals(pqxx2.get("FTYT"))) {
            continue;
            } else {
            rows.put("业务庭2", Dict.getInstance().getBmDictMc(sfjm,
            pqxx2.get("CBBM").toString(), "bmqc"));
            o = pqxx2.get("ZSFG");
            rows.put("承办人2", o == null ? "" : o);
            o = pqxx2.get("SPZ");
            rows.put("审判长2", o == null ? "" : o);
            o = pqxx2.get("QTHYTCY");
            rows.put("合议庭成员2", o == null ? "" : o);
            o = pqxx2.get("SJY");
            rows.put("书记员2", o == null ? "" : o);
            Object object1 = pqxx2.get("PQFGXM");
            if (object1 == null) {
            rows.put("排期法官2", "");
            } else {
            rows.put("排期法官2", object1);
            }
            if (pqxx2.get("PQSJ") != null) {
            rows.put("排期日期2", sf.format(pqxx2.get("PQSJ")));
            } else {
            rows.put("排期日期2", "");
            }
            if (pqxx2.get("KTFT") != null
            && pqxx2.get("KTFT").toString().length() > 0)
            rows.put("开庭法庭2", pqxx2.get("KTFT"));
            else
            rows.put("开庭法庭2", "");
            if (pqxx2.get("YJKSSJ") != null)
            rows.put("开庭时间2", sft.format(pqxx2.get("YJKSSJ")));
            else
            rows.put("开庭时间2", "");
            if (pqxx2.get("YJJSSJ") != null)
            rows.put("预计开庭截止时间2", sft.format(pqxx2
            .get("YJJSSJ")));
            else
            rows.put("预计开庭截止时间2", "");

            if (pqxx2.get("PQFS").toString().equals("1"))
            rows.put("排定方式2", "自动");
            else
            rows.put("排定方式2", "手动");
            if (pqxx2.get("TSBLY") != null)
            rows.put("速记员2", pqxx2.get("TSBLY"));
            else
            rows.put("速记员2", "");

            break;// 只取一次值
            }
            }
            }

            // 当事人信息
            Dsrxx dsr = new Dsrxx();
            dsr.setAjid(ajids[i]);
            List dsrList = dao.query("Dsrxx.getDsrOdrBy", dsr);
            String dsrStr = "";
            String Ai = "";
            String ssdwTemp = "";
            for (int j = 0; j < dsrList.size(); j++) {
            Dsrxx dx = (Dsrxx) dsrList.get(j);
            if (dx.getSsdw() == null) {
            String tmp = dx.getDsrmc();
            if (j == 0) {
            dsrStr += tmp;
            } else {
            dsrStr += "\r" + tmp;
            }
            } else {
            if (Ai.equals(dx.getSsdw())) {
            if ("3".equals(dx.getSsdw())) {
            String tmp = "、" + dx.getDsrmc();
            ssdwTemp = ssdwTemp + tmp;
            } else {
            String tmp = "、" + dx.getDsrmc();
            dsrStr += tmp;
            }
            } else {
            String tmp = dx.getSsdwmc() + "：" + dx.getDsrmc();
            if (j == 0) {
            dsrStr += tmp;
            } else {
            if ("3".equals(dx.getSsdw())) {
            ssdwTemp = tmp;
            } else {
            dsrStr += "\r" + tmp;
            }
            }
            }

            /*
            * if (j == 9) { dsrStr += "更多、、"; break; }
            */
            Ai = dx.getSsdw();
            }
            }
            dsrStr += "\r" + ssdwTemp;
            rows.put("当事人", dsrStr);
            if (this.getSfcp().equals("1") && (lsnext.size() > 0)) {
            temp.add(rows);
            }
            if (this.getSfcp().equals("0")) {
            temp.add(rows);
            }

            tabMap.put("ajpdtzd", temp);
            }
            return tabMap;
            }

            /**
            * 封装公用方法
            *
            * @param ctx
            * @return
            */
            public HashMap printWordTabMap(ApplicationContext ctx) {
            IIbatisDAO dao = (IIbatisDAO) ctx.getBean("ibatisDAO");
            SimpleDateFormat sf = new SimpleDateFormat("yyyy-MM-dd");
            SimpleDateFormat sft = new SimpleDateFormat("yyyy-MM-dd HH:mm:ss");
            String[] ajids = this.ajid.split(",");
            HashMap tabMap = new HashMap();
            List tableCols = new ArrayList();
            tableCols.add("案号");
            tableCols.add("立案时间");
            tableCols.add("原审案号");
            tableCols.add("原审法院");
            tableCols.add("案由");
            tableCols.add("审限时间");
            tableCols.add("立案人");
            tableCols.add("当事人");
            tableCols.add("业务庭");
            tableCols.add("承办人");
            tableCols.add("审判长");
            tableCols.add("合议庭成员");
            tableCols.add("书记员");
            tableCols.add("开庭法庭");
            tableCols.add("开庭时间");
            tableCols.add("预计开庭截止时间");
            tableCols.add("排期日期");
            tableCols.add("排期法官");
            tableCols.add("排定方式");
            tableCols.add("速记员");
            tableCols.add("备注");
            tableCols.add("查询密码");//add by yy
            tableCols.add("当前时间");
            tableCols.add("争议标的金额");
            tableCols.add("审判程序");
            tableCols.add("预交诉讼费");
            tableCols.add("涉外情况");
            tableCols.add("减免情况");
            tableCols.add("册数");
            tableCols.add("案件来源");
            tableCols.add("录入人");

            tableCols.add("最高刑罚");
            tableCols.add("最高刑罚内容");
            tableCols.add("适用程序");
            tableCols.add("适用程序内容");
            tableCols.add("一审欠费金额");
            tableCols.add("一审金额");
            tableCols.add("二审欠费金额");
            tableCols.add("二审金额");
            tableCols.add("再审欠费金额");
            tableCols.add("再审金额");
            tableCols.add("公诉人");
            tableCols.add("公诉人内容");
            tableCols.add("立案庭审批");

            tableCols.add("立案庭签名");
            tableCols.add("立案庭审批时间");

            tableCols.add("业务庭审批");

            tableCols.add("业务庭签名");
            tableCols.add("业务庭审批时间");
            tableCols.add("重排原因");

            // 重排信息
            tableCols.add("业务庭2");
            tableCols.add("承办人2");
            tableCols.add("审判长2");
            tableCols.add("合议庭成员2");
            tableCols.add("书记员2");
            tableCols.add("开庭法庭2");
            tableCols.add("开庭时间2");
            tableCols.add("预计开庭截止时间2");
            tableCols.add("排期日期2");
            tableCols.add("排期法官2");
            tableCols.add("排定方式2");
            tableCols.add("速记员2");

            List temp = new ArrayList();
            List list = new ArrayList();
            String lwdwlxr;
            temp.add(tableCols);
            for (int i = 0; i < ajids.length; i++) {
            Map rows = new HashMap();
            List lista = dao.query("Ccpq.getPDDInfo", ajids[i]);
            HashMap ajjbxx = (HashMap) lista.get(0);
            String sfjm = ajjbxx.get("CBFY").toString();
            Date dt = new Date();
            rows.put("当前时间", sf.format(dt));
            rows.put("案号", ajjbxx.get("AH"));

            Object o = ajjbxx.get("LARQ");
            if (o == null)
            rows.put("立案时间", "");
            else
            rows.put("立案时间", sf.format(o));
            if (ajjbxx.get("LAAY") != null)
            rows
            .put("案由", Dict.getInstance().getAyDictMc(
            Integer.valueOf(ajjbxx.get("LAAY").toString()),
            "aynr"));
            o = ajjbxx.get("BEIZHU");
            if (o == null)
            rows.put("备注", "");
            else
            rows.put("备注", o);
            //省高院的备注设置为空,2015年4月2日,ljb
            if (this.getFjm().equals("J00")) {
            rows.put("备注", "");
            }

            //惠东加查询密码     add by yy
            if (ajjbxx.get("CBFY").equals("JD4")) {
            o = ajjbxx.get("CXMM");
            if (o == null) {
            rows.put("查询密码", "");
            } else
            rows.put("查询密码", o);
            } else {
            o = ajjbxx.get("CXMM");
            rows.put("查询密码", "");
            }

            o = ajjbxx.get("YJARQ");
            if (o == null)
            rows.put("审限时间", "");
            else
            rows.put("审限时间", sf.format(o));

            rows.put("争议标的金额", ajjbxx.get("SSBD") == null ? "" : ajjbxx.get(
            "SSBD").toString());

            String lbbm = "";
            String ajlb = (String) ajjbxx.get("AJLB");
            switch (Integer.parseInt(ajlb)) {
            case 1:
            lbbm = "SP107";
            break;
            case 2:
            lbbm = "SP154";
            break;
            case 6:
            lbbm = "SP184";
            break;
            case 7:
            lbbm = "SP294";
            break;
            case 8:
            lbbm = "SP260";
            break;
            }

            String spcx = (String) ajjbxx.get("SPCX");
            rows.put("审判程序", Dict.getInstance().getDictMc(lbbm, spcx));

            // rows.put("审判程序",
            // this.yltsbly==null?"":Escape.unescape(Base64.base64Decode
            // (yltsbly)));

            rows.put("预交诉讼费", ajjbxx.get("YJSSF") == null ? "" : ajjbxx.get(
            "YJSSF").toString().substring(0,
            ajjbxx.get("YJSSF").toString().length() - 2));
            if (ajjbxx.get("AJSJ") == null) {
            rows.put("涉外情况", "");
            } else {
            rows.put("涉外情况", Dict.getInstance().getDictMc("SP51",
            (String) ajjbxx.get("AJSJ")));
            }

            rows.put("减免情况", ajjbxx.get("JMQK") == null ? "" : ajjbxx.get(
            "JMQK").toString());
            rows.put("册数", ajjbxx.get("AJCS") == null ? "" : ajjbxx.get("AJCS")
            .toString());
            if (ajjbxx.get("AJLY") == null) {
            rows.put("案件来源", "");
            } else {
            rows.put("案件来源", Dict.getInstance().getDMMC(
            (String) ajjbxx.get("AJLB"),
            (String) ajjbxx.get("SPCX"), "3",
            (String) ajjbxx.get("AJLY")));
            }

            Object lar = ajjbxx.get("LAR");
            rows.put("立案人", lar == null ? "" : lar);

            Object lrrxm = ajjbxx.get("LRRXM");
            rows.put("录入人", lrrxm == null ? "" : lrrxm);

            // 原审情况
            Ysqk ysinfo = new Ysqk();
            ysinfo.setAjid(ajids[i]);
            ysinfo.setSfdq("1");
            List yslist = dao.query("Ladj.Ysqk.selectYSxxAll", ysinfo);
            String ysfyAll = "";
            String ysahAll = "";
            String ysje = "";
            String esje = "";
            String zsje = "";
            if (yslist.size() > 0) {
            for (int k = 0; k < yslist.size(); k++) {
            Ysqk ys = (Ysqk) yslist.get(k);
            if ("1".equals(ys.getSpcx())) {
            ysje = ys.getQfje();
            } else if ("2".equals(ys.getSpcx())) {
            esje = ys.getQfje();
            } else if ("3".equals(ys.getSpcx())) {
            zsje = ys.getQfje();
            }
            if (ys.getYysfymc() != null)
            ysfyAll += "\r" + ys.getYysfymc();
            if (ys.getYysah() != null)
            ysahAll += "\r" + ys.getYysah();
            }
            if (ysfyAll.length() > 0)
            ysfyAll = ysfyAll.substring(1);
            if (ysahAll.length() > 0)
            ysahAll = ysahAll.substring(1);
            rows.put("原审法院", ysfyAll);
            rows.put("原审案号", ysahAll);
            } else {
            if (ajjbxx.get("AJLB").equals("10")) {
            rows.put("原审法院", ajjbxx.get("QSFYMC").toString());
            rows.put("原审案号", ajjbxx.get("QSWH") == null ? "" : ajjbxx.get("QSWH").toString());
            } else {
            rows.put("原审法院", "");
            rows.put("原审案号", "");
            }
            }

            if (ajlb.equals("8") && spcx.equals("1")) {
            rows.put("一审欠费金额", "一审欠费金额");
            rows.put("一审金额", ysje);
            rows.put("二审欠费金额", "二审欠费金额");
            rows.put("二审金额", esje);
            rows.put("再审欠费金额", "再审欠费金额");
            rows.put("再审金额", zsje);
            } else {
            rows.put("一审欠费金额", "");
            rows.put("一审金额", "");
            rows.put("二审欠费金额", "");
            rows.put("二审金额", "");
            rows.put("再审欠费金额", "");
            rows.put("再审金额", "");
            }

            if (ajlb.equals("1") && !(spcx.equals("1"))) {
            rows.put("最高刑罚", "原审最重刑罚");

            List zgxf = dao.query("Ladj.Ysqk.selectByAjidForPJQK", ysinfo);
            if (zgxf.size() > 0) {
            String zgxfnr = (String) zgxf.get(0);
            rows.put("最高刑罚内容", Dict.getInstance().getDictMc("SP116",
            zgxfnr));
            } else {
            rows.put("最高刑罚内容", "");
            }
            } else {
            if (ajlb.equals("1") && spcx.equals("1")) {
            o = ajjbxx.get("GSR1");
            if (o == null) {
            rows.put("公诉人内容", "");
            } else {
            rows.put("公诉人内容", o.toString());
            }
            rows.put("公诉人", "公诉人");
            }
            rows.put("最高刑罚", "");
            rows.put("最高刑罚内容", "");
            }

            if (("1".equals(ajlb) || "2".equals(ajlb)) && "1".equals(spcx)) {
            rows.put("适用程序", "适用程序");
            o = ajjbxx.get("SYCX");
            if (o == null)
            rows.put("适用程序内容", Dict.getInstance().getDictMc("SP108",
            "2"));
            else
            rows.put("适用程序内容", Dict.getInstance().getDictMc("SP108",
            (String) o));

            } else {
            rows.put("适用程序", "");
            rows.put("适用程序内容", "");
            }

            List ls = dao.query("Ccpq.getPqInfo", ajids[i]);

            List lsnext = dao.query("Ccpq.getPqInfoMinone", ajids[i]);
            if (ls.size() > 0) {
            for (int j = 0; j < ls.size(); j++) {
            HashMap pqxx = (HashMap) ls.get(j);
            // 法庭用途为证据交换时，不取值
            if ("5".equals(pqxx.get("FTYT"))) {
            continue;
            } else {
            rows.put("业务庭", Dict.getInstance().getBmDictMc(sfjm,
            pqxx.get("CBBM").toString(), "bmqc"));
            rows.put("承办人", pqxx.get("ZSFG"));
            rows.put("审判长", pqxx.get("SPZ"));
            rows.put("合议庭成员", pqxx.get("QTHYTCY"));
            rows.put("书记员", pqxx.get("SJY"));
            Object object = pqxx.get("PQFGXM");
            if (object == null) {
            rows.put("排期法官", "");
            } else {
            rows.put("排期法官", object);
            }
            if (pqxx.get("PQSJ") != null) {
            rows.put("排期日期", sf.format(pqxx.get("PQSJ")));
            } else {
            rows.put("排期日期", "");
            }
            if (pqxx.get("KTFT") != null
            && pqxx.get("KTFT").toString().length() > 0)
            rows.put("开庭法庭", pqxx.get("KTFT"));
            else
            rows.put("开庭法庭", "");
            if (pqxx.get("YJKSSJ") != null)
            rows.put("开庭时间", sft.format(pqxx.get("YJKSSJ")));
            else
            rows.put("开庭时间", "");
            if (pqxx.get("YJJSSJ") != null)
            rows
            .put("预计开庭截止时间", sft.format(pqxx
            .get("YJJSSJ")));
            else
            rows.put("预计开庭截止时间", "");

            if (pqxx.get("PQFS").toString().equals("1"))
            rows.put("排定方式", "自动");
            else
            rows.put("排定方式", "手动");
            if (pqxx.get("TSBLY") != null)
            rows.put("速记员", pqxx.get("TSBLY"));
            else
            rows.put("速记员", "");

            if (pqxx.get("CPYY") == null) {
            rows.put("重排原因", "");
            } else {
            rows.put("重排原因", pqxx.get("CPYY"));
            }
            break; // 只取一次值
            }
            }
            }

            // 重排信息

            if (lsnext.size() > 0) {

            List spqk = dao.query("Ccpq.getSpYJ", ajids[i]);// 审批情况
            if (spqk.size() > 0) {
            HashMap ywtsp = (HashMap) spqk.get(0);

            if (ywtsp.get("spyj") == null) {
            rows.put("业务庭审批", "");
            } else {
            rows.put("业务庭审批", ywtsp.get("SPYJ"));
            }
            Object xm = ywtsp.get("XM");

            rows.put("业务庭签名", xm == null ? "" : xm);

            Object sprq = sf.format(ywtsp.get("SPRQ"));
            rows.put("业务庭审批时间", sprq == null ? "" : sprq);
            if (spqk.size() > 1) {
            HashMap latsp = (HashMap) spqk.get(1);
            if (latsp.get("SPYJ") == null) {
            rows.put("立案庭审批", "");
            } else {
            rows.put("立案庭审批", latsp.get("SPYJ"));
            }
            rows.put("立案庭签名", latsp.get("XM"));
            if (latsp.get("SPRQ") == null) {
            rows.put("立案庭审批时间", "");
            } else {
            rows.put("立案庭审批时间", sf.format(latsp.get("SPRQ")));
            }
            } else {
            rows.put("立案庭审批", "");
            rows.put("立案庭签名", "");
            rows.put("立案庭审批时间", "");
            }
            }

            for (int j = 0; j < lsnext.size(); j++) {
            HashMap pqxx2 = (HashMap) lsnext.get(j);
            // 法庭用途为证据交换时，不取值
            if ("5".equals(pqxx2.get("FTYT"))) {
            continue;
            } else {
            rows.put("业务庭2", Dict.getInstance().getBmDictMc(sfjm,
            pqxx2.get("CBBM").toString(), "bmqc"));
            o = pqxx2.get("ZSFG");
            rows.put("承办人2", o == null ? "" : o);
            o = pqxx2.get("SPZ");
            rows.put("审判长2", o == null ? "" : o);
            o = pqxx2.get("QTHYTCY");
            rows.put("合议庭成员2", o == null ? "" : o);
            o = pqxx2.get("SJY");
            rows.put("书记员2", o == null ? "" : o);
            Object object1 = pqxx2.get("PQFGXM");
            if (object1 == null) {
            rows.put("排期法官2", "");
            } else {
            rows.put("排期法官2", object1);
            }
            if (pqxx2.get("PQSJ") != null) {
            rows.put("排期日期2", sf.format(pqxx2.get("PQSJ")));
            } else {
            rows.put("排期日期2", "");
            }
            if (pqxx2.get("KTFT") != null
            && pqxx2.get("KTFT").toString().length() > 0)
            rows.put("开庭法庭2", pqxx2.get("KTFT"));
            else
            rows.put("开庭法庭2", "");
            if (pqxx2.get("YJKSSJ") != null)
            rows.put("开庭时间2", sft.format(pqxx2.get("YJKSSJ")));
            else
            rows.put("开庭时间2", "");
            if (pqxx2.get("YJJSSJ") != null)
            rows.put("预计开庭截止时间2", sft.format(pqxx2
            .get("YJJSSJ")));
            else
            rows.put("预计开庭截止时间2", "");

            if (pqxx2.get("PQFS").toString().equals("1"))
            rows.put("排定方式2", "自动");
            else
            rows.put("排定方式2", "手动");
            if (pqxx2.get("TSBLY") != null)
            rows.put("速记员2", pqxx2.get("TSBLY"));
            else
            rows.put("速记员2", "");

            break;// 只取一次值
            }
            }
            }

            // 当事人信息
            Dsrxx dsr = new Dsrxx();
            dsr.setAjid(ajids[i]);
            List dsrList = dao.query("Dsrxx.getDsrOdrBy", dsr);
            String dsrStr = "";
            String Ai = "";
            for (int j = 0; j < dsrList.size(); j++) {
            Dsrxx dx = (Dsrxx) dsrList.get(j);
            if (dx.getSsdw() == null) {
            String tmp = dx.getDsrmc();
            if (j == 0) {
            dsrStr += tmp;
            } else {
            dsrStr += "\r" + tmp;
            }
            } else {
            if (Ai.equals(dx.getSsdw())) {
            String tmp = "、" + dx.getDsrmc();
            dsrStr += tmp;
            } else {
            String tmp = dx.getSsdwmc() + "：" + dx.getDsrmc();
            if (j == 0) {
            dsrStr += tmp;
            } else {
            dsrStr += "\r" + tmp;
            }
            }

            /*
            * if (j == 9) { dsrStr += "更多、、"; break; }
            */
            Ai = dx.getSsdw();
            }
            }
            rows.put("当事人", dsrStr);
            if (this.getSfcp().equals("1") && (lsnext.size() > 0)) {
            temp.add(rows);
            }
            if (this.getSfcp().equals("0")) {
            temp.add(rows);
            }

            tabMap.put("ajpdtzd", temp);
            }
            return tabMap;
            }

            /**
            * 自动打印
            *
            * @param ctx
            * @param response
            * @throws Exception
            */
            public String getPDDInfoWordZdPrint(ApplicationContext ctx)
            throws Exception {
            HashMap tabMap = null;
            String wordname = "";
            if (this.getSfcp().equals("1")) {
            wordname = "ajcxpdd.doc";
            } else {
            wordname = "ajpdtzd.doc";
            }
            if ("J30".equals(this.fjm)) {
            wordname = "szpqpdd.doc";
            tabMap = makeWordTabMapForSzpdd(ctx);
            } else {
            tabMap = printWordTabMap(ctx);
            }
            WritManager wm = new WritManager(wordname);
            wm.setTabMap(tabMap);
            // 是否自动生成排定单
            ByteArrayOutputStream os = new ByteArrayOutputStream();
            wm.createDocsToOutputStream(os);
            byte[] wi = os.toByteArray();
            SimpleDateFormat formater = new SimpleDateFormat("yyyy-MM-dd");
            String path1 = formater.format(new Date());
            String path2 = String.valueOf(KeyUtil.getInstance().getInt());
            String path3 = "upload" + File.separator + path1 + File.separator
            + path2 + File.separator;
            String filePath = path3 + System.currentTimeMillis()
            + KeyUtil.getInstance().getInt() + ".doc";
            String fileUrl = InitServlet.getRealPath("/") + filePath;
            File file = new File(fileUrl);
            if (!file.exists()) {
            file.getParentFile().mkdirs();
            file.createNewFile();
            }
            FileOutputStream fos = new FileOutputStream(file);
            fos.write(wi);
            fos.close();
            os.close();
            JSONObject json = new JSONObject();
            json.put("data", filePath.replaceAll("\\\\", "/"));
            json.put("res", "true");
            return json.toString();
            }

            public void getPDDInfoWordforPQ(ApplicationContext ctx,
            HttpServletResponse response) throws Exception {
            response.setHeader("Content-Disposition", "attachment;filename="
            + new String("案件排定通知单".getBytes("GBK"), "ISO8859-1"));
            response.setContentType("application/msword");
            IIbatisDAO dao = (IIbatisDAO) ctx.getBean("ibatisDAO");
            SimpleDateFormat sf = new SimpleDateFormat("yyyy-MM-dd");
            SimpleDateFormat sft = new SimpleDateFormat("yyyy-MM-dd HH:mm:ss");
            String[] ajids = this.ajid.split(",");
            Map tabMap = new HashMap();
            List tableCols = new ArrayList();
            tableCols.add("案号");
            tableCols.add("立案时间");
            tableCols.add("原审案号");
            tableCols.add("原审法院");
            tableCols.add("案由");
            tableCols.add("审限时间");
            tableCols.add("立案人");
            tableCols.add("当事人");
            tableCols.add("业务庭");
            tableCols.add("承办人");
            tableCols.add("审判长");
            tableCols.add("合议庭成员");
            tableCols.add("书记员");
            tableCols.add("开庭法庭");
            tableCols.add("开庭时间");
            tableCols.add("预计开庭截止时间");
            tableCols.add("排期日期");
            tableCols.add("排期法官");
            tableCols.add("排定方式");
            tableCols.add("速记员");
            tableCols.add("备注");
            tableCols.add("查询密码");//add by yy
            tableCols.add("当前时间");
            tableCols.add("争议标的金额");
            tableCols.add("审判程序");
            tableCols.add("预交诉讼费");
            tableCols.add("涉外情况");
            tableCols.add("减免情况");
            tableCols.add("册数");
            tableCols.add("案件来源");
            tableCols.add("录入人");

            tableCols.add("最高刑罚");
            tableCols.add("最高刑罚内容");

            tableCols.add("适用程序");
            tableCols.add("适用程序内容");
            tableCols.add("公诉人");
            tableCols.add("公诉人内容");

            tableCols.add("一审欠费金额");
            tableCols.add("一审金额");
            tableCols.add("二审欠费金额");
            tableCols.add("二审金额");
            tableCols.add("再审欠费金额");
            tableCols.add("再审金额");

            List temp = new ArrayList();
            List list = new ArrayList();
            String lwdwlxr;
            temp.add(tableCols);
            for (int i = 0; i < ajids.length; i++) {
            Map rows = new HashMap();
            List lista = dao.query("Ccpq.getPDDInfo", ajids[i]);
            HashMap ajjbxx = (HashMap) lista.get(0);
            String sfjm = ajjbxx.get("CBFY").toString();
            Date dt = new Date();
            rows.put("当前时间", sf.format(dt));
            rows.put("案号", ajjbxx.get("AH"));
            rows.put("排期法官", (this.getYlpqfgxm() == null) ? "" : Escape
            .unescape(Base64.base64Decode(this.getYlpqfgxm())));

            rows.put("排期日期", this.ylpqsj == null ? "" : Escape.unescape(Base64
            .base64Decode(ylpqsj)));

            Object o = ajjbxx.get("LARQ");
            if (o == null)
            rows.put("立案时间", "");
            else
            rows.put("立案时间", o.toString());
            if (ajjbxx.get("LAAY") != null)
            rows
            .put("案由", Dict.getInstance().getAyDictMc(
            Integer.valueOf(ajjbxx.get("LAAY").toString()),
            "aynr"));

            o = ajjbxx.get("BEIZHU");
            if (o == null)
            rows.put("备注", "");
            else
            rows.put("备注", o);
            //省高院备注设置为空
            if (ajjbxx.get("CBFY").equals("J00")) {
            rows.put("备注", "");
            }

            //惠东加查询密码
            if (ajjbxx.get("CBFY").equals("JD4")) {
            o = ajjbxx.get("CXMM");
            if (o == null) {
            rows.put("查询密码", "");
            } else
            rows.put("查询密码", o);
            } else {
            o = ajjbxx.get("CXMM");
            rows.put("查询密码", "");
            }

            o = ajjbxx.get("YJARQ");
            if (o == null)
            rows.put("审限时间", "");
            else
            rows.put("审限时间", o.toString());
            rows.put("立案人", ajjbxx.get("LAR"));
            rows.put("录入人", ajjbxx.get("LRRXM"));

            if (ajjbxx.get("AJLY") == null) {
            rows.put("案件来源", "");
            } else {
            rows.put("案件来源", Dict.getInstance().getDMMC(
            (String) ajjbxx.get("AJLB"),
            (String) ajjbxx.get("SPCX"), "3",
            (String) ajjbxx.get("AJLY")));
            }

            // 原审情况
            Ysqk ysinfo = new Ysqk();
            ysinfo.setAjid(ajids[i]);
            ysinfo.setSfdq("1");
            List yslist = dao.query("Ladj.Ysqk.selectByAjid", ysinfo);

            String ysje = "";
            String esje = "";
            String zsje = "";

            if (yslist.size() > 0) {
            for (int k = 0; k < yslist.size(); k++) {
            Ysqk ys = (Ysqk) yslist.get(k);
            if ("1".equals(ys.getSpcx())) {
            ysje = ys.getQfje();
            } else if ("2".equals(ys.getSpcx())) {
            esje = ys.getQfje();
            } else if ("3".equals(ys.getSpcx())) {
            zsje = ys.getQfje();
            }
            }

            Ysqk ys = (Ysqk) yslist.get(0);
            String ysfymc = ys.getYysfymc();
            if (ysfymc != null && ysfymc.length() > 0)
            rows.put("原审法院", ysfymc);
            else
            rows.put("原审法院", "");
            String ysah = ys.getYysah();
            if (ysah != null && ysah.length() > 0)
            rows.put("原审案号", ysah);
            else
            rows.put("原审案号", "");
            } else {
            rows.put("原审法院", "");
            rows.put("原审案号", "");
            }

            String spcx = (String) ajjbxx.get("SPCX");
            String ajlb = (String) ajjbxx.get("AJLB");

            if (ajlb.equals("8") && spcx.equals("1")) {
            rows.put("一审欠费金额", "一审欠费金额");
            rows.put("一审金额", ysje);
            rows.put("二审欠费金额", "二审欠费金额");
            rows.put("二审金额", esje);
            rows.put("再审欠费金额", "再审欠费金额");
            rows.put("再审金额", zsje);
            } else {
            rows.put("一审欠费金额", "");
            rows.put("一审金额", "");
            rows.put("二审欠费金额", "");
            rows.put("二审金额", "");
            rows.put("再审欠费金额", "");
            rows.put("再审金额", "");
            }

            if (ajlb.equals("1") && !(spcx.equals("1"))) {
            rows.put("最高刑罚", "原审最重刑罚");

            List zgxf = dao.query("Ladj.Ysqk.selectByAjidForPJQK", ysinfo);
            if (zgxf.size() > 0) {
            String zgxfnr = (String) zgxf.get(0);
            rows.put("最高刑罚内容", Dict.getInstance().getDictMc("SP116",
            zgxfnr));
            } else {
            rows.put("最高刑罚内容", "");
            }
            } else {
            if (ajlb.equals("1") && spcx.equals("1")) {
            o = ajjbxx.get("GSR1");
            if (o == null) {
            rows.put("公诉人内容", "");
            } else {
            rows.put("公诉人内容", o.toString());
            }
            rows.put("公诉人", "公诉人");
            }
            rows.put("最高刑罚", "");
            rows.put("最高刑罚内容", "");
            }

            if (("1".equals(ajlb) || "2".equals(ajlb)) && "1".equals(spcx)) {
            rows.put("适用程序", "适用程序");
            o = ajjbxx.get("SYCX");
            if (o == null)
            rows.put("适用程序内容", Dict.getInstance().getDictMc("SP108",
            "2"));
            else
            rows.put("适用程序内容", Dict.getInstance().getDictMc("SP108",
            (String) o));

            } else {
            rows.put("适用程序", "");
            rows.put("适用程序内容", "");
            }

            rows.put("业务庭", (this.getYlcbbm() == null) ? "" : Escape
            .unescape(Base64.base64Decode(getYlcbbm())));

            rows.put("承办人", this.ylzsfg == null ? "" : Escape.unescape(Base64
            .base64Decode(ylzsfg)));
            rows.put("审判长", this.ylspz == null ? "" : Escape.unescape(Base64
            .base64Decode(ylspz)));
            rows.put("合议庭成员", this.ylqthytcy == null ? "" : Escape
            .unescape(Base64.base64Decode(ylqthytcy)));
            rows.put("书记员", this.ylsjy == null ? "" : Escape.unescape(Base64
            .base64Decode(ylsjy)));

            rows.put("开庭法庭", this.ylftyt == null ? "" : Escape.unescape(Base64
            .base64Decode(ylftyt)));

            rows.put("开庭时间", this.ylyjkssj == null ? "" : Escape
            .unescape(Base64.base64Decode(ylyjkssj)));

            rows.put("预计开庭截止时间", this.ylyjjssj == null ? "" : Escape
            .unescape(Base64.base64Decode(ylyjjssj)));

            rows.put("排定方式", this.ylpqfs == null ? "" : Escape.unescape(Base64
            .base64Decode(ylpqfs)));

            rows.put("速记员", this.yltsbly == null ? "" : Escape.unescape(Base64
            .base64Decode(yltsbly)));
            rows.put("争议标的金额", this.ylssbd == null ? "" : Escape.unescape(
            Base64.base64Decode(ylssbd)).toString());
            rows.put("审判程序", this.ylspcx == null ? "" : Escape.unescape(Base64
            .base64Decode(ylspcx)));
            rows.put("预交诉讼费", this.ylyjssf == null ? "" : Escape.unescape(
            Base64.base64Decode(ylyjssf)).toString());
            rows.put("涉外情况", this.ylajsj == null ? "" : Escape.unescape(
            Base64.base64Decode(ylajsj)).toString());
            rows.put("减免情况", this.yljmqk == null ? "" : Escape.unescape(
            Base64.base64Decode(yljmqk)).toString());
            rows.put("册数", this.ylajcs == null ? "" : Escape.unescape(
            Base64.base64Decode(ylajcs)).toString());
            // 当事人信息
            Dsrxx dsr = new Dsrxx();
            dsr.setAjid(ajids[i]);
            List dsrList = dao.query("Dsrxx.getDsrOdrBy", dsr);
            String dsrStr = "";
            String Ai = "";
            for (int j = 0; j < dsrList.size(); j++) {
            Dsrxx dx = (Dsrxx) dsrList.get(j);
            if (dx.getSsdw() == null) {
            String tmp = dx.getDsrmc();
            if (j == 0) {
            dsrStr += tmp;
            } else {
            dsrStr += "\r" + tmp;
            }
            } else {
            if (Ai.equals(dx.getSsdw())) {
            String tmp = "、" + dx.getDsrmc();
            dsrStr += tmp;
            } else {
            String tmp = dx.getSsdwmc() + "：" + dx.getDsrmc();
            if (j == 0) {
            dsrStr += tmp;
            } else {
            dsrStr += "\r" + tmp;
            }
            }

            /*
            * if (j == 9) { dsrStr += "更多、、"; break; }
            */
            Ai = dx.getSsdw();
            }
            }
            rows.put("当事人", dsrStr);

            temp.add(rows);

            tabMap.put("ajpdtzd", temp);
            }

            WritManager wm = new WritManager("ajpdtzd.doc");
            wm.setTabMap(tabMap);
            wm.createDocsToResp(response);

            }

            public String getAjxx(ApplicationContext context) {
            IIbatisDAO dao = (IIbatisDAO) context.getBean("ibatisDAO");
            JSONObject retJson = new JSONObject();
            List list = dao.query("Ccpq.getPDDInfo", this.ajid);
            HashMap ajjbxx = (HashMap) list.get(0);
            retJson.put("ylah", ajjbxx.get("AH"));
            Object o = ajjbxx.get("LARQ");
            if (o == null)
            retJson.put("yllarq", "");
            else
            retJson.put("yllarq", o.toString());
            retJson.put("ylajfl", ajjbxx.get("AJFL"));
            retJson.put("ylayzs", ajjbxx.get("AYZS"));
            if (ajjbxx.get("LAAY") != null)
            retJson.put("yllaay", Dict.getInstance().getAyDictMc(
            Integer.valueOf(ajjbxx.get("LAAY").toString()), "aynr"));
            o = ajjbxx.get("YJARQ");
            if (o == null)
            retJson.put("ylyjarq", "");
            else
            retJson.put("ylyjarq", o.toString());
            retJson.put("ylssbd", ajjbxx.get("SSBD"));
            retJson.put("ylajlb", ajjbxx.get("AJLB"));
            retJson.put("ylspcx", ajjbxx.get("SPCX"));
            retJson.put("ylajcs", ajjbxx.get("AJCS"));
            retJson.put("yllar", ajjbxx.get("LAR"));
            retJson.put("ylyjssf", ajjbxx.get("YJSSF"));
            retJson.put("yljmqk", ajjbxx.get("JMQK"));
            o = ajjbxx.get("ajsj");
            if (o != null)
            retJson.put("ylajsj", Dict.getInstance().getDictMc("SP51",
            o.toString()));
            else
            retJson.put("ylajsj", "");
            retJson.put("res", "true");
            return retJson.toString();
            }

            public String getPqxx(ApplicationContext context) {
            IIbatisDAO dao = (IIbatisDAO) context.getBean("ibatisDAO");
            JSONObject retJson = new JSONObject();
            SimpleDateFormat sf = new SimpleDateFormat("yyyy-MM-dd HH:mm:ss");
            List list = dao.query("Ccpq.getPDDInfo", this.ajid);
            HashMap ajjbxx = (HashMap) list.get(0);
            String sfjm = ajjbxx.get("CBFY").toString();
            retJson.put("ylah", ajjbxx.get("AH"));
            Object o = ajjbxx.get("LARQ");
            if (o == null)
            retJson.put("yllarq", "");
            else
            retJson.put("yllarq", o.toString());
            retJson.put("ylajfl", ajjbxx.get("AJFL"));
            retJson.put("ylayzs", ajjbxx.get("AYZS"));
            if (ajjbxx.get("laay") != null)
            retJson.put("yllaay", Dict.getInstance().getAyDictMc(
            Integer.valueOf(ajjbxx.get("LAAY").toString()), "aynr"));
            o = ajjbxx.get("YJARQ");
            if (o == null)
            retJson.put("ylyjarq", "");
            else
            retJson.put("ylyjarq", o.toString());
            retJson.put("ylssbd", ajjbxx.get("SSBD"));
            retJson.put("ylajlb", ajjbxx.get("AJLB"));
            retJson.put("ylspcx", ajjbxx.get("SPCX"));
            retJson.put("ylajcs", ajjbxx.get("AJCS"));
            retJson.put("yllar", ajjbxx.get("LAR"));
            retJson.put("ylyjssf", ajjbxx.get("YJSSF"));
            retJson.put("yljmqk", ajjbxx.get("JMQK"));
            o = ajjbxx.get("ajsj");
            if (o != null)
            retJson.put("ylajsj", Dict.getInstance().getDictMc("SP51",
            o.toString()));
            else
            retJson.put("ylajsj", "");

            List ls = dao.query("Ccpq.getPqInfo", this.ajid);
            if (ls.size() > 0) {
            HashMap pqxx = (HashMap) ls.get(0);
            retJson.put("ylcbbm", Dict.getInstance().getBmDictMc(sfjm,
            pqxx.get("CBBM").toString(), "bmqc"));
            retJson.put("ylzsfg", pqxx.get("ZSFG"));
            retJson.put("ylspz", pqxx.get("SPZ"));
            retJson.put("ylqthytcy", pqxx.get("QTHYTCY"));
            retJson.put("ylsjy", pqxx.get("SJY"));
            retJson.put("ylktft", pqxx.get("KTFT"));
            if (pqxx.get("YJKSSJ") != null)
            retJson.put("ylyjkssj", sf.format(pqxx.get("YJKSSJ")));
            if (pqxx.get("yjjssj") != null)
            retJson.put("ylyjjssj", sf.format(pqxx.get("YJJSSJ")));
            retJson.put("yltsbly", pqxx.get("TSBLY"));
            // retJson.put("ylgkkt", Dict.getInstance().getDictMc("310",
            // pqxx.get("gkkt").toString()));
            o = pqxx.get("GKKT");
            if (o != null)
            retJson.put("ylgkkt", Dict.getInstance().getDictMc("310",
            o.toString()));
            else
            retJson.put("ylgkkt", "");
            retJson.put("ylqtcyry", pqxx.get("QTCYRY"));
            retJson.put("ylbz", pqxx.get("BZ"));
            retJson.put("ylpqfgxm", pqxx.get("PQFGXM"));
            retJson.put("ylpqsj", new SimpleDateFormat("yyyy-MM-dd")
            .format(pqxx.get("PQSJ")));
            // if (pqxx.get("ftyt") != null)
            // retJson.put("ylftyt", Dict.getInstance().getDictMc("SP106",
            // pqxx.get("ftyt").toString()));
            o = pqxx.get("FTYT");
            if (o != null)
            retJson.put("ylftyt", Dict.getInstance().getDictMc("SP106",
            o.toString()));
            else
            retJson.put("ylftyt", "");
            retJson.put("yltc", pqxx.get("TC"));
            if ("1".equals(pqxx.get("PQFS").toString()))
            retJson.put("ylpqfs", "自动");
            else
            retJson.put("ylpqfs", "手动");

            if ("0".equals(pqxx.get("PQLX").toString()))
            retJson.put("ylpqlx", "初排");
            else
            retJson.put("ylpqlx", "重排");
            }
            retJson.put("res", "true");
            return retJson.toString();
            }

            public void displayWordTabMapForSzpdd(ApplicationContext ctx,
            HttpServletResponse response) throws Exception {
            response.setHeader("Content-Disposition", "attachment;filename="
            + new String("案件排定通知单".getBytes("GBK"), "ISO8859-1"));
            response.setContentType("application/msword");
            IIbatisDAO dao = (IIbatisDAO) ctx.getBean("ibatisDAO");
            SimpleDateFormat sf = new SimpleDateFormat("yyyy-MM-dd");
            SimpleDateFormat sft = new SimpleDateFormat("yyyy-MM-dd HH:mm:ss");

            String[] ajids = this.ajid.split(",");
            HashMap tabMap = new HashMap();
            List tableCols = new ArrayList();
            tableCols.add("案件类别");
            tableCols.add("案号");
            tableCols.add("原审案号");
            tableCols.add("案由");
            tableCols.add("收案日期");
            tableCols.add("立案日期");
            tableCols.add("诉讼标的");
            tableCols.add("受理费");
            tableCols.add("是否保全");
            tableCols.add("开庭时间");
            tableCols.add("审判法庭");
            tableCols.add("审判长");
            tableCols.add("主审法官");
            tableCols.add("合议成员");
            tableCols.add("书记官");
            tableCols.add("当事人");
            tableCols.add("庭长确认");
            tableCols.add("当事人");
            tableCols.add("备注");
            tableCols.add("打印人");
            tableCols.add("审限日期");
            List tabColsList = new ArrayList();
            tabColsList.add(tableCols);

            for (int i = 0; i < ajids.length; i++) {
            Map rows = new HashMap();
            List lista = dao.query("Ccpq.getPDDInfo", ajids[i]);
            HashMap ajjbxx = (HashMap) lista.get(0);
            String sfjm = ajjbxx.get("CBFY").toString();
            Object tempstr = null;

            tempstr = ajjbxx.get("AJLB");
            if (tempstr != null) {
            tempstr = Dict.getInstance().getDictMc("SP50",
            tempstr.toString());
            }
            rows.put("案件类别", tempstr.toString());
            tempstr = ajjbxx.get("AH");
            rows.put("案号", tempstr == null ? "" : tempstr.toString());

            // 原审情况
            Ysqk ysinfo = new Ysqk();
            ysinfo.setAjid(ajids[i]);
            ysinfo.setSfdq("1");
            List yslist = dao.query("Ladj.Ysqk.selectYSxxAll", ysinfo);
            String ysahAll = "";
            if (yslist.size() > 0) {
            for (int k = 0; k < yslist.size(); k++) {
            Ysqk ys = (Ysqk) yslist.get(k);
            if (ys.getYysah() != null)
            ysahAll += "\r" + ys.getYysah();
            }
            if (ysahAll.length() > 0)
            ysahAll = ysahAll.substring(1);
            rows.put("原审案号", ysahAll);
            } else {
            rows.put("原审案号", "");
            }

            if (ajjbxx.get("LAAY") != null)
            rows
            .put("案由", Dict.getInstance().getAyDictMc(
            Integer.valueOf(ajjbxx.get("LAAY").toString()),
            "aynr"));

            tempstr = ajjbxx.get("SDSZRQ");
            rows.put("收案日期", tempstr == null ? "" : tempstr.toString());

            tempstr = ajjbxx.get("LARQ");
            rows.put("立案日期", tempstr == null ? "" : tempstr.toString());

            tempstr = ajjbxx.get("SSBD");
            rows.put("诉讼标的", (tempstr == null ? "0.00" : tempstr.toString())
            + "元");

            tempstr = ajjbxx.get("YJSSF");
            rows.put("受理费", tempstr == null ? "" : tempstr.toString()
            .substring(0, tempstr.toString().length() - 2));

            tempstr = ajjbxx.get("YJARQ");
            rows.put("审限日期", tempstr == null ? "" : tempstr.toString());

            List ssbqList = dao.query("Ccpq.checkSfbq", ajids[i]);
            if (ssbqList.size() > 0) {
            tempstr = "是";
            } else {
            tempstr = "无";
            }
            rows.put("是否保全", tempstr);

            List ls = null;
            if (this.getPqxh() == null || "".equals(this.getPqxh())) {
            ls = dao.query("Ccpq.getPqInfo", ajids[i]);
            } else {
            Map temp = new HashMap();
            temp.put("ajid", ajids[i]);
            temp.put("pqxh", this.pqxh);
            ls = dao.query("Ccpq.getPqInfoByPqxhXG", temp);
            }

            if (ls.size() > 0) {
            HashMap pqxx = (HashMap) ls.get(0);

            tempstr = pqxx.get("YJKSSJ");
            rows.put("开庭时间", tempstr == null ? "" : tempstr.toString());

            tempstr = pqxx.get("KTFT");
            rows.put("审判法庭", tempstr == null ? "" : tempstr.toString());

            tempstr = pqxx.get("SPZ");
            String spz = tempstr == null ? "" : tempstr.toString();

            tempstr = pqxx.get("ZSFG");
            rows.put("主审法官", tempstr == null ? "" : tempstr.toString());

            tempstr = pqxx.get("QTHYTCY");
            rows.put("合议成员", tempstr == null ? spz : ("".equals(spz) ? ""
            : spz + "、")
            + tempstr.toString().replaceAll(",", "、"));

            tempstr = pqxx.get("SJY");
            rows.put("书记官", tempstr == null ? "" : tempstr.toString());

            tempstr = pqxx.get("BZ");
            rows.put("备注", tempstr == null ? "" : tempstr.toString());

            }

            // 当事人信息
            Dsrxx dsr = new Dsrxx();
            dsr.setAjid(ajids[i]);
            List dsrList = dao.query("Dsrxx.getDsrOdrBy", dsr);
            String dsrStr = "";
            String Ai = "";
            for (int j = 0; j < dsrList.size(); j++) {
            Dsrxx dx = (Dsrxx) dsrList.get(j);
            String yssdwxx = "";
            if ("2".equals(dx.getSpcx()) && !"8".equals(dx.getSpcx())) {
            yssdwxx = "原审（" + dx.getYsssdwmc() + "):";
            }
            if (dx.getSsdw() == null) {
            String tmp = dx.getDsrmc();
            if (j == 0) {
            dsrStr += tmp;
            } else {
            dsrStr += "\r" + tmp;
            }
            } else {
            if (Ai.equals(dx.getSsdw())) {

            String tmp = "、" + yssdwxx + dx.getDsrmc();
            dsrStr += tmp;
            } else {
            String tmp = yssdwxx + dx.getSsdwmc() + "："
            + dx.getDsrmc();
            if (j == 0) {
            dsrStr += tmp;
            } else {
            dsrStr += "\r" + tmp;
            }
            }

            /*
            * if (j == 9) { dsrStr += "更多、、"; break; }
            */
            Ai = dx.getSsdw();
            }
            }
            rows.put("当事人", dsrStr);

            tempstr = ajjbxx.get("TZQR");
            rows.put("庭长确认", tempstr == null ? "" : tempstr.toString());

            tempstr = SessionManager.getInstance().getCurrentUser(this.czr)
            .getXm();
            rows.put("打印人", tempstr == null ? "" : tempstr.toString());

            tabColsList.add(rows);

            }

            tabMap.put("szpqpdd", tabColsList);

            WritManager wm = new WritManager("szpqpdd.doc");
            wm.setTabMap(tabMap);
            wm.createDocsToResp(response);

            }

            public void getPDDInfoWordbyPqxh(ApplicationContext ctx,
            HttpServletResponse response) throws Exception {
            response.setHeader("Content-Disposition", "attachment;filename="
            + new String("案件排定通知单".getBytes("GBK"), "ISO8859-1"));
            response.setContentType("application/msword");
            IIbatisDAO dao = (IIbatisDAO) ctx.getBean("ibatisDAO");
            SimpleDateFormat sf = new SimpleDateFormat("yyyy-MM-dd");
            SimpleDateFormat sft = new SimpleDateFormat("yyyy-MM-dd HH:mm:ss");
            String[] ajids = this.ajid.split(",");
            Map tabMap = new HashMap();
            Map pqxhajid = new HashMap();
            List tableCols = new ArrayList();
            tableCols.add("案号");
            tableCols.add("立案时间");
            tableCols.add("原审案号");
            tableCols.add("原审法院");
            tableCols.add("案由");
            tableCols.add("审限时间");
            tableCols.add("立案人");
            tableCols.add("当事人");
            tableCols.add("业务庭");
            tableCols.add("承办人");
            tableCols.add("审判长");
            tableCols.add("合议庭成员");
            tableCols.add("书记员");
            tableCols.add("开庭法庭");
            tableCols.add("开庭时间");
            tableCols.add("预计开庭截止时间");
            tableCols.add("排期日期");
            tableCols.add("排期法官");
            tableCols.add("排定方式");
            tableCols.add("速记员");
            tableCols.add("备注");
            tableCols.add("查询密码");//add by yy
            tableCols.add("当前时间");
            tableCols.add("争议标的金额");
            tableCols.add("审判程序");
            tableCols.add("预交诉讼费");
            tableCols.add("涉外情况");
            tableCols.add("减免情况");
            tableCols.add("册数");
            tableCols.add("案件来源");
            tableCols.add("录入人");

            tableCols.add("最高刑罚");
            tableCols.add("最高刑罚内容");
            tableCols.add("适用程序");
            tableCols.add("适用程序内容");

            tableCols.add("一审欠费金额");
            tableCols.add("一审金额");
            tableCols.add("二审欠费金额");
            tableCols.add("二审金额");
            tableCols.add("再审欠费金额");
            tableCols.add("再审金额");
            tableCols.add("公诉人");
            tableCols.add("公诉人内容");
            tableCols.add("立案庭审批");

            tableCols.add("立案庭签名");
            tableCols.add("立案庭审批时间");

            tableCols.add("业务庭审批");

            tableCols.add("业务庭签名");
            tableCols.add("业务庭审批时间");
            tableCols.add("重排原因");

            // 重排信息
            tableCols.add("业务庭2");
            tableCols.add("承办人2");
            tableCols.add("审判长2");
            tableCols.add("合议庭成员2");
            tableCols.add("书记员2");
            tableCols.add("开庭法庭2");
            tableCols.add("开庭时间2");
            tableCols.add("预计开庭截止时间2");
            tableCols.add("排期日期2");
            tableCols.add("排期法官2");
            tableCols.add("排定方式2");
            tableCols.add("速记员2");

            List temp = new ArrayList();
            List list = new ArrayList();
            String lwdwlxr;
            temp.add(tableCols);
            for (int i = 0; i < ajids.length; i++) {
            pqxhajid.put("ajid", ajids[i]);
            pqxhajid.put("pqxh", pqxh);
            Map rows = new HashMap();
            List lista = dao.query("Ccpq.getPDDInfo", ajids[i]);
            HashMap ajjbxx = (HashMap) lista.get(0);
            String sfjm = ajjbxx.get("CBFY").toString();
            Date dt = new Date();
            rows.put("当前时间", sf.format(dt));
            rows.put("案号", ajjbxx.get("AH"));
            Object pqfg = ajjbxx.get("FARXM");
            Object o = ajjbxx.get("LARQ");
            if (o == null)
            rows.put("立案时间", "");
            else
            rows.put("立案时间", sf.format(o));
            if (ajjbxx.get("LAAY") != null)
            rows
            .put("案由", Dict.getInstance().getAyDictMc(
            Integer.valueOf(ajjbxx.get("LAAY").toString()),
            "aynr"));

            o = ajjbxx.get("BEIZHU");
            if (o == null)
            rows.put("备注", "");
            else
            rows.put("备注", o);
            //省高院备注设置为空
            if (ajjbxx.get("CBFY").equals("J00")) {
            rows.put("备注", "");
            }

            //惠东加查询密码
            if (ajjbxx.get("CBFY").equals("JD4")) {
            o = ajjbxx.get("CXMM");
            if (o == null) {
            rows.put("查询密码", "");
            } else
            rows.put("查询密码", o);
            } else {
            o = ajjbxx.get("CXMM");
            rows.put("查询密码", "");
            }
            o = ajjbxx.get("YJARQ");
            if (o == null)
            rows.put("审限时间", "");
            else
            rows.put("审限时间", sf.format(o));

            rows.put("争议标的金额", ajjbxx.get("SSBD") == null ? "" : ajjbxx.get(
            "SSBD").toString());

            String lbbm = "";
            String ajlb = (String) ajjbxx.get("AJLB");
            switch (Integer.parseInt(ajlb)) {
            case 1:
            lbbm = "SP107";
            break;
            case 2:
            lbbm = "SP154";
            break;
            case 6:
            lbbm = "SP184";
            break;
            case 7:
            lbbm = "SP294";
            break;
            case 8:
            lbbm = "SP260";
            break;
            }

            String spcx = (String) ajjbxx.get("SPCX");
            rows.put("审判程序", Dict.getInstance().getDictMc(lbbm, spcx));

            // rows.put("审判程序",
            // this.yltsbly==null?"":Escape.unescape(Base64.base64Decode
            // (yltsbly)));

            rows.put("预交诉讼费", ajjbxx.get("YJSSF") == null ? "" : ajjbxx.get(
            "YJSSF").toString().substring(0,
            ajjbxx.get("YJSSF").toString().length() - 2));
            if (ajjbxx.get("AJSJ") == null) {
            rows.put("涉外情况", "");
            } else {
            rows.put("涉外情况", Dict.getInstance().getDictMc("SP51",
            (String) ajjbxx.get("AJSJ")));
            }

            rows.put("减免情况", ajjbxx.get("JMQK") == null ? "" : ajjbxx.get(
            "JMQK").toString());
            rows.put("册数", ajjbxx.get("AJCS") == null ? "" : ajjbxx.get("AJCS")
            .toString());
            if (ajjbxx.get("AJLY") == null) {
            rows.put("案件来源", "");
            } else {
            rows.put("案件来源", Dict.getInstance().getDMMC(
            (String) ajjbxx.get("AJLB"),
            (String) ajjbxx.get("SPCX"), "3",
            (String) ajjbxx.get("AJLY")));
            }
            Object lar = ajjbxx.get("LAR");
            Object lrrxm = ajjbxx.get("LRRXM");

            rows.put("立案人", lar == null ? "" : lar);
            rows.put("录入人", lrrxm == null ? "" : lrrxm);

            // 原审情况
            Ysqk ysinfo = new Ysqk();
            ysinfo.setAjid(ajids[i]);
            ysinfo.setSfdq("1");
            List yslist = dao.query("Ladj.Ysqk.selectYSxxAll", ysinfo);
            String ysfyAll = "";
            String ysahAll = "";

            String ysje = "";
            String esje = "";
            String zsje = "";

            if (yslist.size() > 0) {
            for (int k = 0; k < yslist.size(); k++) {
            Ysqk ys = (Ysqk) yslist.get(k);

            if ("1".equals(ys.getSpcx())) {
            ysje = ys.getQfje();
            } else if ("2".equals(ys.getSpcx())) {
            esje = ys.getQfje();
            } else if ("3".equals(ys.getSpcx())) {
            zsje = ys.getQfje();
            }

            if (ys.getYysfymc() != null)
            ysfyAll += "\r" + ys.getYysfymc();
            if (ys.getYysah() != null)
            ysahAll += "\r" + ys.getYysah();
            }
            if (ysfyAll.length() > 0)
            ysfyAll = ysfyAll.substring(1);
            if (ysahAll.length() > 0)
            ysahAll = ysahAll.substring(1);
            rows.put("原审法院", ysfyAll);
            rows.put("原审案号", ysahAll);
            } else {
            rows.put("原审法院", "");
            rows.put("原审案号", "");
            }

            if (ajlb.equals("8") && spcx.equals("1")) {
            rows.put("一审欠费金额", "一审欠费金额");
            rows.put("一审金额", ysje);
            rows.put("二审欠费金额", "二审欠费金额");
            rows.put("二审金额", esje);
            rows.put("再审欠费金额", "再审欠费金额");
            rows.put("再审金额", zsje);
            } else {
            rows.put("一审欠费金额", "");
            rows.put("一审金额", "");
            rows.put("二审欠费金额", "");
            rows.put("二审金额", "");
            rows.put("再审欠费金额", "");
            rows.put("再审金额", "");
            }

            if (ajlb.equals("1") && !(spcx.equals("1"))) {
            rows.put("最高刑罚", "原审最重刑罚");

            List zgxf = dao.query("Ladj.Ysqk.selectByAjidForPJQK", ysinfo);
            if (zgxf.size() > 0) {
            String zgxfnr = (String) zgxf.get(0);
            rows.put("最高刑罚内容", Dict.getInstance().getDictMc("SP116",
            zgxfnr));
            } else {
            rows.put("最高刑罚内容", "");
            }
            } else {
            if (ajlb.equals("1") && spcx.equals("1")) {
            o = ajjbxx.get("GSR1");
            if (o == null) {
            rows.put("公诉人内容", "");
            } else {
            rows.put("公诉人内容", o.toString());
            }
            rows.put("公诉人", "公诉人");
            }
            rows.put("最高刑罚", "");
            rows.put("最高刑罚内容", "");
            }

            if (("1".equals(ajlb) || "2".equals(ajlb)) && "1".equals(spcx)) {
            rows.put("适用程序", "适用程序");
            o = ajjbxx.get("SYCX");
            if (o == null)
            rows.put("适用程序内容", Dict.getInstance().getDictMc("SP108",
            "2"));
            else
            rows.put("适用程序内容", Dict.getInstance().getDictMc("SP108",
            (String) o));

            } else {
            rows.put("适用程序", "");
            rows.put("适用程序内容", "");
            }

            List ls = dao.query("Ccpq.getPqInfoBypqxh", pqxhajid);

            List lsnext = dao.query("Ccpq.getPqInfoBypqxhMinone", pqxhajid);
            if (ls.size() > 0) {
            HashMap pqxx = (HashMap) ls.get(0);
            rows.put("业务庭", Dict.getInstance().getBmDictMc(sfjm,
            pqxx.get("CBBM").toString(), "bmqc"));
            rows.put("承办人", pqxx.get("ZSFG"));
            rows.put("审判长", pqxx.get("SPZ"));
            rows.put("合议庭成员", pqxx.get("QTHYTCY"));
            rows.put("书记员", pqxx.get("SJY"));
            // Object object = pqxx.get("PQFGXM");
            // pqfg = (String) object;
            pqfg = (String) pqxx.get("PQFGXM");
            if (pqfg == null) {
            rows.put("排期法官", "");
            } else {
            rows.put("排期法官", pqfg);
            }
            if (pqxx.get("pqsj") != null) {
            rows.put("排期日期", sf.format(pqxx.get("PQSJ")));
            } else {
            rows.put("排期日期", "");
            }
            if (pqxx.get("KTFT") != null
            && pqxx.get("KTFT").toString().length() > 0)
            rows.put("开庭法庭", pqxx.get("KTFT"));
            else
            rows.put("开庭法庭", "");
            if (pqxx.get("YJKSSJ") != null)
            rows.put("开庭时间", sft.format(pqxx.get("YJKSSJ")));
            else
            rows.put("开庭时间", "");
            if (pqxx.get("YJJSSJ") != null)
            rows.put("预计开庭截止时间", sft.format(pqxx.get("YJJSSJ")));
            else
            rows.put("预计开庭截止时间", "");

            if (pqxx.get("PQFS").toString().equals("1"))
            rows.put("排定方式", "自动");
            else
            rows.put("排定方式", "手动");
            if (pqxx.get("TSBLY") != null)
            rows.put("速记员", pqxx.get("TSBLY"));
            else
            rows.put("速记员", "");

            if (pqxx.get("CPYY") == null) {
            rows.put("重排原因", "");
            } else {
            rows.put("重排原因", pqxx.get("CPYY"));
            }
            }

            // 重排信息

            if (lsnext.size() > 0) {

            List spqk = dao.query("Ccpq.getSpYJ", ajids[i]);// 审批情况
            if (spqk.size() > 0) {
            HashMap ywtsp = (HashMap) spqk.get(0);

            if (ywtsp.get("SPYJ") == null) {
            rows.put("业务庭审批", "");
            } else {
            rows.put("业务庭审批", ywtsp.get("SPYJ"));
            }
            Object xm = ywtsp.get("XM");

            rows.put("业务庭签名", xm == null ? "" : xm);
            Object sprq = null;
            if (ywtsp.get("SPRQ") != null)
            ;
            sprq = sf.format(ywtsp.get("SPRQ"));
            rows.put("业务庭审批时间", sprq == null ? "" : sprq);
            if (spqk.size() > 1) {
            HashMap latsp = (HashMap) spqk.get(1);

            if (latsp.get("SPYJ") == null) {
            rows.put("立案庭审批", "");
            } else {
            rows.put("立案庭审批", latsp.get("SPYJ"));
            }
            rows.put("立案庭签名", latsp.get("XM"));
            if (latsp.get("SPRQ") == null) {
            rows.put("立案庭审批时间", "");
            } else {
            rows.put("立案庭审批时间", sf.format(latsp.get("SPRQ")));
            }
            } else {

            rows.put("立案庭审批", "");

            rows.put("立案庭签名", "");

            rows.put("立案庭审批时间", "");

            }

            }

            HashMap pqxx2 = (HashMap) lsnext.get(0);
            rows.put("业务庭2", Dict.getInstance().getBmDictMc(sfjm,
            pqxx2.get("CBBM").toString(), "bmqc"));
            o = pqxx2.get("ZSFG");
            rows.put("承办人2", o == null ? "" : o);
            o = pqxx2.get("SPZ");
            rows.put("审判长2", o == null ? "" : o);
            o = pqxx2.get("QTHYTCY");
            rows.put("合议庭成员2", o == null ? "" : o);
            o = pqxx2.get("SJY");
            rows.put("书记员2", o == null ? "" : o);
            Object object = pqxx2.get("PQFGXM");
            if (object == null) {
            rows.put("排期法官2", "");
            } else {
            rows.put("排期法官2", object);
            }
            if (pqxx2.get("pqsj") != null) {
            rows.put("排期日期2", sf.format(pqxx2.get("PQSJ")));
            } else {
            rows.put("排期日期2", "");
            }
            if (pqxx2.get("KTFT") != null
            && pqxx2.get("KTFT").toString().length() > 0)
            rows.put("开庭法庭2", pqxx2.get("KTFT"));
            else
            rows.put("开庭法庭2", "");
            if (pqxx2.get("YJKSSJ") != null)
            rows.put("开庭时间2", sft.format(pqxx2.get("YJKSSJ")));
            else
            rows.put("开庭时间2", "");
            if (pqxx2.get("YJJSSJ") != null)
            rows.put("预计开庭截止时间2", sft.format(pqxx2.get("YJJSSJ")));
            else
            rows.put("预计开庭截止时间2", "");

            if (pqxx2.get("PQFS").toString().equals("1"))
            rows.put("排定方式2", "自动");
            else
            rows.put("排定方式2", "手动");
            if (pqxx2.get("TSBLY") != null)
            rows.put("速记员2", pqxx2.get("TSBLY"));
            else
            rows.put("速记员2", "");
            }

            // 当事人信息
            Dsrxx dsr = new Dsrxx();
            dsr.setAjid(ajids[i]);
            List dsrList = dao.query("Dsrxx.getDsrOdrBy", dsr);
            String dsrStr = "";
            String Ai = "";
            for (int j = 0; j < dsrList.size(); j++) {
            Dsrxx dx = (Dsrxx) dsrList.get(j);
            if (dx.getSsdw() == null) {
            String tmp = dx.getDsrmc();
            if (j == 0) {
            dsrStr += tmp;
            } else {
            dsrStr += "\r" + tmp;
            }
            } else {
            if (Ai.equals(dx.getSsdw())) {
            String tmp = "、" + dx.getDsrmc();
            dsrStr += tmp;
            } else {
            String tmp = dx.getSsdwmc() + "：" + dx.getDsrmc();
            if (j == 0) {
            dsrStr += tmp;
            } else {
            dsrStr += "\r" + tmp;
            }
            }

            /*
            * if (j == 9) { dsrStr += "更多、、"; break; }
            */
            Ai = dx.getSsdw();
            }
            }
            rows.put("当事人", dsrStr);
            //			if (this.getSfcp().equals("1") && (lsnext.size() > 0)) {//modify 10.24
            if (this.getSfcp().equals("1")) {
            temp.add(rows);
            }
            if (this.getSfcp().equals("0")) {
            temp.add(rows);
            }
            tabMap.put("ajpdtzd", temp);
            }
            if (this.getSfcp().equals("1")) {
            WritManager wmcp = new WritManager("ajcxpdd.doc");
            wmcp.setTabMap(tabMap);
            // /wm.createDocsToFile("court/oa/baobiao/dbajdy1.doc");
            wmcp.createDocsToResp(response);
            } else {
            WritManager wm = new WritManager("ajpdtzd.doc");
            wm.setTabMap(tabMap);
            wm.createDocsToResp(response);

            }

            }

            public String getSqlWhere() {
            return sqlWhere;
            }

            public void setSqlWhere(String sqlWhere) {
            this.sqlWhere = sqlWhere;
            }

            /**
            * @param fdsx the fdsx to set
            */
            public void setFdsx(Integer fdsx) {
            this.fdsx = fdsx;
            }

            /**
            * @return the fdsx
            */
            public Integer getFdsx() {
            return fdsx;
            }

            /**
            * @param ssbd the ssbd to set
            */
            public void setSsbd(Double ssbd) {
            this.ssbd = ssbd;
            }

            /**
            * @return the ssbd
            */
            public Double getSsbd() {
            return ssbd;
            }

            public void setLrrxm(String lrrxm) {
            this.lrrxm = lrrxm;
            }

            public String getLrrxm() {
            return lrrxm;
            }

            public String getPqbg() {
            return pqbg;
            }

            public void setPqbg(String pqbg) {
            this.pqbg = pqbg;
            }

            public String getGsr() {
            return gsr;
            }

            public void setGsr(String gsr) {
            this.gsr = gsr;
            }

            public String getSjy() {
            return sjy;
            }

            public void setSjy(String sjy) {
            this.sjy = sjy;
            }

            public String getMode() {
            return mode;
            }

            public void setMode(String mode) {
            this.mode = mode;
            }

            public String getPqfg() {
            return pqfg;
            }

            public void setPqfg(String pqfg) {
            this.pqfg = pqfg;
            }

            public String getPqfgxm() {
            return pqfgxm;
            }

            public void setPqfgxm(String pqfgxm) {
            this.pqfgxm = pqfgxm;
            }

            public Double getYjssf() {
            return yjssf;
            }

            public void setYjssf(Double yjssf) {
            this.yjssf = yjssf;
            }

            public String getSpyjly() {
            if (!"1".equals(this.getAjlb()) && !"1".equals(this.getSpcx())) {
            return "";
            } else {
            if (spyjly == null) {
            spyjly = "";
            }
            if ("1".equals(Dict.getInstance().getSetupInfo(this.fjm,
            "xgxsyslalc"))
            && "1".equals(this.spcxdm) && "1".equals(this.ajlb)) {
            String spyjlyxx = "";
            if (this.spyjly != null) {
            spyjlyxx = this.spyjly;
            }
            spyjly = this.scyjly == null ? spyjlyxx : this.scyjly;
            }
            String str = spyjly;
            spyjly = "<p style=\"padding-left:65px;\"><b>立案审批意见:</b> " + str
                + "</p>";
            }
            return spyjly;
            }

            public void setSpyjly(String spyjly) {
            this.spyjly = spyjly;
            }

            public String getYjkssj() {
            return yjkssj;
            }

            public void setYjkssj(String yjkssj) {
            this.yjkssj = yjkssj;
            }

            public String getScyjly() {
            return scyjly;
            }

            public void setScyjly(String scyjly) {
            this.scyjly = scyjly;
            }

            public String getAyzs1() {
            return ayzs1;
            }

            public void setAyzs1(String ayzs1) {
            this.ayzs1 = ayzs1;
            }

            }
